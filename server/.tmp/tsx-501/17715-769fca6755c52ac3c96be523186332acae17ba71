{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import axios from\"axios\";function normalizeInstagramUsername(username){return username.replace(/^@+/,\"\").trim().toLowerCase()}__name(normalizeInstagramUsername,\"normalizeInstagramUsername\");function parseFollowersTextToNumber(value){if(!value)return null;const cleaned=value.replace(/,/g,\"\").trim().toUpperCase();const match=cleaned.match(/^(\\d+(?:\\.\\d+)?)([KMB])?$/);if(!match){const asInt=Number.parseInt(cleaned,10);return Number.isFinite(asInt)?asInt:null}const base=Number.parseFloat(match[1]);const suffix=match[2];if(!Number.isFinite(base))return null;if(suffix===\"K\")return Math.round(base*1e3);if(suffix===\"M\")return Math.round(base*1e6);if(suffix===\"B\")return Math.round(base*1e9);return Math.round(base)}__name(parseFollowersTextToNumber,\"parseFollowersTextToNumber\");const fetchInstagramPublicData=__name(async username=>{const normalized=normalizeInstagramUsername(username);if(!normalized)return null;const urls=[`https://www.instagram.com/${normalized}/?__a=1&__d=dis`,`https://www.instagram.com/api/v1/users/web_profile_info/?username=${encodeURIComponent(normalized)}`];for(const url of urls){try{const res=await axios.get(url,{timeout:8e3,headers:{\"User-Agent\":\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36\",Accept:\"application/json\",Referer:`https://www.instagram.com/${normalized}/`,\"X-Requested-With\":\"XMLHttpRequest\"}});const graphqlUser=res.data?.graphql?.user;const webProfileUser=res.data?.data?.user;const user=graphqlUser||webProfileUser;if(!user)continue;const profilePhoto=user.profile_pic_url_hd||user.profile_pic_url||null;const followersRaw=user.edge_followed_by?.count??user.follower_count??null;return{profile_photo:typeof profilePhoto===\"string\"?profilePhoto:null,followers:typeof followersRaw===\"number\"?followersRaw:null,full_name:typeof user.full_name===\"string\"?user.full_name:null,bio:typeof user.biography===\"string\"?user.biography:null}}catch(err){if(process.env.NODE_ENV!==\"production\"){console.log(\"[InstagramService] fetch failed:\",normalized,url,err?.message||err)}}}try{const pageUrl=`https://www.instagram.com/${normalized}/`;const page=await axios.get(pageUrl,{timeout:8e3,headers:{\"User-Agent\":\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36\",Accept:\"text/html,application/xhtml+xml\"}});const html=typeof page.data===\"string\"?page.data:\"\";if(!html)return null;const followersMatch=html.match(/\"edge_followed_by\"\\s*:\\s*\\{\"count\"\\s*:\\s*(\\d+)/)||html.match(/\"follower_count\"\\s*:\\s*(\\d+)/);const photoMatch=html.match(/\"profile_pic_url_hd\"\\s*:\\s*\"([^\"]+)\"/)||html.match(/\"profile_pic_url\"\\s*:\\s*\"([^\"]+)\"/);const ogTitleMatch=html.match(/property=\"og:title\"\\s+content=\"([^\"]+)\"/i);const ogDescriptionMatch=html.match(/property=\"og:description\"\\s+content=\"([^\"]+)\"/i);const ogImageMatch=html.match(/property=\"og:image\"\\s+content=\"([^\"]+)\"/i);const ogTitleRaw=ogTitleMatch?.[1]||null;const ogDescriptionRaw=ogDescriptionMatch?.[1]||null;const ogImageRaw=ogImageMatch?.[1]||null;const followersFromStructured=followersMatch?Number(followersMatch[1]):null;const followersFromOg=parseFollowersTextToNumber((ogDescriptionRaw?.match(/([\\d.,]+[KMB]?)\\s+Followers/i)||[])[1]);const followers=followersFromStructured??followersFromOg;const profilePhotoRaw=photoMatch?.[1]||null;const profilePhoto=profilePhotoRaw||ogImageRaw?(profilePhotoRaw||ogImageRaw).replace(/\\\\u0026/g,\"&\").replace(/\\\\\\//g,\"/\"):null;const fullName=ogTitleRaw?ogTitleRaw.replace(/&#064;/g,\"@\").replace(/&#x2022;/g,\"\\u2022\").replace(/\\s*\\(@[^)]*\\)\\s*â€¢\\s*Instagram photos and videos/i,\"\").trim():null;const bio=ogDescriptionRaw?ogDescriptionRaw.replace(/&#064;/g,\"@\").replace(/^.*?\\d+\\s+Followers,\\s*\\d+\\s+Following,\\s*\\d+\\s+Posts\\s*-\\s*See Instagram photos and videos from\\s*/i,\"\").trim():null;const normalizedFullName=fullName?.toLowerCase()||\"\";const isGenericName=normalizedFullName===\"instagram\";const isGenericPhoto=!!profilePhoto&&/static\\.cdninstagram\\.com\\/rsrc\\.php/i.test(profilePhoto);const normalizedBio=bio?.toLowerCase()||\"\";const isGenericBio=normalizedBio===\"instagram\"||normalizedBio.length<2;const safeFullName=isGenericName?null:fullName;const safePhoto=isGenericPhoto?null:profilePhoto;const safeBio=isGenericBio?null:bio;if(followers===null&&!safePhoto&&!safeFullName&&!safeBio)return null;return{profile_photo:safePhoto,followers:Number.isFinite(followers)?followers:null,full_name:safeFullName,bio:safeBio}}catch(err){if(process.env.NODE_ENV!==\"production\"){console.log(\"[InstagramService] HTML fallback failed:\",normalized,err?.message||err)}}return null},\"fetchInstagramPublicData\");export{fetchInstagramPublicData};\n","warnings":[],"map":{"version":3,"mappings":"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","names":[],"ignoreList":[],"sources":["/Users/pratyushraj/Documents/noticebazaar/server/src/services/instagramService.ts"],"sourcesContent":[null]}}