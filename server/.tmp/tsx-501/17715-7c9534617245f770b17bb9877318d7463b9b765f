{"code":"import{Router}from\"express\";import{supabase}from\"../lib/supabase.js\";import{getContractReadyTokenInfo}from\"../services/contractReadyTokenService.js\";import{signContractAsBrand,getClientIp,getDeviceInfo,getSignature}from\"../services/contractSigningService.js\";import{authMiddleware}from\"../middleware/auth.js\";const router=Router();router.post(\"/\",authMiddleware,async(req,res)=>{try{const{dealId,expiresAt}=req.body;const userId=req.user?.id;if(!userId){return res.status(401).json({success:false,error:\"Unauthorized\"})}if(!dealId){return res.status(400).json({success:false,error:\"dealId is required\"})}const{data:deal,error:dealError}=await supabase.from(\"brand_deals\").select(\"id, creator_id\").eq(\"id\",dealId).single();if(dealError||!deal){return res.status(404).json({success:false,error:\"Deal not found\"})}if(deal.creator_id!==userId&&req.user?.role!==\"admin\"){return res.status(403).json({success:false,error:\"Access denied\"})}const{createContractReadyToken}=await import(\"../services/contractReadyTokenService.js\").then(s=>{const e=\"default\";return s[e]&&typeof s[e]==\"object\"&&\"__esModule\"in s[e]?s[e]:s});const token=await createContractReadyToken({dealId,creatorId:userId,expiresAt:expiresAt?new Date(expiresAt):null});return res.json({success:true,token:{id:token.id,deal_id:token.deal_id,expires_at:token.expires_at,created_at:token.created_at}})}catch(error){console.error(\"[ContractReadyTokens] POST Error:\",error);return res.status(500).json({success:false,error:error.message||\"Internal server error\"})}});router.get(\"/:token\",async(req,res)=>{try{const{token}=req.params;if(!token||typeof token!==\"string\"||token.trim()===\"\"){return res.status(400).json({success:false,error:\"Invalid token\"})}const tokenInfo=await getContractReadyTokenInfo(token.trim());if(!tokenInfo){const{data:invalidToken,error:tokenLookupError}=await supabase.from(\"contract_ready_tokens\").select(\"id, deal_id, created_by, created_at, expires_at, is_active, revoked_at\").eq(\"id\",token.trim()).maybeSingle();if(tokenLookupError||!invalidToken){console.log(\"[ContractReadyTokens] Token does not exist in contract_ready_tokens, checking if it is a deal details token:\",token.trim());const{getDealDetailsTokenInfo}=await import(\"../services/dealDetailsTokenService.js\").then(s=>{const e=\"default\";return s[e]&&typeof s[e]==\"object\"&&\"__esModule\"in s[e]?s[e]:s});const dealDetailsTokenInfo=await getDealDetailsTokenInfo(token.trim());if(dealDetailsTokenInfo){return res.json({success:false,redirectTo:`/deal/${token.trim()}`,message:\"This is a deal details link. Please use the deal details page to submit information.\"})}return res.status(404).json({success:false,error:\"This link is no longer valid. Please contact the creator for a new link.\"})}console.log(\"[ContractReadyTokens] Token exists but getContractReadyTokenInfo returned null:\",{tokenId:invalidToken.id,dealId:invalidToken.deal_id,createdBy:invalidToken.created_by,isActive:invalidToken.is_active,revokedAt:invalidToken.revoked_at,expiresAt:invalidToken.expires_at});if(invalidToken?.deal_id){const now=new Date;const{data:newerTokens,error:newerTokenError}=await supabase.from(\"contract_ready_tokens\").select(\"id, is_active, revoked_at, expires_at, created_at\").eq(\"deal_id\",invalidToken.deal_id).eq(\"is_active\",true).is(\"revoked_at\",null).order(\"created_at\",{ascending:false}).limit(5);if(!newerTokenError&&newerTokens&&newerTokens.length>0){const validToken=newerTokens.find(t=>{const isNotExpired=!t.expires_at||new Date(t.expires_at)>now;return t.is_active&&!t.revoked_at&&isNotExpired});if(validToken?.id){console.log(\"[ContractReadyTokens] Found valid newer token, redirecting:\",validToken.id);return res.json({success:true,redirectToToken:validToken.id,message:\"This link has been replaced with a newer one. Please use the updated link.\"})}else{console.warn(\"[ContractReadyTokens] No valid newer tokens found for deal:\",invalidToken.deal_id)}}}return res.status(404).json({success:false,error:\"This link is no longer valid. Please contact the creator for a new link.\"})}const signature=await getSignature(tokenInfo.deal.id,\"brand\");const response={success:true,deal:tokenInfo.deal,creatorName:tokenInfo.creatorName??null,creatorEmail:tokenInfo.creatorEmail??null,creatorAddress:tokenInfo.creatorAddress??null,signature:signature?{id:signature.id,signed:signature.signed,signedAt:signature.signed_at,signerName:signature.signer_name,signerEmail:signature.signer_email}:null};console.log(\"[ContractReadyTokens] Returning response with creator info:\",{creatorName:response.creatorName,creatorEmail:response.creatorEmail,creatorAddress:response.creatorAddress,dealCreatorId:tokenInfo.deal.creator_id});return res.json(response)}catch(error){console.error(\"[ContractReadyTokens] GET Error:\",error);return res.status(500).json({success:false,error:\"An error occurred. Please try again later.\"})}});router.get(\"/:token/creator-info\",async(req,res)=>{try{const{token}=req.params;if(!token||typeof token!==\"string\"||token.trim()===\"\"){return res.status(400).json({success:false,error:\"Invalid token\"})}const tokenInfo=await getContractReadyTokenInfo(token.trim());if(!tokenInfo||!tokenInfo.deal?.creator_id){return res.status(404).json({success:false,error:\"Token not found or invalid\"})}return res.json({success:true,creatorName:tokenInfo.creatorName??null,creatorEmail:tokenInfo.creatorEmail??null,creatorAddress:tokenInfo.creatorAddress??null})}catch(error){console.error(\"[ContractReadyTokens] Creator Info Error:\",error);return res.status(500).json({success:false,error:\"An error occurred. Please try again later.\"})}});router.get(\"/:token/signature\",async(req,res)=>{try{const{token}=req.params;if(!token||typeof token!==\"string\"||token.trim()===\"\"){return res.status(400).json({success:false,error:\"Invalid token\"})}const tokenInfo=await getContractReadyTokenInfo(token.trim());if(!tokenInfo){return res.status(404).json({success:false,error:\"This link is no longer valid. Please contact the creator.\"})}const signature=await getSignature(tokenInfo.deal.id,\"brand\");if(!signature){return res.status(404).json({success:false,error:\"No signature found\"})}return res.json({success:true,signature:{id:signature.id,signerName:signature.signer_name,signerEmail:signature.signer_email,signerPhone:signature.signer_phone,signed:signature.signed,signedAt:signature.signed_at,otpVerified:signature.otp_verified,otpVerifiedAt:signature.otp_verified_at,contractVersionId:signature.contract_version_id,deviceInfo:signature.device_info}})}catch(error){console.error(\"[ContractReadyTokens] Get signature error:\",error);return res.status(500).json({success:false,error:error.message||\"An error occurred. Please try again later.\"})}});router.post(\"/:token/sign\",async(req,res)=>{try{const{token}=req.params;const{signerName,signerEmail,signerPhone,contractVersionId,contractSnapshotHtml,otpVerified,otpVerifiedAt}=req.body;if(!token||typeof token!==\"string\"||token.trim()===\"\"){return res.status(400).json({success:false,error:\"Invalid token\"})}let tokenInfo=await getContractReadyTokenInfo(token.trim());if(!tokenInfo){const{data:replyTokenData,error:replyTokenError}=await supabase.from(\"brand_reply_tokens\").select(\"id, deal_id, is_active, expires_at, revoked_at\").eq(\"id\",token.trim()).maybeSingle();if(!replyTokenError&&replyTokenData&&replyTokenData.is_active&&!replyTokenData.revoked_at){if(replyTokenData.expires_at){const now=new Date;const expiresAt=new Date(replyTokenData.expires_at);if(now>expiresAt){return res.status(403).json({success:false,error:\"This link is no longer valid. Please contact the creator.\"})}}const{data:deal2,error:dealError}=await supabase.from(\"brand_deals\").select(\"*\").eq(\"id\",replyTokenData.deal_id).maybeSingle();if(dealError||!deal2){return res.status(404).json({success:false,error:\"This link is no longer valid. Please contact the creator.\"})}let creatorName=\"Creator\";let creatorEmail=null;let creatorAddress=null;try{const{data:creatorProfile}=await supabase.from(\"profiles\").select(\"first_name, last_name, location, address\").eq(\"id\",deal2.creator_id).maybeSingle();if(creatorProfile){if(creatorProfile.first_name&&creatorProfile.last_name){creatorName=`${creatorProfile.first_name} ${creatorProfile.last_name}`.trim()}else if(creatorProfile.first_name){creatorName=creatorProfile.first_name}else if(creatorProfile.last_name){creatorName=creatorProfile.last_name}const creatorAny=creatorProfile;creatorAddress=creatorAny.location||creatorAny.address||null}try{const{data:authUser}=await supabase.auth.admin.getUserById(deal2.creator_id);creatorEmail=authUser?.user?.email||null;if(creatorName===\"Creator\"&&creatorEmail){const emailUsername=creatorEmail.split(\"@\")[0];if(emailUsername&&emailUsername.length>=2){creatorName=emailUsername.charAt(0).toUpperCase()+emailUsername.slice(1)}}}catch(authError){console.warn(\"[ContractReadyTokens] Could not fetch creator email from auth:\",authError)}}catch(profileError){console.warn(\"[ContractReadyTokens] Could not fetch creator profile:\",profileError)}tokenInfo={token:{id:replyTokenData.id,deal_id:replyTokenData.deal_id,is_active:replyTokenData.is_active,expires_at:replyTokenData.expires_at,revoked_at:replyTokenData.revoked_at,created_at:replyTokenData.created_at||new Date().toISOString(),created_by:deal2.creator_id},deal:deal2,creatorName,creatorEmail,creatorAddress}}}if(!tokenInfo){return res.status(404).json({success:false,error:\"This link is no longer valid. Please contact the creator.\"})}const deal=tokenInfo.deal;const finalSignerName=signerName||deal.brand_name||\"Brand\";const finalSignerEmail=signerEmail||deal.brand_email;const finalSignerPhone=signerPhone||deal.brand_phone;if(!finalSignerEmail){return res.status(400).json({success:false,error:\"Signer email is required\"})}const ipAddress=getClientIp(req);const userAgent=req.headers[\"user-agent\"]||\"Unknown\";const deviceInfo=getDeviceInfo(userAgent);const result=await signContractAsBrand({dealId:deal.id,token:token.trim(),signerName:finalSignerName,signerEmail:finalSignerEmail,signerPhone:finalSignerPhone,contractVersionId:contractVersionId||deal.contract_version||\"v3\",contractSnapshotHtml,ipAddress,userAgent,deviceInfo,otpVerified:otpVerified!==false,otpVerifiedAt:otpVerifiedAt||new Date().toISOString()},tokenInfo);if(!result.success){return res.status(400).json({success:false,error:result.error||\"Failed to sign contract\"})}try{const{sendContractSignedEmails}=await import(\"./contractSignedEmailService.js\").then(s=>{const e=\"default\";return s[e]&&typeof s[e]==\"object\"&&\"__esModule\"in s[e]?s[e]:s});sendContractSignedEmails(deal.id,result.signature).catch(err=>{console.error(\"[ContractReadyTokens] Email sending failed (non-fatal):\",err)})}catch(emailError){console.error(\"[ContractReadyTokens] Email service import failed (non-fatal):\",emailError)}return res.json({success:true,message:\"Contract signed successfully\",signature:{id:result.signature?.id,signedAt:result.signature?.signed_at}})}catch(error){console.error(\"[ContractReadyTokens] Sign Error:\",error);return res.status(500).json({success:false,error:error.message||\"An error occurred. Please try again later.\"})}});router.post(\"/:token/request-edit\",async(req,res)=>{try{const{token}=req.params;const{message}=req.body;if(!token||typeof token!==\"string\"||token.trim()===\"\"){return res.status(400).json({success:false,error:\"Invalid token\"})}if(!message||typeof message!==\"string\"||message.trim()===\"\"){return res.status(400).json({success:false,error:\"Message is required\"})}const tokenInfo=await getContractReadyTokenInfo(token.trim());if(!tokenInfo){return res.status(404).json({success:false,error:\"This link is no longer valid. Please contact the creator.\"})}const deal=tokenInfo.deal;const{error:updateError}=await supabase.from(\"brand_deals\").update({status:\"BRAND_REQUESTED_CHANGES\",brand_response_status:\"negotiating\",brand_feedback:message.trim(),updated_at:new Date().toISOString()}).eq(\"id\",deal.id);if(updateError){console.error(\"[ContractReadyTokens] Request edit error:\",updateError);return res.status(500).json({success:false,error:\"Failed to submit edit request\"})}try{await supabase.from(\"analytics_events\").insert({event_type:\"brand_requested_changes\",deal_id:deal.id,creator_id:deal.creator_id,metadata:{source:\"contract_ready_page\",token_id:token,message_length:message.trim().length},created_at:new Date().toISOString()})}catch(analyticsError){console.error(\"[ContractReadyTokens] Activity logging failed (non-fatal):\",analyticsError)}return res.json({success:true,message:\"Edit request submitted successfully\"})}catch(error){console.error(\"[ContractReadyTokens] Request edit Error:\",error);return res.status(500).json({success:false,error:error.message||\"An error occurred. Please try again later.\"})}});var contractReadyTokens_default=router;export{contractReadyTokens_default as default};\n","warnings":[],"map":{"version":3,"mappings":"AAIA,OAAS,WAAiC,UAC1C,OAAS,aAAgB,qBACzB,OAAS,8BAAiC,2CAC1C,OAAS,oBAAqB,YAAa,cAAe,iBAAoB,wCAC9E,OAAS,mBAAsB,wBAE/B,MAAM,OAAS,OAAO,EAItB,OAAO,KAAK,IAAK,eAAgB,MAAO,IAAU,MAAkB,CAClE,GAAI,CACF,KAAM,CAAE,OAAQ,SAAU,EAAI,IAAI,KAClC,MAAM,OAAU,IAAY,MAAM,GAElC,GAAI,CAAC,OAAQ,CACX,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,cAAe,CAAC,CACvE,CAEA,GAAI,CAAC,OAAQ,CACX,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,oBAAqB,CAAC,CAC7E,CAGA,KAAM,CAAE,KAAM,KAAM,MAAO,SAAU,EAAI,MAAM,SAC5C,KAAK,aAAa,EAClB,OAAO,gBAAgB,EACvB,GAAG,KAAM,MAAM,EACf,OAAO,EAEV,GAAI,WAAa,CAAC,KAAM,CACtB,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,gBAAiB,CAAC,CACzE,CAEA,GAAI,KAAK,aAAe,QAAW,IAAY,MAAM,OAAS,QAAS,CACrE,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,eAAgB,CAAC,CACxE,CAEA,KAAM,CAAE,wBAAyB,EAAI,KAAM,QAAO,0CAA0C,8FAC5F,MAAM,MAAQ,MAAM,yBAAyB,CAC3C,OACA,UAAW,OACX,UAAW,UAAY,IAAI,KAAK,SAAS,EAAI,IAC/C,CAAC,EAED,OAAO,IAAI,KAAK,CACd,QAAS,KACT,MAAO,CACL,GAAI,MAAM,GACV,QAAS,MAAM,QACf,WAAY,MAAM,WAClB,WAAY,MAAM,UACpB,CACF,CAAC,CACH,OAAS,MAAY,CACnB,QAAQ,MAAM,oCAAqC,KAAK,EACxD,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,MAAM,SAAW,uBAC1B,CAAC,CACH,CACF,CAAC,EAID,OAAO,IAAI,UAAW,MAAO,IAAc,MAAkB,CAC3D,GAAI,CACF,KAAM,CAAE,KAAM,EAAI,IAAI,OAEtB,GAAI,CAAC,OAAS,OAAO,QAAU,UAAY,MAAM,KAAK,IAAM,GAAI,CAC9D,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,eACT,CAAC,CACH,CAEA,MAAM,UAAY,MAAM,0BAA0B,MAAM,KAAK,CAAC,EAE9D,GAAI,CAAC,UAAW,CAEd,KAAM,CAAE,KAAM,aAAc,MAAO,gBAAiB,EAAI,MAAO,SAC5D,KAAK,uBAAuB,EAC5B,OAAO,wEAAwE,EAC/E,GAAG,KAAM,MAAM,KAAK,CAAC,EACrB,YAAY,EAGf,GAAI,kBAAoB,CAAC,aAAc,CACrC,QAAQ,IAAI,+GAAgH,MAAM,KAAK,CAAC,EAGxI,KAAM,CAAE,uBAAwB,EAAI,KAAM,QAAO,wCAAwC,8FACzF,MAAM,qBAAuB,MAAM,wBAAwB,MAAM,KAAK,CAAC,EAEvE,GAAI,qBAAsB,CAExB,OAAO,IAAI,KAAK,CACd,QAAS,MACT,WAAY,SAAS,MAAM,KAAK,CAAC,GACjC,QAAS,sFACX,CAAC,CACH,CAEA,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,0EACT,CAAC,CACH,CAEA,QAAQ,IAAI,kFAAmF,CAC7F,QAAS,aAAa,GACtB,OAAQ,aAAa,QACrB,UAAW,aAAa,WACxB,SAAU,aAAa,UACvB,UAAW,aAAa,WACxB,UAAW,aAAa,UAC1B,CAAC,EAED,GAAI,cAAc,QAAS,CAGzB,MAAM,IAAM,IAAI,KAChB,KAAM,CAAE,KAAM,YAAa,MAAO,eAAgB,EAAI,MAAO,SAC1D,KAAK,uBAAuB,EAC5B,OAAO,mDAAmD,EAC1D,GAAG,UAAW,aAAa,OAAO,EAClC,GAAG,YAAa,IAAI,EACpB,GAAG,aAAc,IAAI,EACrB,MAAM,aAAc,CAAE,UAAW,KAAM,CAAC,EACxC,MAAM,CAAC,EAEV,GAAI,CAAC,iBAAmB,aAAe,YAAY,OAAS,EAAG,CAE7D,MAAM,WAAa,YAAY,KAAM,GAAW,CAC9C,MAAM,aAAe,CAAC,EAAE,YAAc,IAAI,KAAK,EAAE,UAAU,EAAI,IAC/D,OAAO,EAAE,WAAa,CAAC,EAAE,YAAc,YACzC,CAAC,EAED,GAAI,YAAY,GAAI,CAClB,QAAQ,IAAI,8DAA+D,WAAW,EAAE,EACxF,OAAO,IAAI,KAAK,CACd,QAAS,KACT,gBAAiB,WAAW,GAC5B,QAAS,4EACX,CAAC,CACH,KAAO,CACL,QAAQ,KAAK,8DAA+D,aAAa,OAAO,CAClG,CACF,CACF,CAEA,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,0EACT,CAAC,CACH,CAGA,MAAM,UAAY,MAAM,aAAa,UAAU,KAAK,GAAI,OAAO,EAG/D,MAAM,SAAW,CACf,QAAS,KACT,KAAM,UAAU,KAChB,YAAa,UAAU,aAAe,KACtC,aAAc,UAAU,cAAgB,KACxC,eAAgB,UAAU,gBAAkB,KAC5C,UAAW,UAAY,CACrB,GAAI,UAAU,GACd,OAAQ,UAAU,OAClB,SAAU,UAAU,UACpB,WAAY,UAAU,YACtB,YAAa,UAAU,YACzB,EAAI,IACN,EAEA,QAAQ,IAAI,8DAA+D,CACzE,YAAa,SAAS,YACtB,aAAc,SAAS,aACvB,eAAgB,SAAS,eACzB,cAAe,UAAU,KAAK,UAChC,CAAC,EAED,OAAO,IAAI,KAAK,QAAQ,CAC1B,OAAS,MAAY,CACnB,QAAQ,MAAM,mCAAoC,KAAK,EACvD,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,4CACT,CAAC,CACH,CACF,CAAC,EAID,OAAO,IAAI,uBAAwB,MAAO,IAAc,MAAkB,CACxE,GAAI,CACF,KAAM,CAAE,KAAM,EAAI,IAAI,OAEtB,GAAI,CAAC,OAAS,OAAO,QAAU,UAAY,MAAM,KAAK,IAAM,GAAI,CAC9D,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,eACT,CAAC,CACH,CAGA,MAAM,UAAY,MAAM,0BAA0B,MAAM,KAAK,CAAC,EAE9D,GAAI,CAAC,WAAa,CAAC,UAAU,MAAM,WAAY,CAC7C,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,4BACT,CAAC,CACH,CAGA,OAAO,IAAI,KAAK,CACd,QAAS,KACT,YAAa,UAAU,aAAe,KACtC,aAAc,UAAU,cAAgB,KACxC,eAAgB,UAAU,gBAAkB,IAC9C,CAAC,CACH,OAAS,MAAY,CACnB,QAAQ,MAAM,4CAA6C,KAAK,EAChE,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,4CACT,CAAC,CACH,CACF,CAAC,EAID,OAAO,IAAI,oBAAqB,MAAO,IAAc,MAAkB,CACrE,GAAI,CACF,KAAM,CAAE,KAAM,EAAI,IAAI,OAEtB,GAAI,CAAC,OAAS,OAAO,QAAU,UAAY,MAAM,KAAK,IAAM,GAAI,CAC9D,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,eACT,CAAC,CACH,CAGA,MAAM,UAAY,MAAM,0BAA0B,MAAM,KAAK,CAAC,EAE9D,GAAI,CAAC,UAAW,CACd,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,2DACT,CAAC,CACH,CAGA,MAAM,UAAY,MAAM,aAAa,UAAU,KAAK,GAAI,OAAO,EAE/D,GAAI,CAAC,UAAW,CACd,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,oBACT,CAAC,CACH,CAEA,OAAO,IAAI,KAAK,CACd,QAAS,KACT,UAAW,CACT,GAAI,UAAU,GACd,WAAY,UAAU,YACtB,YAAa,UAAU,aACvB,YAAa,UAAU,aACvB,OAAQ,UAAU,OAClB,SAAU,UAAU,UACpB,YAAa,UAAU,aACvB,cAAe,UAAU,gBACzB,kBAAmB,UAAU,oBAC7B,WAAY,UAAU,WAExB,CACF,CAAC,CACH,OAAS,MAAY,CACnB,QAAQ,MAAM,6CAA8C,KAAK,EACjE,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,MAAM,SAAW,4CAC1B,CAAC,CACH,CACF,CAAC,EAID,OAAO,KAAK,eAAgB,MAAO,IAAc,MAAkB,CACjE,GAAI,CACF,KAAM,CAAE,KAAM,EAAI,IAAI,OACtB,KAAM,CACJ,WACA,YACA,YACA,kBACA,qBACA,YACA,aACF,EAAI,IAAI,KAER,GAAI,CAAC,OAAS,OAAO,QAAU,UAAY,MAAM,KAAK,IAAM,GAAI,CAC9D,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,eACT,CAAC,CACH,CAGA,IAAI,UAAY,MAAM,0BAA0B,MAAM,KAAK,CAAC,EAG5D,GAAI,CAAC,UAAW,CAEd,KAAM,CAAE,KAAM,eAAgB,MAAO,eAAgB,EAAI,MAAM,SAC5D,KAAK,oBAAoB,EACzB,OAAO,gDAAgD,EACvD,GAAG,KAAM,MAAM,KAAK,CAAC,EACrB,YAAY,EAEf,GAAI,CAAC,iBAAmB,gBAAkB,eAAe,WAAa,CAAC,eAAe,WAAY,CAEhG,GAAI,eAAe,WAAY,CAC7B,MAAM,IAAM,IAAI,KAChB,MAAM,UAAY,IAAI,KAAK,eAAe,UAAU,EACpD,GAAI,IAAM,UAAW,CACnB,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,2DACT,CAAC,CACH,CACF,CAGA,KAAM,CAAE,KAAMA,MAAM,MAAO,SAAU,EAAI,MAAM,SAC5C,KAAK,aAAa,EAClB,OAAO,GAAG,EACV,GAAG,KAAM,eAAe,OAAO,EAC/B,YAAY,EAEf,GAAI,WAAa,CAACA,MAAM,CACtB,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,2DACT,CAAC,CACH,CAGA,IAAI,YAAc,UAClB,IAAI,aAA8B,KAClC,IAAI,eAAgC,KAEpC,GAAI,CACF,KAAM,CAAE,KAAM,cAAe,EAAI,MAAM,SACpC,KAAK,UAAU,EACf,OAAO,0CAA0C,EACjD,GAAG,KAAMA,MAAK,UAAU,EACxB,YAAY,EAEf,GAAI,eAAgB,CAElB,GAAI,eAAe,YAAc,eAAe,UAAW,CACzD,YAAc,GAAG,eAAe,UAAU,IAAI,eAAe,SAAS,GAAG,KAAK,CAChF,SAAW,eAAe,WAAY,CACpC,YAAc,eAAe,UAC/B,SAAW,eAAe,UAAW,CACnC,YAAc,eAAe,SAC/B,CAGA,MAAM,WAAa,eACnB,eAAiB,WAAW,UAAY,WAAW,SAAW,IAChE,CAGA,GAAI,CACF,KAAM,CAAE,KAAM,QAAS,EAAI,MAAM,SAAS,KAAK,MAAM,YAAYA,MAAK,UAAU,EAChF,aAAe,UAAU,MAAM,OAAS,KAGxC,GAAI,cAAgB,WAAa,aAAc,CAC7C,MAAM,cAAgB,aAAa,MAAM,GAAG,EAAE,CAAC,EAC/C,GAAI,eAAiB,cAAc,QAAU,EAAG,CAC9C,YAAc,cAAc,OAAO,CAAC,EAAE,YAAY,EAAI,cAAc,MAAM,CAAC,CAC7E,CACF,CACF,OAAS,UAAW,CAClB,QAAQ,KAAK,iEAAkE,SAAS,CAC1F,CACF,OAAS,aAAc,CACrB,QAAQ,KAAK,yDAA0D,YAAY,CACrF,CAIA,UAAY,CACV,MAAO,CACL,GAAI,eAAe,GACnB,QAAS,eAAe,QACxB,UAAW,eAAe,UAC1B,WAAY,eAAe,WAC3B,WAAY,eAAe,WAC3B,WAAa,eAAuB,YAAc,IAAI,KAAK,EAAE,YAAY,EACzE,WAAYA,MAAK,UACnB,EACA,KAAMA,MACN,YACA,aACA,cACF,CACF,CACF,CAEA,GAAI,CAAC,UAAW,CACd,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,2DACT,CAAC,CACH,CAEA,MAAM,KAAO,UAAU,KAGvB,MAAM,gBAAkB,YAAc,KAAK,YAAc,QACzD,MAAM,iBAAmB,aAAe,KAAK,YAC7C,MAAM,iBAAmB,aAAe,KAAK,YAE7C,GAAI,CAAC,iBAAkB,CACrB,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,0BACT,CAAC,CACH,CAGA,MAAM,UAAY,YAAY,GAAG,EACjC,MAAM,UAAY,IAAI,QAAQ,YAAY,GAAK,UAC/C,MAAM,WAAa,cAAc,SAAS,EAG1C,MAAM,OAAS,MAAM,oBAAoB,CACvC,OAAQ,KAAK,GACb,MAAO,MAAM,KAAK,EAClB,WAAY,gBACZ,YAAa,iBACb,YAAa,iBACb,kBAAmB,mBAAqB,KAAK,kBAAoB,KACjE,qBACA,UACA,UACA,WACA,YAAa,cAAgB,MAC7B,cAAe,eAAiB,IAAI,KAAK,EAAE,YAAY,CACzD,EAAG,SAAS,EAEZ,GAAI,CAAC,OAAO,QAAS,CACnB,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,OAAO,OAAS,yBACzB,CAAC,CACH,CAGA,GAAI,CACF,KAAM,CAAE,wBAAyB,EAAI,KAAM,QAAO,iCAAiC,8FACnF,yBAAyB,KAAK,GAAI,OAAO,SAAU,EAAE,MAAO,KAAQ,CAClE,QAAQ,MAAM,0DAA2D,GAAG,CAC9E,CAAC,CACH,OAAS,WAAY,CACnB,QAAQ,MAAM,iEAAkE,UAAU,CAC5F,CAEA,OAAO,IAAI,KAAK,CACd,QAAS,KACT,QAAS,+BACT,UAAW,CACT,GAAI,OAAO,WAAW,GACtB,SAAU,OAAO,WAAW,SAC9B,CACF,CAAC,CACH,OAAS,MAAY,CACnB,QAAQ,MAAM,oCAAqC,KAAK,EACxD,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,MAAM,SAAW,4CAC1B,CAAC,CACH,CACF,CAAC,EAID,OAAO,KAAK,uBAAwB,MAAO,IAAc,MAAkB,CACzE,GAAI,CACF,KAAM,CAAE,KAAM,EAAI,IAAI,OACtB,KAAM,CAAE,OAAQ,EAAI,IAAI,KAExB,GAAI,CAAC,OAAS,OAAO,QAAU,UAAY,MAAM,KAAK,IAAM,GAAI,CAC9D,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,eACT,CAAC,CACH,CAEA,GAAI,CAAC,SAAW,OAAO,UAAY,UAAY,QAAQ,KAAK,IAAM,GAAI,CACpE,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,qBACT,CAAC,CACH,CAGA,MAAM,UAAY,MAAM,0BAA0B,MAAM,KAAK,CAAC,EAE9D,GAAI,CAAC,UAAW,CACd,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,2DACT,CAAC,CACH,CAEA,MAAM,KAAO,UAAU,KAGvB,KAAM,CAAE,MAAO,WAAY,EAAI,MAAM,SAClC,KAAK,aAAa,EAClB,OAAO,CACN,OAAQ,0BACR,sBAAuB,cACvB,eAAgB,QAAQ,KAAK,EAC7B,WAAY,IAAI,KAAK,EAAE,YAAY,CACrC,CAAC,EACA,GAAG,KAAM,KAAK,EAAE,EAEnB,GAAI,YAAa,CACf,QAAQ,MAAM,4CAA6C,WAAW,EACtE,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,+BACT,CAAC,CACH,CAGA,GAAI,CACF,MAAM,SACH,KAAK,kBAAkB,EACvB,OAAO,CACN,WAAY,0BACZ,QAAS,KAAK,GACd,WAAY,KAAK,WACjB,SAAU,CACR,OAAQ,sBACR,SAAU,MACV,eAAgB,QAAQ,KAAK,EAAE,MACjC,EACA,WAAY,IAAI,KAAK,EAAE,YAAY,CACrC,CAAC,CACL,OAAS,eAAgB,CACvB,QAAQ,MAAM,6DAA8D,cAAc,CAC5F,CAIA,OAAO,IAAI,KAAK,CACd,QAAS,KACT,QAAS,qCACX,CAAC,CACH,OAAS,MAAY,CACnB,QAAQ,MAAM,4CAA6C,KAAK,EAChE,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,MAAM,SAAW,4CAC1B,CAAC,CACH,CACF,CAAC,EAED,IAAO,4BAAQ","names":["deal"],"ignoreList":[],"sources":["/Users/pratyushraj/Documents/noticebazaar/server/src/routes/contractReadyTokens.ts"],"sourcesContent":[null]}}