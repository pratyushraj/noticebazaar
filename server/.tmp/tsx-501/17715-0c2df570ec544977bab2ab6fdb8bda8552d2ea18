{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import{Router}from\"express\";import{supabase}from\"../lib/supabase.js\";import multer from\"multer\";import{generateContractFromScratch}from\"../services/contractGenerator.js\";import{createContractReadyToken}from\"../services/contractReadyTokenService.js\";import{sendCollabRequestAcceptedEmail}from\"../services/collabRequestEmailService.js\";import{createShippingToken}from\"../services/shippingTokenService.js\";import{sendBrandShippingUpdateEmail,sendBrandShippingIssueEmail}from\"../services/shippingEmailService.js\";import{authMiddleware}from\"../middleware/auth.js\";import{signContractAsCreator,getClientIp,getDeviceInfo}from\"../services/contractSigningService.js\";const router=Router();function maskPhone(phone){const digits=phone.replace(/\\D/g,\"\");if(digits.length<10)return\"XXXXXXXXXX\";return digits.slice(0,2)+\"XXXXXX\"+digits.slice(-2)}__name(maskPhone,\"maskPhone\");const upload=multer({storage:multer.memoryStorage(),limits:{fileSize:10*1024*1024}});router.post(\"/log-share\",async(req,res)=>{try{const userId=req.user.id;const{dealId,message,metadata}=req.body;if(!dealId||!message){return res.status(400).json({success:false,error:\"Missing required fields: dealId, message\"})}const{data:deal,error:dealError}=await supabase.from(\"brand_deals\").select(\"id, creator_id, status, brand_response_status\").eq(\"id\",dealId).single();if(dealError||!deal){return res.status(404).json({success:false,error:\"Deal not found\"})}if(deal.creator_id!==userId&&req.user.role!==\"admin\"){return res.status(403).json({success:false,error:\"Access denied\"})}const{data:logEntry,error:logError}=await supabase.from(\"deal_action_logs\").insert({deal_id:dealId,user_id:userId,event:\"BRAND_MESSAGE_SHARED\",metadata:{channel:metadata?.channel||\"share\",method:metadata?.method||\"unknown\",message,timestamp:metadata?.timestamp||new Date().toISOString()}}).select().single();if(logError){console.error(\"[Deals] Failed to log share:\",logError)}let updateErrorObj=null;if(deal.brand_response_status===\"accepted_verified\"){const{error:updateError}=await supabase.from(\"brand_deals\").update({updated_at:new Date().toISOString()}).eq(\"id\",dealId);if(updateError)updateErrorObj=updateError}else{const{error:updateError}=await supabase.from(\"brand_deals\").update({brand_response_status:\"pending\",status:\"Sent\",updated_at:new Date().toISOString()}).eq(\"id\",dealId);if(updateError)updateErrorObj=updateError}if(updateErrorObj){console.error(\"[Deals] Failed to update deal status:\",updateErrorObj)}return res.json({success:true,message:\"Share logged successfully\",data:logEntry})}catch(error){console.error(\"[Deals] Log share error:\",error);return res.status(500).json({success:false,error:error.message||\"Internal server error\"})}});router.post(\"/log-reminder\",authMiddleware,async(req,res)=>{try{const userId=req.user.id;const{dealId,reminder_type,message}=req.body;if(!dealId||!reminder_type||!message){return res.status(400).json({success:false,error:\"Missing required fields\"})}const{data:deal,error:dealError}=await supabase.from(\"brand_deals\").select(\"id, creator_id\").eq(\"id\",dealId).single();if(dealError||!deal){return res.status(404).json({success:false,error:\"Deal not found\"})}if(deal.creator_id!==userId&&req.user.role!==\"admin\"){return res.status(403).json({success:false,error:\"Access denied\"})}const{data:logEntry,error:logError}=await supabase.from(\"deal_action_logs\").insert({deal_id:dealId,user_id:userId,event:\"BRAND_REMINDER_SENT\",metadata:{type:reminder_type,message,timestamp:new Date().toISOString()}}).select().single();if(logError){console.error(\"[Deals] Failed to log reminder:\",logError);return res.status(500).json({success:false,error:\"Failed to log reminder\"})}await supabase.from(\"brand_deals\").update({last_reminded_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq(\"id\",dealId);return res.json({success:true,data:logEntry})}catch(error){console.error(\"[Deals] Log reminder error:\",error);return res.status(500).json({success:false,error:error.message||\"Internal server error\"})}});router.post(\"/:id/upload-signed-contract\",authMiddleware,upload.single(\"file\"),async(req,res)=>{try{const dealId=req.params.id;const userId=req.user.id;const file=req.file;if(!file){return res.status(400).json({success:false,error:\"No file uploaded\"})}const{data:deal,error:dealError}=await supabase.from(\"brand_deals\").select(\"id, creator_id\").eq(\"id\",dealId).single();if(dealError||!deal){return res.status(404).json({success:false,error:\"Deal not found\"})}if(deal.creator_id!==userId&&req.user.role!==\"admin\"){return res.status(403).json({success:false,error:\"Access denied\"})}const timestamp=Date.now();const fileName=`signed_${timestamp}_${dealId}.pdf`;const filePath=`signed-contracts/${userId}/${fileName}`;const{data:uploadData,error:uploadError}=await supabase.storage.from(\"creator-assets\").upload(filePath,file.buffer,{contentType:\"application/pdf\",upsert:false});if(uploadError){console.error(\"[Deals] Storage upload error:\",uploadError);return res.status(500).json({success:false,error:\"Failed to upload to storage\"})}const{data:urlData}=supabase.storage.from(\"creator-assets\").getPublicUrl(filePath);const{error:updateError}=await supabase.from(\"brand_deals\").update({status:\"Signed\",updated_at:new Date().toISOString()}).eq(\"id\",dealId);if(updateError){console.error(\"[Deals] Database update error:\",updateError);return res.status(500).json({success:false,error:\"Failed to update deal record\"})}await supabase.from(\"deal_action_logs\").insert({deal_id:dealId,user_id:userId,event:\"SIGNED_CONTRACT_UPLOADED\",metadata:{file_name:fileName}});return res.json({success:true,signed_contract_url:urlData.publicUrl})}catch(error){console.error(\"[Deals] Signed contract upload error:\",error);return res.status(500).json({success:false,error:error.message||\"Internal server error\"})}});router.post(\"/barter/delivery-details\",authMiddleware,async(req,res)=>{try{const userId=req.user.id;const{dealId,brandContactName,brandAddress,brandPhone,shippingRequired,barterProductValue}=req.body;if(!dealId||!brandContactName||!brandAddress){return res.status(400).json({success:false,error:\"Missing required brand details\"})}const{data:deal,error:dealError}=await supabase.from(\"brand_deals\").select(\"*, creator:profiles!creator_id(*)\").eq(\"id\",dealId).single();if(dealError||!deal){return res.status(404).json({success:false,error:\"Deal not found\"})}if(deal.creator_id!==userId&&req.user.role!==\"admin\"){return res.status(403).json({success:false,error:\"Access denied\"})}const creator=deal.creator;const creatorName=creator?`${creator.first_name||\"\"} ${creator.last_name||\"\"}`.trim():\"Creator\";const creatorAddress=creator.location||creator.address||\"\";let creatorEmail=creator?.email||req.user?.email||\"\";if(!creatorEmail){try{const{data:authUser}=await supabase.auth.admin.getUserById(userId);creatorEmail=authUser?.user?.email||\"\"}catch(e){console.error(\"[Deals] Failed to fetch creator email from auth:\",e)}}const contractResult=await generateContractFromScratch({brandName:deal.brand_name,creatorName,creatorEmail,dealAmount:0,deliverables:Array.isArray(deal.deliverables)?deal.deliverables:[String(deal.deliverables)],dueDate:deal.due_date,paymentExpectedDate:\"\",platform:deal.platform||\"Instagram\",brandEmail:deal.brand_email||void 0,brandAddress,brandGstin:void 0,creatorAddress,dealSchema:{deal_amount:0,deliverables:Array.isArray(deal.deliverables)?deal.deliverables:[String(deal.deliverables)],delivery_deadline:deal.due_date,payment:{method:\"Barter\",timeline:\"Product delivery\"},usage:{type:\"Non-exclusive\",platforms:[\"All\"],duration:\"6 months\",paid_ads:false,whitelisting:false},exclusivity:{enabled:false,category:null,duration:null},termination:{notice_days:7},jurisdiction_city:\"Mumbai\"},usageType:\"Non-exclusive\",usagePlatforms:[\"All\"],usageDuration:\"6 months\",paidAdsAllowed:false,whitelistingAllowed:false,exclusivityEnabled:false,exclusivityCategory:null,exclusivityDuration:null,terminationNoticeDays:7,jurisdictionCity:\"Mumbai\"});const fileName=`barter_contract_${Date.now()}_${dealId}.docx`;const filePath=`contracts/${userId}/${fileName}`;await supabase.storage.from(\"creator-assets\").upload(filePath,contractResult.contractDocx,{contentType:\"application/vnd.openxmlformats-officedocument.wordprocessingml.document\"});const{data:urlData}=supabase.storage.from(\"creator-assets\").getPublicUrl(filePath);const{error:updateError}=await supabase.from(\"brand_deals\").update({brand_address:brandAddress,brand_phone:brandPhone,shipping_required:!!shippingRequired,barter_value:barterProductValue||0,contract_file_url:urlData.publicUrl,contract_file_path:filePath,status:\"contract_ready\",updated_at:new Date().toISOString()}).eq(\"id\",dealId);if(updateError)throw updateError;const token=await createContractReadyToken({dealId,creatorId:userId,expiresAt:null});if(deal.brand_email){sendCollabRequestAcceptedEmail(deal.brand_email,{creatorName,brandName:deal.brand_name,dealType:\"barter\",deliverables:Array.isArray(deal.deliverables)?deal.deliverables:[String(deal.deliverables)],contractReadyToken:token.id,barterValue:barterProductValue}).catch(e=>console.error(\"[Deals] barter mail failed:\",e))}return res.json({success:true,contract_url:urlData.publicUrl})}catch(error){console.error(\"[Deals] barter delivery-details error:\",error);return res.status(500).json({success:false,error:error.message||\"Internal server error\"})}});router.patch(\"/:dealId/delivery-details\",async(req,res)=>{try{const userId=req.user.id;const{dealId}=req.params;const{delivery_name,delivery_phone,delivery_address,delivery_notes}=req.body;if(!dealId){return res.status(400).json({success:false,error:\"Deal ID is required\"})}const{data:deal,error:dealError}=await supabase.from(\"brand_deals\").select(\"id, creator_id, deal_type, brand_name, brand_email, brand_address, brand_phone, deliverables, due_date, payment_expected_date\").eq(\"id\",dealId).single();if(dealError||!deal){return res.status(404).json({success:false,error:\"Deal not found\"})}if(deal.creator_id!==userId){return res.status(403).json({success:false,error:\"Access denied\"})}if(deal.deal_type!==\"barter\"){return res.status(400).json({success:false,error:\"Delivery details are only for barter deals\"})}if(!delivery_name||typeof delivery_name!==\"string\"||!delivery_name.trim()){return res.status(400).json({success:false,error:\"Full name is required\"})}const phoneDigits=(delivery_phone||\"\").replace(/\\D/g,\"\");if(phoneDigits.length<10){return res.status(400).json({success:false,error:\"Phone number must be at least 10 digits\"})}if(!delivery_address||typeof delivery_address!==\"string\"||!delivery_address.trim()){return res.status(400).json({success:false,error:\"Delivery address is required\"})}const{error:updateError}=await supabase.from(\"brand_deals\").update({delivery_name:delivery_name.trim(),delivery_phone:delivery_phone.trim(),delivery_address:delivery_address.trim(),delivery_notes:delivery_notes?String(delivery_notes).trim():null,status:\"Awaiting Product Shipment\",shipping_required:true,shipping_status:\"pending\",updated_at:new Date().toISOString()}).eq(\"id\",dealId);if(updateError){console.error(\"[Deals] delivery-details update error:\",updateError);return res.status(500).json({success:false,error:\"Failed to save delivery details\"})}let contractUrl=null;let contractReadyToken=null;try{const{data:existingDeal}=await supabase.from(\"brand_deals\").select(\"contract_file_url\").eq(\"id\",dealId).single();if(existingDeal?.contract_file_url){contractUrl=existingDeal.contract_file_url}else{const{data:creatorProfile}=await supabase.from(\"profiles\").select(\"first_name, last_name, email\").eq(\"id\",userId).maybeSingle();const creatorName=creatorProfile?`${(creatorProfile.first_name||\"\").trim()} ${(creatorProfile.last_name||\"\").trim()}`.trim()||delivery_name.trim():delivery_name.trim();let creatorEmail=creatorProfile?.email||req.user?.email;if(!creatorEmail){try{const{data:authUser}=await supabase.auth.admin.getUserById(userId);creatorEmail=authUser?.user?.email}catch(e){console.error(\"[Deals] Failed to fetch creator email from auth:\",e)}}creatorEmail=creatorEmail||void 0;let deliverablesArray=[];try{const d=deal.deliverables;deliverablesArray=typeof d===\"string\"?d.includes(\"[\")?JSON.parse(d):d.split(\",\").map(s=>s.trim()):d||[]}catch{deliverablesArray=[String(deal.deliverables)]}const dueDate=deal.due_date||deal.payment_expected_date;const dueDateStr=dueDate?new Date(dueDate).toLocaleDateString():void 0;const maskedPhone=maskPhone(delivery_phone);const BARTER_DISPATCH_DAYS=7;const productDeliveryTerms=[`1. Product Delivery: The brand must dispatch the barter product to the creator within ${BARTER_DISPATCH_DAYS} days of contract signing. A tracking ID must be shared with the creator when applicable.`,`2. Product Condition: The product must match the description and agreed value. The creator may reject damaged or incorrect items.`,`3. Delivery Confirmation: The creator confirms receipt inside the Creator Armour dashboard. The content timeline starts only after this confirmation.`,`4. Non-Delivery: If the product is not delivered within the agreed timeline, the creator may cancel the collaboration and the brand loses collaboration rights under this agreement.`,`5. No Product, No Content: The creator is not obligated to deliver content until the product has been received and confirmed.`,`Delivery address: ${delivery_address.trim()}. Contact (masked): ${maskedPhone}.`].join(\"\\n\\n\");const dealSchema={deal_amount:0,deliverables:deliverablesArray.length>0?deliverablesArray:[\"As per agreement\"],delivery_deadline:dueDate||new Date(Date.now()+30*24*60*60*1e3).toISOString().split(\"T\")[0],payment:{method:\"Barter\",timeline:\"Product shipment within 7 days\"},usage:{type:\"Non-exclusive\",platforms:[\"All platforms\"],duration:\"6 months\",paid_ads:false,whitelisting:false},exclusivity:{enabled:false,category:null,duration:null},termination:{notice_days:7},jurisdiction_city:\"Mumbai\"};const canGenerateContract=deal.brand_name&&deal.brand_email&&deal.brand_address&&creatorName&&creatorEmail&&delivery_address.trim();if(canGenerateContract){const contractResult=await generateContractFromScratch({brandName:deal.brand_name,creatorName,creatorEmail,dealAmount:0,deliverables:deliverablesArray.length>0?deliverablesArray:[\"As per agreement\"],paymentTerms:\"Barter \\u2013 product shipment within 7 days of acceptance.\",dueDate:dueDateStr,paymentExpectedDate:dueDateStr,platform:\"Multiple Platforms\",brandEmail:deal.brand_email||void 0,brandAddress:deal.brand_address||void 0,brandPhone:deal.brand_phone||void 0,creatorAddress:delivery_address.trim(),dealSchema,usageType:\"Non-exclusive\",usagePlatforms:[\"All platforms\"],usageDuration:\"6 months\",paidAdsAllowed:false,whitelistingAllowed:false,exclusivityEnabled:false,exclusivityCategory:null,exclusivityDuration:null,terminationNoticeDays:7,jurisdictionCity:\"Mumbai\",additionalTerms:productDeliveryTerms});const storagePath=`contracts/${dealId}/${Date.now()}_${contractResult.fileName}`;const{error:uploadError}=await supabase.storage.from(\"creator-assets\").upload(storagePath,contractResult.contractDocx,{contentType:\"application/vnd.openxmlformats-officedocument.wordprocessingml.document\",upsert:false});if(uploadError){console.error(\"[Deals] delivery-details contract upload error:\",uploadError)}else{const{data:publicUrlData}=supabase.storage.from(\"creator-assets\").getPublicUrl(storagePath);contractUrl=publicUrlData?.publicUrl||null;await supabase.from(\"brand_deals\").update({contract_file_url:contractUrl,contract_file_path:storagePath,updated_at:new Date().toISOString()}).eq(\"id\",dealId);const token=await createContractReadyToken({dealId,creatorId:userId,expiresAt:null});contractReadyToken=token.id;if(deal.brand_email&&contractReadyToken&&contractUrl){sendCollabRequestAcceptedEmail(deal.brand_email,{creatorName,brandName:deal.brand_name,dealAmount:0,dealType:\"barter\",deliverables:deliverablesArray.length>0?deliverablesArray:[\"As per agreement\"],contractReadyToken,contractUrl}).catch(e=>console.error(\"[Deals] delivery-details acceptance email failed:\",e))}}}else{console.log(\"[Deals] Skipping contract generation due to missing info:\",{hasBrandName:!!deal.brand_name,hasBrandEmail:!!deal.brand_email,hasBrandAddress:!!deal.brand_address,hasCreatorName:!!creatorName,hasCreatorEmail:!!creatorEmail,hasCreatorAddress:!!delivery_address.trim()})}try{const{token:shippingToken}=await createShippingToken({dealId});const frontendUrl=process.env.FRONTEND_URL||\"https://creatorarmour.com\";const shippingLink=`${frontendUrl}/ship/${shippingToken}`;const productDescription=deliverablesArray.length>0?deliverablesArray.join(\", \"):\"Product\";if(deal.brand_email){sendBrandShippingUpdateEmail(deal.brand_email,{brandName:deal.brand_name,creatorName,productDescription,shippingLink}).catch(e=>console.error(\"[Deals] delivery-details shipping email failed:\",e))}}catch(shippingTokenErr){console.error(\"[Deals] delivery-details shipping token/email error:\",shippingTokenErr)}}}catch(contractErr){console.error(\"[Deals] delivery-details contract generation error:\",contractErr);const errorMsg=contractErr.missingFields?`Missing required details for contract: ${contractErr.missingFields.join(\", \")}`:\"Delivery details saved but contract generation failed. Brand info might be incomplete.\";return res.status(500).json({success:false,error:errorMsg})}return res.json({success:true,deal:{id:dealId},contract:contractUrl?{url:contractUrl,token:contractReadyToken}:null,message:\"Delivery details saved. Contract generated.\"})}catch(error){console.error(\"[Deals] delivery-details error:\",error);return res.status(500).json({success:false,error:\"Internal server error\"})}});router.patch(\"/:dealId/shipping/update\",async(req,res)=>{try{const{dealId}=req.params;const{status,tracking_number,courier_name}=req.body;const{error:updateError}=await supabase.from(\"brand_deals\").update({shipping_status:status,tracking_number,courier_name,updated_at:new Date().toISOString()}).eq(\"id\",dealId);if(updateError)throw updateError;await supabase.from(\"deal_action_logs\").insert({deal_id:dealId,event:\"shipping_status_updated\",metadata:{status,tracking_number}});return res.json({success:true,message:`Shipping status updated to ${status}`})}catch(error){console.error(\"[Deals] shipping update error:\",error);return res.status(500).json({success:false,error:error.message||\"Internal server error\"})}});const confirmReceivedHandler=__name(async(req,res)=>{try{const dealId=req.params.id||req.params.dealId;const userId=req.user.id;if(!dealId){return res.status(400).json({success:false,error:\"Deal ID is required\"})}const{data:deal,error:dealError}=await supabase.from(\"brand_deals\").select(\"id, creator_id, deal_type, shipping_required, shipping_status\").eq(\"id\",dealId).single();if(dealError||!deal){return res.status(404).json({success:false,error:\"Deal not found\"})}const dealData=deal;if(dealData.creator_id!==userId&&req.user.role!==\"admin\"){return res.status(403).json({success:false,error:\"Access denied\"})}if(dealData.deal_type!==\"barter\"||!dealData.shipping_required){return res.status(400).json({success:false,error:\"Shipping confirmation is only for barter deals with shipping\"})}const now=new Date().toISOString();const{error:updateError}=await supabase.from(\"brand_deals\").update({shipping_status:\"delivered\",delivered_at:now,updated_at:now}).eq(\"id\",dealId);if(updateError)throw updateError;await supabase.from(\"deal_action_logs\").insert({deal_id:dealId,user_id:userId,event:\"shipping_confirmed_delivered\",metadata:{}});try{const{data:brandDeal}=await supabase.from(\"brand_deals\").select(\"brand_name\").eq(\"id\",dealId).single();const result=await supabase.from(\"profiles\").select(\"email, first_name, last_name\").eq(\"id\",userId).single();const profile=result.data;if(profile&&profile.email){const creatorName=`${profile.first_name||\"\"} ${profile.last_name||\"\"}`.trim()||\"Creator\";const{sendCreatorDeliveryConfirmedEmail}=await import(\"../services/shippingEmailService.js\").then(s=>{const e=\"default\";return s[e]&&typeof s[e]==\"object\"&&\"__esModule\"in s[e]?s[e]:s});sendCreatorDeliveryConfirmedEmail(profile.email,creatorName,brandDeal?.brand_name||\"Brand\",dealId).catch(e=>console.error(\"[Deals] Delivery confirmation email failed:\",e))}}catch(emailErr){console.warn(\"[Deals] Failed to trigger delivery confirmation email:\",emailErr)}return res.json({success:true,message:\"Product receipt confirmed\"})}catch(error){console.error(\"[Deals] confirm-received error:\",error);return res.status(500).json({success:false,error:error.message||\"Internal server error\"})}},\"confirmReceivedHandler\");router.patch(\"/:id/shipping/confirm-received\",confirmReceivedHandler);router.patch(\"/:dealId/shipping/confirm-received\",confirmReceivedHandler);router.post(\"/:id/confirm-receipt\",confirmReceivedHandler);router.post(\"/:dealId/regenerate-contract\",async(req,res)=>{try{const userId=req.user.id;const{dealId}=req.params;if(!dealId){return res.status(400).json({success:false,error:\"Deal ID is required\"})}const{data:deal,error:dealError}=await supabase.from(\"brand_deals\").select(\"*\").eq(\"id\",dealId).single();if(dealError||!deal){return res.status(404).json({success:false,error:\"Deal not found\"})}if(deal.creator_id!==userId&&req.user.role!==\"admin\"){return res.status(403).json({success:false,error:\"Access denied\"})}const{data:creatorProfile}=await supabase.from(\"profiles\").select(\"first_name, last_name, location\").eq(\"id\",userId).maybeSingle();const creatorName=creatorProfile?`${(creatorProfile.first_name||\"\").trim()} ${(creatorProfile.last_name||\"\").trim()}`.trim()||\"Creator\":\"Creator\";const creatorEmail=creatorProfile?.email||req.user?.email||void 0;const creatorAddress=creatorProfile?.location||creatorProfile?.address||void 0;let deliverablesArray=[];try{if(typeof deal.deliverables===\"string\"){if(deal.deliverables.startsWith(\"[\")&&deal.deliverables.endsWith(\"]\")){deliverablesArray=JSON.parse(deal.deliverables)}else{deliverablesArray=deal.deliverables.split(\",\").map(s=>s.trim())}}else{deliverablesArray=deal.deliverables||[]}}catch{deliverablesArray=[String(deal.deliverables)]}const dueDateStr=deal.due_date?new Date(deal.due_date).toLocaleDateString():void 0;const paymentExpectedDateStr=deal.payment_expected_date?new Date(deal.payment_expected_date).toLocaleDateString():void 0;const contractResult=await generateContractFromScratch({brandName:deal.brand_name,creatorName,creatorEmail,dealAmount:deal.deal_amount,deliverables:deliverablesArray.length>0?deliverablesArray:[\"As per agreement\"],dueDate:dueDateStr,paymentExpectedDate:paymentExpectedDateStr,platform:deal.platform||\"Multiple Platforms\",brandEmail:deal.brand_email||void 0,brandAddress:deal.brand_address||void 0,brandPhone:deal.brand_phone||void 0,creatorAddress,dealSchema:{deal_amount:deal.deal_amount,deliverables:deliverablesArray.length>0?deliverablesArray:[\"As per agreement\"],delivery_deadline:deal.due_date||new Date(Date.now()+30*24*60*60*1e3).toISOString().split(\"T\")[0],payment:{method:\"Bank Transfer\",timeline:paymentExpectedDateStr?`Payment by ${paymentExpectedDateStr}`:\"Within 7 days of content delivery\"},usage:{type:\"Non-exclusive\",platforms:[\"All platforms\"],duration:\"6 months\",paid_ads:false,whitelisting:false},exclusivity:{enabled:false,category:null,duration:null},termination:{notice_days:7},jurisdiction_city:\"Mumbai\"},usageType:\"Non-exclusive\",usagePlatforms:[\"All platforms\"],usageDuration:\"6 months\",paidAdsAllowed:false,whitelistingAllowed:false,exclusivityEnabled:false,exclusivityCategory:null,exclusivityDuration:null,terminationNoticeDays:7,jurisdictionCity:\"Mumbai\"});const timestamp=Date.now();const storagePath=`contracts/${dealId}/${timestamp}_${contractResult.fileName}`;const{error:uploadError}=await supabase.storage.from(\"creator-assets\").upload(storagePath,contractResult.contractDocx,{contentType:\"application/vnd.openxmlformats-officedocument.wordprocessingml.document\",upsert:false});if(uploadError){throw uploadError}const{data:publicUrlData}=supabase.storage.from(\"creator-assets\").getPublicUrl(storagePath);const contractUrl=publicUrlData?.publicUrl;if(!contractUrl){throw new Error(\"Failed to get public URL for contract\")}await supabase.from(\"brand_deals\").update({contract_file_url:contractUrl,updated_at:new Date().toISOString()}).eq(\"id\",dealId);const token=await createContractReadyToken({dealId,creatorId:userId,expiresAt:null});if(deal.brand_email&&token.id){sendCollabRequestAcceptedEmail(deal.brand_email,{creatorName,brandName:deal.brand_name,dealAmount:deal.deal_amount,dealType:deal.deal_type||\"paid\",deliverables:deliverablesArray.length>0?deliverablesArray:[\"As per agreement\"],contractReadyToken:token.id,contractUrl}).catch(e=>console.error(\"[Deals] Regenerate contract email failed:\",e))}return res.json({success:true,contract:{url:contractUrl,token:token.id},message:\"Contract regenerated and sent to brand.\"})}catch(error){console.error(\"[Deals] Regenerate contract error:\",error);return res.status(500).json({success:false,error:error.message||\"Internal server error\"})}});router.patch(\"/:dealId/shipping/report-issue\",async(req,res)=>{try{const userId=req.user.id;const{dealId}=req.params;const{reason}=req.body;const reasonStr=String(reason||\"No reason specified\");const{data:deal,error:dealError}=await supabase.from(\"brand_deals\").select(\"id, creator_id, brand_name, brand_email\").eq(\"id\",dealId).single();if(dealError||!deal){return res.status(404).json({success:false,error:\"Deal not found\"})}if(deal.creator_id!==userId&&req.user.role!==\"admin\"){return res.status(403).json({success:false,error:\"Access denied\"})}const{error:updateError}=await supabase.from(\"brand_deals\").update({shipping_status:\"issue_reported\",updated_at:new Date().toISOString()}).eq(\"id\",dealId);if(updateError){return res.status(500).json({success:false,error:\"Failed to update\"})}try{await supabase.from(\"deal_action_logs\").insert({deal_id:dealId,event:\"shipping_issue_reported\",metadata:{reason:reasonStr}})}catch(e){console.warn(\"[Deals] shipping audit log failed:\",e)}if(deal.brand_email){const{data:profile}=await supabase.from(\"profiles\").select(\"first_name, last_name\").eq(\"id\",userId).maybeSingle();const creatorName=profile?`${(profile.first_name||\"\").trim()} ${(profile.last_name||\"\").trim()}`.trim()||\"Creator\":\"Creator\";sendBrandShippingIssueEmail(deal.brand_email,{brandName:deal.brand_name||\"Brand\",creatorName,reason:reasonStr}).catch(e=>console.error(\"[Deals] shipping issue email failed:\",e))}return res.json({success:true,message:\"Issue reported. The brand has been notified.\"})}catch(error){console.error(\"[Deals] shipping report-issue error:\",error);return res.status(500).json({success:false,error:error.message||\"Internal server error\"})}});router.post(\"/:id/sign-creator\",async(req,res)=>{try{const dealId=req.params.id;const userId=req.user.id;const{signerName,signerEmail,contractSnapshotHtml}=req.body;if(!signerName||!signerEmail){return res.status(400).json({success:false,error:\"Missing required fields: signerName and signerEmail\"})}const{data:deal,error:dealError}=await supabase.from(\"brand_deals\").select(\"creator_otp_verified, creator_otp_verified_at, creator_id\").eq(\"id\",dealId).maybeSingle();if(dealError||!deal){return res.status(404).json({success:false,error:\"Deal not found\"})}const dealData=deal;if(dealData.creator_id!==userId&&req.user.role!==\"admin\"){return res.status(403).json({success:false,error:\"Access denied\"})}if(!deal.creator_otp_verified){return res.status(400).json({success:false,error:\"OTP verification is required before signing. Please verify your email first.\"})}const signResult=await signContractAsCreator({dealId,creatorId:userId,signerName,signerEmail,contractSnapshotHtml,ipAddress:getClientIp(req),userAgent:req.headers[\"user-agent\"]||\"unknown\",deviceInfo:getDeviceInfo(req.headers[\"user-agent\"]||\"unknown\"),otpVerified:true,otpVerifiedAt:deal.creator_otp_verified_at});if(!signResult.success){return res.status(500).json({success:false,error:signResult.error||\"Failed to sign contract\"})}return res.json({success:true,message:\"Contract signed successfully\",signature:signResult.signature})}catch(error){console.error(\"[Deals] Sign-creator error:\",error);return res.status(500).json({success:false,error:error.message||\"Internal server error\"})}});router.get(\"/test-routing\",(req,res)=>{console.log(\"[Deals] Test routing endpoint hit\");res.json({success:true,message:\"Deals router is working\",timestamp:new Date().toISOString()})});var deals_default=router;export{deals_default as default};\n","warnings":[],"map":{"version":3,"mappings":"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","names":[],"ignoreList":[],"sources":["/Users/pratyushraj/Documents/noticebazaar/server/src/routes/deals.ts"],"sourcesContent":[null]}}