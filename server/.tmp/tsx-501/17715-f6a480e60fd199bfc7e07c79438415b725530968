{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import{getInfluencersFromDatabase}from\"./influencerFinder.js\";const log={info:__name((message,data)=>{console.log(`[InfluencerSheets] ${message}`,data||\"\")},\"info\"),error:__name((message,error)=>{console.error(`[InfluencerSheets] ERROR: ${message}`,error||\"\")},\"error\"),warn:__name((message,data)=>{console.warn(`[InfluencerSheets] WARN: ${message}`,data||\"\")},\"warn\")};const SHEET_ALL_INFLUENCERS=\"All Influencers\";const SHEET_HIGH_FIT=\"High Fit (7+)\";async function exportToGoogleSheets(influencers,outreachMessages,config){if(!config?.spreadsheetId){log.warn(\"No spreadsheet ID provided, skipping export\");return}log.info(\"Exporting to Google Sheets\",{count:influencers.length,spreadsheetId:config.spreadsheetId});const deduplicated=deduplicateInfluencers(influencers);log.info(`Deduplicated ${influencers.length} to ${deduplicated.length} influencers`);const highFit=deduplicated.filter(i=>i.fit_score>=7);if(config.credentials){await exportViaServiceAccount(deduplicated,highFit,outreachMessages,config);return}if(config.apiKey){await exportViaApiKey(deduplicated,highFit,outreachMessages,config);return}log.info(\"No credentials provided, generating CSV instead\");const csvAll=generateCSV(deduplicated,outreachMessages);const csvHighFit=generateCSV(highFit,outreachMessages);log.info(\"CSV data generated\",{all_influencers_rows:deduplicated.length,high_fit_rows:highFit.length});console.log(\"\\n=== All Influencers CSV ===\");console.log(csvAll);console.log(\"\\n=== High Fit (7+) CSV ===\");console.log(csvHighFit)}__name(exportToGoogleSheets,\"exportToGoogleSheets\");async function exportViaServiceAccount(allInfluencers,highFit,outreachMessages,config){try{const{google}=await import(\"googleapis\").then(s=>{const e=\"default\";return s[e]&&typeof s[e]==\"object\"&&\"__esModule\"in s[e]?s[e]:s});const auth=new google.auth.JWT({email:config.credentials.client_email,key:config.credentials.private_key.replace(/\\\\n/g,\"\\n\"),scopes:[\"https://www.googleapis.com/auth/spreadsheets\"]});const sheets=google.sheets({version:\"v4\",auth});await ensureSheetsExist(sheets,config.spreadsheetId);await writeToSheet(sheets,config.spreadsheetId,SHEET_ALL_INFLUENCERS,allInfluencers,outreachMessages);await writeToSheet(sheets,config.spreadsheetId,SHEET_HIGH_FIT,highFit,outreachMessages);log.info(\"Successfully exported to Google Sheets\")}catch(error){log.error(\"Error exporting via service account\",error.message);if(error.message?.includes(\"Cannot find module\")){log.error(\"googleapis not installed. Run: npm install googleapis\")}throw error}}__name(exportViaServiceAccount,\"exportViaServiceAccount\");async function ensureSheetsExist(sheets,spreadsheetId){try{const{google}=await import(\"googleapis\").then(s=>{const e=\"default\";return s[e]&&typeof s[e]==\"object\"&&\"__esModule\"in s[e]?s[e]:s});const spreadsheet=await sheets.spreadsheets.get({spreadsheetId});const existingSheets=spreadsheet.data.sheets.map(s=>s.properties.title);const sheetsToCreate=[SHEET_ALL_INFLUENCERS,SHEET_HIGH_FIT].filter(name=>!existingSheets.includes(name));if(sheetsToCreate.length>0){await sheets.spreadsheets.batchUpdate({spreadsheetId,requestBody:{requests:sheetsToCreate.map(title=>({addSheet:{properties:{title}}}))}});log.info(`Created sheets: ${sheetsToCreate.join(\", \")}`)}}catch(error){log.error(\"Error ensuring sheets exist\",error.message);throw error}}__name(ensureSheetsExist,\"ensureSheetsExist\");async function writeToSheet(sheets,spreadsheetId,sheetName,influencers,outreachMessages){const headers=getSheetHeaders();const rows=influencers.map(influencer=>{const message=outreachMessages?.get(influencer.instagram_handle);return influencerToRow(influencer,message)});await sheets.spreadsheets.values.clear({spreadsheetId,range:`${sheetName}!A:Z`});await sheets.spreadsheets.values.update({spreadsheetId,range:`${sheetName}!A1`,valueInputOption:\"RAW\",requestBody:{values:[headers,...rows]}});log.info(`Wrote ${rows.length} rows to sheet: ${sheetName}`)}__name(writeToSheet,\"writeToSheet\");async function exportViaApiKey(allInfluencers,highFit,outreachMessages,config){log.info(\"API key export - not yet implemented\");throw new Error(\"API key export not yet implemented\")}__name(exportViaApiKey,\"exportViaApiKey\");function generateCSV(influencers,outreachMessages){const headers=getSheetHeaders();const rows=influencers.map(influencer=>{const message=outreachMessages?.get(influencer.instagram_handle);return influencerToRow(influencer,message)});return[headers.join(\",\"),...rows.map(row=>row.join(\",\"))].join(\"\\n\")}__name(generateCSV,\"generateCSV\");function getSheetHeaders(){return[\"creator_name\",\"instagram_handle\",\"followers\",\"niche\",\"fit_score\",\"email\",\"website\",\"manager_email\",\"profile_link\",\"bio\",\"link_in_bio\",\"location\",\"is_india_based\",\"is_relevant_niche\",\"is_active\",\"status\",\"source\",\"contacted_at\",\"last_dm_sent_at\",\"follow_up_due_at\",\"response_status\",\"outreach_message\",\"search_keywords\",\"last_checked_at\",\"created_at\"]}__name(getSheetHeaders,\"getSheetHeaders\");function influencerToRow(influencer,message){return[escapeCSV(influencer.creator_name),escapeCSV(influencer.instagram_handle),influencer.followers.toString(),escapeCSV(influencer.niche||\"\"),influencer.fit_score.toString(),escapeCSV(influencer.email||\"\"),escapeCSV(influencer.website||\"\"),escapeCSV(influencer.manager_email||\"\"),escapeCSV(influencer.profile_link),escapeCSV(influencer.bio||\"\"),escapeCSV(influencer.link_in_bio||\"\"),escapeCSV(influencer.location||\"\"),influencer.is_india_based?\"TRUE\":\"FALSE\",influencer.is_relevant_niche?\"TRUE\":\"FALSE\",influencer.is_active?\"TRUE\":\"FALSE\",escapeCSV(influencer.status||\"new\"),escapeCSV(influencer.source||\"manual\"),escapeCSV(influencer.contacted_at||\"\"),escapeCSV(influencer.last_dm_sent_at||\"\"),escapeCSV(influencer.follow_up_due_at||\"\"),escapeCSV(influencer.response_status||\"\"),escapeCSV(message?.message||\"\"),escapeCSV((influencer.search_keywords||[]).join(\", \")),escapeCSV(influencer.last_checked_at||\"\"),escapeCSV(influencer.created_at||\"\")]}__name(influencerToRow,\"influencerToRow\");function escapeCSV(value){if(!value)return\"\";const escaped=value.replace(/\"/g,'\"\"').replace(/\\n/g,\" \");if(escaped.includes(\",\")||escaped.includes('\"')||escaped.includes(\" \")){return`\"${escaped}\"`}return escaped}__name(escapeCSV,\"escapeCSV\");function deduplicateInfluencers(influencers){const seen=new Map;for(const influencer of influencers){const handle=influencer.instagram_handle.toLowerCase();const existing=seen.get(handle);if(!existing||influencer.fit_score>existing.fit_score){seen.set(handle,influencer)}}return Array.from(seen.values())}__name(deduplicateInfluencers,\"deduplicateInfluencers\");async function syncDatabaseToSheets(config,filters){log.info(\"Syncing database to Google Sheets\",{filters});const influencers=await getInfluencersFromDatabase({minFitScore:filters?.minFitScore,status:filters?.status,limit:1e4});const outreachMessages=new Map;if(filters?.status===\"contacted\"){const{generateBatchOutreachMessages}=await import(\"./influencerOutreach.js\").then(s=>{const e=\"default\";return s[e]&&typeof s[e]==\"object\"&&\"__esModule\"in s[e]?s[e]:s});const messages=await generateBatchOutreachMessages(influencers);messages.forEach((msg,handle)=>outreachMessages.set(handle,msg))}await exportToGoogleSheets(influencers,outreachMessages,config);log.info(\"Sync complete\",{count:influencers.length})}__name(syncDatabaseToSheets,\"syncDatabaseToSheets\");async function autoSyncToSheets(config){log.info(\"Starting auto-sync to Google Sheets\");try{await syncDatabaseToSheets(config);await syncDatabaseToSheets(config,{minFitScore:7});log.info(\"Auto-sync complete\")}catch(error){log.error(\"Auto-sync failed\",error);throw error}}__name(autoSyncToSheets,\"autoSyncToSheets\");async function importFromGoogleSheets(config){log.info(\"Import from sheets - not yet implemented\");return[]}__name(importFromGoogleSheets,\"importFromGoogleSheets\");export{autoSyncToSheets,exportToGoogleSheets,generateCSV,importFromGoogleSheets,syncDatabaseToSheets};\n","warnings":[],"map":{"version":3,"mappings":"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","names":[],"ignoreList":[],"sources":["/Users/pratyushraj/Documents/noticebazaar/server/src/services/influencerSheets.ts"],"sourcesContent":[null]}}