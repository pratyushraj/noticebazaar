{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import{getCTATrustLine,getEmailLayout,getEmailProgressCue,getEmailSignal,getPrimaryCTA}from\"./professionalEmailTemplates.js\";async function sendBrandFormSubmissionEmail(creatorEmail,creatorName,brandData,dealId){try{const apiKey=process.env.RESEND_API_KEY;if(!apiKey||apiKey===\"your_resend_api_key_here\"||apiKey.trim()===\"\"){console.error(\"[BrandFormSubmissionEmail] API key not configured or is placeholder\");return{success:false,error:\"Resend API key is not configured. Please set RESEND_API_KEY in server/.env\"}}const emailRegex=/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;if(!emailRegex.test(creatorEmail)){return{success:false,error:\"Invalid email address format\"}}const url=\"https://api.resend.com/emails\";const deliverablesList=brandData.deliverables.map((d,idx)=>{if(typeof d===\"object\"&&d.platform&&d.contentType){return`${idx+1}. ${d.quantity||1} ${d.contentType} on ${d.platform}${d.duration?` (${d.duration}s)`:\"\"}`}return`${idx+1}. ${typeof d===\"string\"?d:JSON.stringify(d)}`}).join(\"<br>\");const dealAmount=brandData.dealType===\"paid\"&&brandData.paymentAmount?`\\u20B9${parseFloat(brandData.paymentAmount.toString()).toLocaleString(\"en-IN\")}`:brandData.dealType===\"barter\"?\"Barter Deal\":\"Not specified\";const deadlineText=brandData.deadline?new Date(brandData.deadline).toLocaleDateString(\"en-IN\",{day:\"numeric\",month:\"long\",year:\"numeric\"}):\"Not specified\";const dealLink=dealId?`${process.env.FRONTEND_URL||\"https://creatorarmour.com\"}/creator-contracts/${dealId}`:`${process.env.FRONTEND_URL||\"https://creatorarmour.com\"}/creator-contracts`;const emailSubject=`New Collaboration Request from ${brandData.brandName}`;const emailContent=`\n      <tr>\n        <td style=\"background-color: #5b21b6; padding: 48px 30px; text-align: center;\">\n          <div style=\"width: 70px; height: 70px; margin: 0 auto 16px auto; border-radius: 18px; background-color: rgba(255, 255, 255, 0.16); display: inline-block; line-height: 70px;\">\n            <span style=\"font-size: 30px; color: #ffffff;\">\\u2728</span>\n          </div>\n          <h1 style=\"margin: 0 0 8px 0; font-size: 24px; font-weight: 700; color: #ffffff !important; line-height: 1.3;\">\n            New collaboration request\n          </h1>\n          <p style=\"margin: 0; font-size: 14px; color: #ffffff !important; opacity: 0.95;\">\n            ${brandData.brandName} sent you deal details\n          </p>\n        </td>\n      </tr>\n      <tr>\n        <td style=\"padding: 24px 32px 6px 32px;\">\n          <p style=\"margin: 0 0 10px 0; font-size: 16px; font-weight: 600; color: #111827;\">Hello ${creatorName||\"there\"},</p>\n          <p style=\"margin: 0; font-size: 14px; color: #4b5563; line-height: 1.7;\">\n            Great news! ${brandData.brandName} submitted their collaboration details through your link. Review the deal and generate a protected contract to move forward.\n          </p>\n        </td>\n      </tr>\n      ${getEmailSignal({type:\"action\",message:\"Review the details and generate a contract before the brand loses momentum.\"})}\n      ${getEmailProgressCue([{label:\"Request In\",status:\"completed\"},{label:\"Review & Contract\",status:\"current\"},{label:\"Brand Signs\",status:\"upcoming\"}])}\n      <tr>\n        <td style=\"padding: 20px 32px 0 32px;\">\n          <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"background-color: #f8fafc; border: 1px solid #e5e7eb; border-radius: 12px; padding: 16px;\">\n            <tr>\n              <td style=\"font-size: 13px; font-weight: 700; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; padding-bottom: 12px;\">Deal Summary</td>\n            </tr>\n            <tr>\n              <td>\n                <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"border-collapse: collapse;\">\n                  <tr>\n                    <td style=\"padding: 10px 0; color: #6b7280; font-size: 13px; width: 38%; font-weight: 600;\">Brand</td>\n                    <td style=\"padding: 10px 0; color: #111827; font-size: 14px; font-weight: 600;\">${brandData.brandName}</td>\n                  </tr>\n                  ${brandData.campaignName?`\n                  <tr>\n                    <td style=\"padding: 10px 0; color: #6b7280; font-size: 13px; font-weight: 600;\">Campaign</td>\n                    <td style=\"padding: 10px 0; color: #111827; font-size: 14px;\">${brandData.campaignName}</td>\n                  </tr>\n                  `:\"\"}\n                  <tr>\n                    <td style=\"padding: 10px 0; color: #6b7280; font-size: 13px; font-weight: 600;\">Deal type</td>\n                    <td style=\"padding: 10px 0; color: #111827; font-size: 14px; text-transform: capitalize;\">${brandData.dealType}</td>\n                  </tr>\n                  <tr>\n                    <td style=\"padding: 10px 0; color: #6b7280; font-size: 13px; font-weight: 600;\">Deal value</td>\n                    <td style=\"padding: 10px 0; color: #111827; font-size: 14px; font-weight: 700;\">${dealAmount}</td>\n                  </tr>\n                  <tr>\n                    <td style=\"padding: 10px 0; color: #6b7280; font-size: 13px; font-weight: 600;\">Deadline</td>\n                    <td style=\"padding: 10px 0; color: #111827; font-size: 14px;\">${deadlineText}</td>\n                  </tr>\n                </table>\n              </td>\n            </tr>\n          </table>\n        </td>\n      </tr>\n      <tr>\n        <td style=\"padding: 16px 32px 0 32px;\">\n          <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"background-color: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 16px;\">\n            <tr>\n              <td style=\"font-size: 13px; font-weight: 700; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; padding-bottom: 10px;\">Deliverables</td>\n            </tr>\n            <tr>\n              <td style=\"color: #4b5563; font-size: 14px; line-height: 1.7;\">\n                ${deliverablesList||\"No deliverables specified\"}\n              </td>\n            </tr>\n          </table>\n        </td>\n      </tr>\n      ${getPrimaryCTA(\"Review & Create Contract\",dealLink)}\n      ${getCTATrustLine(\"Contracts are auto-logged and provide legal protection.\")}\n      <tr>\n        <td style=\"padding: 0 32px 28px 32px;\">\n          <p style=\"margin: 0; font-size: 13px; color: #6b7280; line-height: 1.6;\">\n            Once you generate the contract, we\\u2019ll notify the brand instantly. Reply in-app if they request changes.\n          </p>\n        </td>\n      </tr>\n    `;const emailHtml=getEmailLayout({content:emailContent,showFooter:true,backgroundStyle:\"purple\"});const requestBody={from:\"CreatorArmour <noreply@creatorarmour.com>\",to:creatorEmail,subject:emailSubject,html:emailHtml};console.log(\"[BrandFormSubmissionEmail] Sending notification email:\",{creatorEmail,brandName:brandData.brandName,hasApiKey:!!apiKey});const response=await fetch(url,{method:\"POST\",headers:{\"Authorization\":`Bearer ${apiKey}`,\"Content-Type\":\"application/json\"},body:JSON.stringify(requestBody)});if(!response.ok){const errorText=await response.text().catch(()=>\"\");let errorMessage=`Resend API error: ${response.status} ${response.statusText}`;let parsedError={};try{parsedError=JSON.parse(errorText)}catch(e){}if(response.status===401){errorMessage=\"Resend API authentication failed. Please check your RESEND_API_KEY\"}else if(response.status===403){errorMessage=\"Resend API access forbidden. Please check your API key permissions.\"}else if(response.status===422&&parsedError.message){errorMessage=`Resend API validation error: ${parsedError.message}`}else if(parsedError.message){errorMessage=`Resend API error: ${parsedError.message}`}console.error(\"[BrandFormSubmissionEmail] API error:\",{status:response.status,statusText:response.statusText,body:errorText});return{success:false,error:errorMessage}}const data=await response.json();console.log(\"[BrandFormSubmissionEmail] Email sent successfully:\",{emailId:data.id,creatorEmail});if(data.id){return{success:true,emailId:data.id}}else if(data.error){return{success:false,error:data.error.message||\"Failed to send notification email\"}}else{return{success:false,error:\"Unexpected response from Resend API\"}}}catch(error){console.error(\"[BrandFormSubmissionEmail] Exception:\",error);return{success:false,error:`Failed to send notification email: ${error.message||\"Unknown error\"}`}}}__name(sendBrandFormSubmissionEmail,\"sendBrandFormSubmissionEmail\");export{sendBrandFormSubmissionEmail};\n","warnings":[],"map":{"version":3,"mappings":"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","names":[],"ignoreList":[],"sources":["/Users/pratyushraj/Documents/noticebazaar/server/src/services/brandFormSubmissionEmailService.ts"],"sourcesContent":[null]}}