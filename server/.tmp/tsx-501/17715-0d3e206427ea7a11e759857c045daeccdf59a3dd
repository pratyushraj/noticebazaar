{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import express from\"express\";import crypto from\"crypto\";import{supabase}from\"../lib/supabase.js\";import{sendOTPEmail}from\"../services/otpEmailService.js\";import{authMiddleware}from\"../middleware/auth.js\";const router=express.Router();router.get(\"/test-resend\",async(req,res)=>{try{const testEmail=req.query.email||\"notice3@yopmail.com\";console.log(\"[OTP Test] Attempting direct Resend test to:\",testEmail);await sendOTPEmail(testEmail,\"123456\");return res.json({success:true,message:\"Test email sent successfully\"})}catch(err){console.error(\"[OTP Test] direct Resend test failed:\",err);return res.status(500).json({success:false,error:err.message})}});const sendRateStore={};const SEND_WINDOW_MS=10*60*1e3;const SEND_MAX=5;const SEND_COOLDOWN_MS=60*1e3;function generateOTP(){return Math.floor(1e5+Math.random()*9e5).toString()}__name(generateOTP,\"generateOTP\");function hashOTP(otp){return crypto.createHash(\"sha256\").update(otp).digest(\"hex\")}__name(hashOTP,\"hashOTP\");async function logDealAction(dealId,event,metadata={}){try{await supabase.from(\"deal_action_logs\").insert({deal_id:dealId,event,metadata})}catch(error){console.error(\"[OTP] Failed to log deal action:\",error)}}__name(logDealAction,\"logDealAction\");router.post(\"/send\",async(req,res)=>{try{const{token,email}=req.body;const ip=req.headers[\"x-forwarded-for\"]?.toString()||req.ip||\"unknown\";if(!token||!email){return res.status(400).json({success:false,error:\"Token and email are required\"})}const emailKey=String(email).trim().toLowerCase();const rateKey=`${emailKey}:${ip}`;const now=Date.now();const entry=sendRateStore[rateKey];if(!entry||now>entry.resetAt){sendRateStore[rateKey]={count:1,resetAt:now+SEND_WINDOW_MS,lastSentAt:now}}else{if(now-entry.lastSentAt<SEND_COOLDOWN_MS){return res.status(429).json({success:false,error:\"Please wait before requesting another OTP.\",retryAfter:Math.ceil((SEND_COOLDOWN_MS-(now-entry.lastSentAt))/1e3)})}if(entry.count>=SEND_MAX){return res.status(429).json({success:false,error:\"Too many OTP requests. Please try again later.\",retryAfter:Math.ceil((entry.resetAt-now)/1e3)})}entry.count+=1;entry.lastSentAt=now}let tokenData=null;let tokenType=\"creator_signing\";let emailField=\"creator_email\";const{data:creatorTokenData,error:creatorTokenError}=await supabase.from(\"creator_signing_tokens\").select(\"*\").eq(\"token\",token).eq(\"is_valid\",true).maybeSingle();if(creatorTokenData){tokenData=creatorTokenData;tokenType=\"creator_signing\";emailField=\"creator_email\"}else{const{data:contractTokenData,error:contractTokenError}=await supabase.from(\"contract_ready_tokens\").select(\"*, brand_deals!inner(brand_email)\").eq(\"id\",token).eq(\"is_valid\",true).maybeSingle();if(contractTokenData){tokenData=contractTokenData;tokenType=\"contract_ready\";emailField=\"brand_email\"}}if(!tokenData){console.error(\"[OTP] Token not found in either table:\",token);return res.status(404).json({success:false,error:\"Invalid or expired signing link\"})}let expectedEmail;if(tokenType===\"creator_signing\"){expectedEmail=tokenData.creator_email}else{expectedEmail=tokenData.brand_deals?.brand_email||\"\"}if(!expectedEmail||expectedEmail.toLowerCase()!==email.toLowerCase()){console.error(\"[OTP] Email mismatch:\",{expected:expectedEmail,provided:email,tokenType});return res.status(403).json({success:false,error:\"Email does not match authorized signer\"})}const otp=generateOTP();const otpHash=hashOTP(otp);const expiresAt=new Date(Date.now()+10*60*1e3);let updateError=null;if(tokenType===\"creator_signing\"){const{error}=await supabase.from(\"creator_signing_tokens\").update({creator_otp_hash:otpHash,creator_otp_expires_at:expiresAt.toISOString(),creator_otp_attempts:0,updated_at:new Date().toISOString()}).eq(\"id\",tokenData.id);updateError=error}else{const{error}=await supabase.from(\"contract_ready_tokens\").update({otp_hash:otpHash,otp_expires_at:expiresAt.toISOString(),otp_attempts:0,updated_at:new Date().toISOString()}).eq(\"id\",tokenData.id);updateError=error}if(updateError){console.error(\"[OTP] Error storing OTP:\",updateError);return res.status(500).json({success:false,error:\"Failed to generate OTP\"})}try{await sendOTPEmail(email,otp);console.log(\"[OTP] OTP sent successfully to:\",email,\"for token type:\",tokenType);let phoneNumber=null;if(tokenType===\"creator_signing\"&&tokenData.profiles?.phone){phoneNumber=tokenData.profiles.phone}else if(tokenType===\"contract_ready_tokens\"&&tokenData.brand_deals?.brand_phone){phoneNumber=tokenData.brand_deals.brand_phone}if(phoneNumber){import(\"../services/msg91Service.js\").then(s=>{const e=\"default\";return s[e]&&typeof s[e]==\"object\"&&\"__esModule\"in s[e]?s[e]:s}).then(async({sendOTPviaWhatsApp})=>{try{const waResult=await sendOTPviaWhatsApp(phoneNumber,otp);if(waResult.success){console.log(\"[OTP] WhatsApp OTP sent successfully to:\",phoneNumber)}else{console.warn(\"[OTP] Failed to send WhatsApp OTP:\",waResult.error)}}catch(waError){console.error(\"[OTP] Check: Error sending WhatsApp OTP:\",waError)}})}}catch(emailError){console.error(\"[OTP] Error sending email:\",emailError);return res.status(500).json({success:false,error:\"Failed to send OTP email\"})}res.json({success:true,message:\"OTP sent successfully\",expiresAt:expiresAt.toISOString(),tokenType})}catch(error){console.error(\"[OTP] Send error:\",error);res.status(500).json({success:false,error:\"Failed to send OTP\"})}});router.post(\"/verify\",async(req,res)=>{try{const{token,otp}=req.body;if(!token||!otp){return res.status(400).json({success:false,error:\"Token and OTP are required\"})}let tokenData=null;let tokenType=\"creator_signing\";const{data:creatorTokenData,error:creatorTokenError}=await supabase.from(\"creator_signing_tokens\").select(\"*, profiles(phone)\").eq(\"token\",token).eq(\"is_valid\",true).maybeSingle();if(creatorTokenData){tokenData=creatorTokenData;tokenType=\"creator_signing\"}else{const{data:contractTokenData,error:contractTokenError}=await supabase.from(\"contract_ready_tokens\").select(\"*, brand_deals!inner(brand_email, brand_phone)\").eq(\"id\",token).eq(\"is_valid\",true).maybeSingle();if(contractTokenData){tokenData=contractTokenData;tokenType=\"contract_ready\"}}if(!tokenData){console.error(\"[OTP] Verify: Token not found in either table:\",token);return res.status(404).json({success:false,error:\"Invalid or expired signing link\"})}const otpHashField=tokenType===\"creator_signing\"?\"creator_otp_hash\":\"otp_hash\";const otpExpiresField=tokenType===\"creator_signing\"?\"creator_otp_expires_at\":\"otp_expires_at\";const otpAttemptsField=tokenType===\"creator_signing\"?\"creator_otp_attempts\":\"otp_attempts\";const storedHash=tokenData[otpHashField];const storedExpires=tokenData[otpExpiresField];const storedAttempts=tokenData[otpAttemptsField]||0;if(!storedHash||!storedExpires){return res.status(400).json({success:false,error:\"No OTP found. Please request a new one.\"})}if(new Date(storedExpires)<new Date){return res.status(400).json({success:false,error:\"OTP has expired. Please request a new one.\"})}if(storedAttempts>=5){return res.status(429).json({success:false,error:\"Too many failed attempts. Please request a new OTP.\"})}const otpHash=hashOTP(otp);if(otpHash!==storedHash){if(tokenType===\"creator_signing\"){await supabase.from(\"creator_signing_tokens\").update({creator_otp_attempts:storedAttempts+1}).eq(\"id\",tokenData.id)}else{await supabase.from(\"contract_ready_tokens\").update({otp_attempts:storedAttempts+1}).eq(\"id\",tokenData.id)}return res.status(400).json({success:false,error:\"Invalid OTP. Please try again.\",attemptsRemaining:5-storedAttempts-1})}if(tokenType===\"creator_signing\"){await supabase.from(\"creator_signing_tokens\").update({creator_otp_verified:true,creator_otp_verified_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq(\"id\",tokenData.id)}else{await supabase.from(\"contract_ready_tokens\").update({otp_verified:true,otp_verified_at:new Date().toISOString()}).eq(\"id\",tokenData.id)}console.log(\"[OTP] OTP verified successfully for token type:\",tokenType);res.json({success:true,message:\"OTP verified successfully\",tokenType})}catch(error){console.error(\"[OTP] Verify error:\",error);res.status(500).json({success:false,error:\"Failed to verify OTP\"})}});router.post(\"/send-creator\",authMiddleware,async(req,res)=>{try{console.log(\"[OTP] Received send-creator request for dealId:\",req.body?.dealId,\"from user:\",req.user?.id);if(!req.user||!req.user.id){console.warn(\"[OTP] send-creator failed: No user in request\");return res.status(401).json({success:false,error:\"Authentication required\"})}const{dealId}=req.body;if(!dealId){console.warn(\"[OTP] send-creator failed: Missing dealId in body\");return res.status(400).json({success:false,error:\"Missing required field: dealId\"})}const{data:deal,error:dealError}=await supabase.from(\"brand_deals\").select(\"*\").eq(\"id\",dealId).maybeSingle();if(dealError||!deal){console.warn(\"[OTP] send-creator failed: Deal not found or error:\",dealError);return res.status(404).json({success:false,error:\"Deal not found\"})}if(deal.creator_id!==req.user.id&&req.user?.role!==\"admin\"){console.warn(\"[OTP] send-creator failed: Access denied. Deal creator:\",deal.creator_id,\"User:\",req.user.id);return res.status(403).json({success:false,error:\"Access denied\"})}const{data:authUser,error:authError}=await supabase.auth.admin.getUserById(req.user.id);if(authError){console.error(\"[OTP] Error fetching user from auth:\",authError);return res.status(500).json({success:false,error:\"Failed to fetch user information\"})}if(!authUser?.user?.email){console.error(\"[OTP] Creator email not found for user:\",req.user.id);return res.status(404).json({success:false,error:\"Creator email not found. Please ensure your account has a valid email address.\"})}const creatorEmail=authUser.user.email.trim();const emailRegex=/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;if(!emailRegex.test(creatorEmail)){console.error(\"[OTP] Invalid email format:\",creatorEmail);return res.status(400).json({success:false,error:\"Invalid email address format\"})}const otp=generateOTP();const otpHash=hashOTP(otp);const expiresAt=new Date(Date.now()+10*60*1e3);try{await sendOTPEmail(creatorEmail,otp);console.log(\"[OTP] Creator OTP sent successfully to:\",creatorEmail);try{const{data:profile}=await supabase.from(\"profiles\").select(\"phone\").eq(\"id\",req.user.id).single();if(profile?.phone){import(\"../services/msg91Service.js\").then(s=>{const e=\"default\";return s[e]&&typeof s[e]==\"object\"&&\"__esModule\"in s[e]?s[e]:s}).then(async({sendOTPviaWhatsApp})=>{const waResult=await sendOTPviaWhatsApp(profile.phone,otp);if(waResult.success){console.log(\"[OTP] Creator WhatsApp OTP sent successfully\")}else{console.warn(\"[OTP] Failed to send Creator WhatsApp OTP:\",waResult.error)}})}}catch(waError){console.error(\"[OTP] Error attempting WhatsApp sending:\",waError)}}catch(emailError){console.error(\"[OTP] Failed to send OTP email:\",emailError);return res.status(500).json({success:false,error:emailError.message||\"Failed to send OTP email\"})}const updateData={creator_otp_hash:otpHash,creator_otp_expires_at:expiresAt.toISOString(),creator_otp_attempts:0,creator_otp_verified:false,updated_at:new Date().toISOString()};const{error:updateError}=await supabase.from(\"brand_deals\").update(updateData).eq(\"id\",dealId);if(updateError){console.error(\"[OTP] Failed to update deal:\",updateError);return res.status(500).json({success:false,error:`Failed to save OTP: ${updateError.message}`})}await logDealAction(dealId,\"CREATOR_OTP_SENT\",{email:creatorEmail.replace(/(.{2})(.*)(@.*)/,\"$1***$3\")});return res.json({success:true,message:\"OTP sent successfully to your email\",expiresAt:expiresAt.toISOString()})}catch(error){console.error(\"[OTP] send-creator error:\",error);return res.status(500).json({success:false,error:error.message||\"Internal server error\"})}});router.post(\"/verify-creator\",authMiddleware,async(req,res)=>{try{if(!req.user||!req.user.id){return res.status(401).json({success:false,error:\"Authentication required\"})}const{dealId,otp}=req.body;if(!dealId||!otp){return res.status(400).json({success:false,error:\"Missing required fields: dealId and otp\"})}if(!/^\\d{6}$/.test(otp)){return res.status(400).json({success:false,error:\"Invalid OTP format. OTP must be 6 digits\"})}const{data:deal,error:dealError}=await supabase.from(\"brand_deals\").select(\"*\").eq(\"id\",dealId).maybeSingle();if(dealError||!deal){return res.status(404).json({success:false,error:\"Deal not found\"})}if(deal.creator_id!==req.user.id&&req.user?.role!==\"admin\"){return res.status(403).json({success:false,error:\"Access denied\"})}const storedHash=deal.creator_otp_hash;if(!storedHash){return res.status(400).json({success:false,error:\"No OTP found. Please request a new OTP\"})}if(deal.creator_otp_verified===true){return res.status(400).json({success:false,error:\"OTP has already been verified\"})}const expiresAt=deal.creator_otp_expires_at;if(expiresAt){const expirationTime=new Date(expiresAt);const now=new Date;if(now>expirationTime){return res.status(400).json({success:false,error:\"OTP has expired. Please request a new OTP\"})}}const attempts=deal.creator_otp_attempts||0;if(attempts>=5){return res.status(429).json({success:false,error:\"Maximum OTP verification attempts exceeded. Please request a new OTP\"})}const inputHash=hashOTP(otp);const isValid=crypto.timingSafeEqual(Buffer.from(storedHash),Buffer.from(inputHash));if(!isValid){const newAttempts=attempts+1;await supabase.from(\"brand_deals\").update({creator_otp_attempts:newAttempts,updated_at:new Date().toISOString()}).eq(\"id\",dealId);await logDealAction(dealId,\"CREATOR_OTP_FAILED_ATTEMPT\",{attempts:newAttempts});return res.status(400).json({success:false,error:`Invalid OTP. ${5-newAttempts} attempts remaining`,attemptsRemaining:5-newAttempts})}const updateData={creator_otp_verified:true,creator_otp_verified_at:new Date().toISOString(),updated_at:new Date().toISOString()};const{error:updateError}=await supabase.from(\"brand_deals\").update(updateData).eq(\"id\",dealId);if(updateError){console.error(\"[OTP] Failed to update deal:\",updateError);return res.status(500).json({success:false,error:`Failed to verify OTP: ${updateError.message}`})}await logDealAction(dealId,\"CREATOR_OTP_VERIFIED\",{verifiedAt:updateData.creator_otp_verified_at});console.log(\"[OTP] Creator OTP verified successfully for deal:\",dealId);return res.json({success:true,message:\"OTP verified successfully\",verifiedAt:updateData.creator_otp_verified_at})}catch(error){console.error(\"[OTP] verify-creator error:\",error);return res.status(500).json({success:false,error:error.message||\"Internal server error\"})}});var otp_default=router;export{otp_default as default};\n","warnings":[],"map":{"version":3,"mappings":"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","names":[],"ignoreList":[],"sources":["/Users/pratyushraj/Documents/noticebazaar/server/src/routes/otp.ts"],"sourcesContent":[null]}}