{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import{Document,Packer,Paragraph,HeadingLevel,AlignmentType}from\"docx\";async function generateContractDocx(htmlContent){try{const contractContent=extractContractContent(htmlContent);const docxElements=parseHtmlToDocx(contractContent);const doc=new Document({sections:[{children:docxElements}]});const buffer=await Packer.toBuffer(doc);return buffer}catch(error){console.error(\"[DocxGenerator] Error generating DOCX:\",error);if(error.message?.includes(\"Cannot find module\")||error.code===\"MODULE_NOT_FOUND\"){throw new Error(\"DOCX generation requires docx package. Please run: npm install docx\")}throw new Error(`Failed to generate DOCX: ${error.message||\"Unknown error\"}`)}}__name(generateContractDocx,\"generateContractDocx\");function extractContractContent(htmlContent){let cleanHtml=htmlContent.replace(/<div class=\"print-actions[^\"]*\">[\\s\\S]*?<\\/div>/gi,\"\").replace(/<[^>]*class=\"[^\"]*no-print[^\"]*\"[^>]*>[\\s\\S]*?<\\/[^>]+>/gi,\"\").replace(/<script[\\s\\S]*?<\\/script>/gi,\"\");const containerMatch=cleanHtml.match(/<div class=\"contract-container\">([\\s\\S]*?)<\\/div>/);if(containerMatch){cleanHtml=containerMatch[1]}else{const bodyMatch=cleanHtml.match(/<body[^>]*>([\\s\\S]*?)<\\/body>/);if(bodyMatch){cleanHtml=bodyMatch[1]}}return cleanHtml}__name(extractContractContent,\"extractContractContent\");function parseHtmlToDocx(html){const elements=[];const blocks=html.split(/(<(?:h[1-6]|p|ul|ol|div)[^>]*>)/i);let i=0;while(i<blocks.length){const block=blocks[i];if(!block||block.trim()===\"\"){i++;continue}const h1Match=block.match(/<h1[^>]*>(.*?)<\\/h1>/is);if(h1Match){elements.push(new Paragraph({text:stripHtml(h1Match[1]),heading:HeadingLevel.HEADING_1,alignment:AlignmentType.CENTER,spacing:{before:800,after:240}}));i++;continue}const h2Match=block.match(/<h2[^>]*>(.*?)<\\/h2>/is);if(h2Match){elements.push(new Paragraph({text:stripHtml(h2Match[1]),heading:HeadingLevel.HEADING_2,spacing:{before:720,after:360}}));i++;continue}const h3Match=block.match(/<h3[^>]*>(.*?)<\\/h3>/is);if(h3Match){elements.push(new Paragraph({text:stripHtml(h3Match[1]),heading:HeadingLevel.HEADING_3,spacing:{before:300,after:150}}));i++;continue}const ulMatch=block.match(/<ul[^>]*>([\\s\\S]*?)<\\/ul>/i);if(ulMatch){const listItems=ulMatch[1].match(/<li[^>]*>(.*?)<\\/li>/gis)||[];listItems.forEach(item=>{const itemText=stripHtml(item.replace(/<li[^>]*>|<\\/li>/gi,\"\"));if(itemText.trim()){elements.push(new Paragraph({text:`\\u2022 ${itemText}`,spacing:{after:100},indent:{left:360}}))}});i++;continue}const olMatch=block.match(/<ol[^>]*>([\\s\\S]*?)<\\/ol>/i);if(olMatch){const listItems=olMatch[1].match(/<li[^>]*>(.*?)<\\/li>/gis)||[];listItems.forEach((item,index)=>{const itemText=stripHtml(item.replace(/<li[^>]*>|<\\/li>/gi,\"\"));if(itemText.trim()){elements.push(new Paragraph({text:`${index+1}. ${itemText}`,spacing:{after:100},indent:{left:360}}))}});i++;continue}const separatorMatch=block.match(/<p[^>]*class=\"[^\"]*section-separator-line[^\"]*\"[^>]*>/i);if(separatorMatch){elements.push(new Paragraph({text:\"\",spacing:{before:720,after:720},border:{top:{color:\"CCCCCC\",size:240,style:\"single\"}}}));i++;continue}const pMatch=block.match(/<p[^>]*>(.*?)<\\/p>/is);if(pMatch){const text2=stripHtml(pMatch[1]);if(text2.trim()){elements.push(new Paragraph({text:text2,spacing:{after:280}}))}i++;continue}const text=stripHtml(block);if(text.trim()&&!text.match(/^<[^>]+>$/)){elements.push(new Paragraph({text,spacing:{after:200}}))}i++}return elements}__name(parseHtmlToDocx,\"parseHtmlToDocx\");function stripHtml(html){return html.replace(/<[^>]+>/g,\"\").replace(/&nbsp;/g,\" \").replace(/&amp;/g,\"&\").replace(/&lt;/g,\"<\").replace(/&gt;/g,\">\").replace(/&quot;/g,'\"').replace(/&#39;/g,\"'\").replace(/\\s+/g,\" \").trim()}__name(stripHtml,\"stripHtml\");function prepareHtmlForDocx(htmlContent){const containerMatch=htmlContent.match(/<div class=\"contract-container\">([\\s\\S]*?)<\\/div>/);const contractContent=containerMatch?containerMatch[1]:htmlContent;return`<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <style>\n    body {\n      font-family: 'Times New Roman', serif;\n      font-size: 11pt;\n      line-height: 1.8;\n      margin: 0;\n      padding: 0;\n    }\n    h1 {\n      font-size: 18pt;\n      font-weight: bold;\n      text-align: center;\n      margin: 20px 0;\n    }\n    h2 {\n      font-size: 14pt;\n      font-weight: bold;\n      margin-top: 24px;\n      margin-bottom: 12px;\n    }\n    h3 {\n      font-size: 12pt;\n      font-weight: bold;\n      margin-top: 18px;\n      margin-bottom: 10px;\n    }\n    p {\n      margin: 12px 0;\n      text-align: left;\n    }\n    ul, ol {\n      margin: 12px 0;\n      padding-left: 36px;\n    }\n    li {\n      margin: 6px 0;\n    }\n  </style>\n</head>\n<body>\n  ${contractContent}\n</body>\n</html>`}__name(prepareHtmlForDocx,\"prepareHtmlForDocx\");export{generateContractDocx,prepareHtmlForDocx};\n","warnings":[],"map":{"version":3,"mappings":"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","names":["text"],"ignoreList":[],"sources":["/Users/pratyushraj/Documents/noticebazaar/server/src/services/docxGenerator.ts"],"sourcesContent":[null]}}