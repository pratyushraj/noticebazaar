{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import{findInfluencers,saveInfluencersToDatabase}from\"./influencerFinder.js\";import{autoSyncToSheets}from\"./influencerSheets.js\";const DEFAULT_HASHTAGS=[\"fitnessindia\",\"fashionindia\",\"techcreator\",\"lifestyleindia\",\"beautyindia\",\"ugccreator\"];const DEFAULT_KEYWORDS=[\"influencer\",\"content creator\",\"creator\",\"indian creator\"];const DEFAULT_OPTIONS={minFollowers:1e4,maxFollowers:5e5,limit:30};const log={info:__name((message,data)=>{console.log(`[InfluencerScheduler] ${message}`,data||\"\")},\"info\"),error:__name((message,error)=>{console.error(`[InfluencerScheduler] ERROR: ${message}`,error||\"\")},\"error\"),warn:__name((message,data)=>{console.warn(`[InfluencerScheduler] WARN: ${message}`,data||\"\")},\"warn\")};async function runDailyScan(hashtags,keywords,options){const startTime=Date.now();const errors=[];log.info(\"Starting daily scan\",{hashtags:hashtags||DEFAULT_HASHTAGS,keywords:keywords||DEFAULT_KEYWORDS,options:options||DEFAULT_OPTIONS});try{const searchHashtags=hashtags||DEFAULT_HASHTAGS;const searchKeywords=keywords||DEFAULT_KEYWORDS;const searchOptions={...DEFAULT_OPTIONS,...options};const influencers=await findInfluencers(searchHashtags,searchKeywords,searchOptions);log.info(`Found ${influencers.length} qualified influencers`);let savedCount=0;try{await saveInfluencersToDatabase(influencers);savedCount=influencers.length;log.info(`Saved ${savedCount} influencers to database`)}catch(error){const errorMsg=`Error saving to database: ${error.message}`;errors.push(errorMsg);log.error(errorMsg,error)}if(process.env.GOOGLE_SHEETS_SPREADSHEET_ID){try{const sheetsConfig={spreadsheetId:process.env.GOOGLE_SHEETS_SPREADSHEET_ID,credentials:process.env.GOOGLE_SHEETS_CREDENTIALS?JSON.parse(process.env.GOOGLE_SHEETS_CREDENTIALS):void 0,apiKey:process.env.GOOGLE_SHEETS_API_KEY};await autoSyncToSheets(sheetsConfig);log.info(\"Synced to Google Sheets\")}catch(error){const errorMsg=`Error syncing to Google Sheets: ${error.message}`;errors.push(errorMsg);log.error(errorMsg,error)}}const duration=Date.now()-startTime;const result={success:errors.length===0,influencersFound:influencers.length,influencersSaved:savedCount,errors,timestamp:new Date().toISOString(),duration_ms:duration};log.info(\"Daily scan completed\",result);return result}catch(error){const duration=Date.now()-startTime;errors.push(`Fatal error: ${error.message}`);log.error(\"Daily scan failed\",error);return{success:false,influencersFound:0,influencersSaved:0,errors,timestamp:new Date().toISOString(),duration_ms:duration}}}__name(runDailyScan,\"runDailyScan\");function setupDailyScheduler(){if(process.env.VERCEL||process.env.RENDER){log.info(\"Serverless environment detected - use external cron service\");log.info(\"Set up cron job to call: POST /api/influencers/run-daily-scan\");return}try{import(\"node-cron\").then(s=>{const e=\"default\";return s[e]&&typeof s[e]==\"object\"&&\"__esModule\"in s[e]?s[e]:s}).then(cron=>{cron.default.schedule(\"30 3 * * *\",async()=>{log.info(\"Running scheduled daily scan\");try{await runDailyScan()}catch(error){log.error(\"Scheduled daily scan failed\",error)}},{timezone:\"Asia/Kolkata\"});log.info(\"Daily scheduler set up - will run at 9 AM IST\")}).catch(()=>{log.warn(\"node-cron not installed - scheduler not started\");log.warn(\"Install with: npm install node-cron\");log.warn(\"Or use external cron service to call POST /api/influencers/run-daily-scan\")})}catch(error){log.error(\"Error setting up scheduler\",error)}}__name(setupDailyScheduler,\"setupDailyScheduler\");if(process.env.NODE_ENV!==\"test\"&&!process.env.VERCEL&&!process.env.RENDER){}export{runDailyScan,setupDailyScheduler};\n","warnings":[],"map":{"version":3,"mappings":"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","names":[],"ignoreList":[],"sources":["/Users/pratyushraj/Documents/noticebazaar/server/src/services/influencerScheduler.ts"],"sourcesContent":[null]}}