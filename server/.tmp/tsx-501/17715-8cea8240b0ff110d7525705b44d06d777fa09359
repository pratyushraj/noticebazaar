{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import express from\"express\";import multer from\"multer\";import crypto from\"crypto\";import{supabase,supabaseInitialized}from\"../lib/supabase.js\";import{generateContractFromScratch}from\"../services/contractGenerator.js\";import{createContractReadyToken}from\"../services/contractReadyTokenService.js\";import{sendCollabRequestSubmissionEmail,sendCollabRequestAcceptedEmail,sendCollabRequestCounterEmail,sendCollabRequestDeclinedEmail,sendCollabRequestCreatorNotificationEmail,sendCollabAcceptMagicLinkEmail,sendCollabDraftResumeEmail}from\"../services/collabRequestEmailService.js\";import{resolveOrCreateBrandContact}from\"../services/brandContactService.js\";import{estimateBarterValueRange,estimateReelBudgetRange,estimateReelRate,getEffectiveReelRate}from\"../services/creatorRateService.js\";import{fetchInstagramPublicData}from\"../services/instagramService.js\";const router=express.Router();const barterImageUpload=multer({storage:multer.memoryStorage(),limits:{fileSize:5*1024*1024}});function hashIp(ip){if(!ip||ip===\"unknown\")return\"unknown\";const parts=ip.split(\".\");if(parts.length>=3){return`${parts[0]}.${parts[1]}.${parts[2]}.xxx`}return crypto.createHash(\"sha256\").update(ip).digest(\"hex\").substring(0,16)+\"...\"}__name(hashIp,\"hashIp\");function detectDeviceType(userAgent){if(!userAgent)return\"unknown\";const ua=userAgent.toLowerCase();if(ua.includes(\"mobile\")||ua.includes(\"android\")||ua.includes(\"iphone\")){return\"mobile\"}if(ua.includes(\"tablet\")||ua.includes(\"ipad\")){return\"tablet\"}if(ua.includes(\"desktop\")||ua.includes(\"windows\")||ua.includes(\"macintosh\")||ua.includes(\"linux\")){return\"desktop\"}return\"unknown\"}__name(detectDeviceType,\"detectDeviceType\");router.get(\"/:username/resume\",async(req,res)=>{try{const{username}=req.params;const token=typeof req.query.token===\"string\"?req.query.token.trim():\"\";if(!username||!token){return res.status(400).json({success:false,error:\"Username and token are required\"})}console.warn(\"[CollabRequests] Resume draft feature disabled: collab_request_drafts table missing\");return res.status(501).json({success:false,error:\"Drafts are currently disabled\"})}catch(e){console.error(\"[CollabRequests] Resume draft error:\",e);return res.status(500).json({success:false,error:\"Failed to load draft\"})}});router.post(\"/:username/save-draft\",async(req,res)=>{try{const{username}=req.params;const{email,formData}=req.body||{};if(!username||username.trim()===\"\"){return res.status(400).json({success:false,error:\"Username is required\"})}const emailStr=typeof email===\"string\"?email.trim():\"\";if(!emailStr||!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(emailStr)){return res.status(400).json({success:false,error:\"Valid email is required\"})}const payload=typeof formData===\"object\"&&formData!==null?formData:{};const resumeToken=crypto.randomBytes(24).toString(\"hex\");const expiresAt=new Date(Date.now()+7*24*60*60*1e3);const normalizedUsername=username.toLowerCase().trim();console.warn(\"[CollabRequests] Save draft feature disabled: collab_request_drafts table missing\");return res.status(501).json({success:false,error:\"Drafts are currently disabled\"});const frontendUrl=process.env.FRONTEND_URL||\"https://creatorarmour.com\";const resumeUrl=`${frontendUrl}/collab/${encodeURIComponent(normalizedUsername)}?resume=${encodeURIComponent(resumeToken)}`;let creatorName=\"the creator\";const profileRes=await supabase.from(\"profiles\").select(\"first_name, last_name, business_name\").or(`username.eq.${normalizedUsername},instagram_handle.eq.${normalizedUsername}`).eq(\"role\",\"creator\").maybeSingle();if(profileRes.data){const p=profileRes.data;creatorName=p.business_name||[p.first_name,p.last_name].filter(Boolean).join(\" \")||\"the creator\"}const emailResult=await sendCollabDraftResumeEmail(emailStr,creatorName,resumeUrl);if(!emailResult.success){console.error(\"[CollabRequests] Draft resume email failed:\",emailResult.error)}return res.json({success:true,message:\"Check your email for a link to continue your request.\"})}catch(e){console.error(\"[CollabRequests] Save draft error:\",e);return res.status(500).json({success:false,error:\"Failed to save draft\"})}});router.get(\"/accept/preview/:requestToken\",async(req,res)=>{try{const requestToken=typeof req.params.requestToken===\"string\"?req.params.requestToken.trim():\"\";if(!requestToken){return res.status(400).json({success:false,error:\"Invalid link\"})}console.warn(\"[CollabRequests] Accept link preview disabled: collab_accept_tokens table missing\");return res.status(404).json({success:false,error:\"Please log in to your dashboard to handle this request.\"});const expiresAt=new Date(tokenRow.expires_at);if(expiresAt.getTime()<Date.now()){return res.status(410).json({success:false,error:\"expired\",message:\"This link has expired\"})}const{data:request,error:reqError}=await supabase.from(\"collab_requests\").select(\"id, brand_name, collab_type, exact_budget, barter_value, barter_description, deliverables, deadline, status\").eq(\"id\",tokenRow.collab_request_id).maybeSingle();if(reqError||!request){return res.status(404).json({success:false,error:\"Request not found\"})}if(request.status!==\"pending\"){return res.status(200).json({success:true,alreadyHandled:true,status:request.status,message:\"This request has already been handled\",brand_name:request.brand_name,collab_type:request.collab_type,deliverables:request.deliverables||[],deadline:request.deadline,amount:request.exact_budget??request.barter_value??null})}let deliverablesArray=[];try{deliverablesArray=Array.isArray(request.deliverables)?request.deliverables:typeof request.deliverables===\"string\"?JSON.parse(request.deliverables):[]}catch{deliverablesArray=[]}const dealType=request.collab_type===\"barter\"?\"Barter\":request.collab_type===\"paid\"?\"Paid\":\"Paid / Barter\";const amount=request.collab_type===\"barter\"?request.barter_value??null:request.exact_budget??null;return res.json({success:true,alreadyHandled:false,brand_name:request.brand_name,collab_type:request.collab_type,deal_type_label:dealType,amount,deliverables:deliverablesArray,deadline:request.deadline,creator_email:tokenRow.creator_email,expires_at:tokenRow.expires_at})}catch(e){console.error(\"[CollabRequests] Accept preview error:\",e);return res.status(500).json({success:false,error:\"Something went wrong\"})}});router.post(\"/accept/send-verification\",async(req,res)=>{try{const{requestToken}=req.body||{};const tokenStr=typeof requestToken===\"string\"?requestToken.trim():\"\";if(!tokenStr){return res.status(400).json({success:false,error:\"Invalid link\"})}console.warn(\"[CollabRequests] Magic link verification disabled: collab_accept_tokens table missing\");return res.status(404).json({success:false,error:\"Feature unavailable. Please log in to your dashboard.\"});const expiresAt=new Date(tokenRow.expires_at);if(expiresAt.getTime()<Date.now()){return res.status(410).json({success:false,error:\"This link has expired\"})}const{data:request}=await supabase.from(\"collab_requests\").select(\"id, status\").eq(\"id\",tokenRow.collab_request_id).maybeSingle();if(!request||request.status!==\"pending\"){return res.status(400).json({success:false,error:\"This request has already been handled\"})}const frontendUrl=(process.env.FRONTEND_URL||\"https://creatorarmour.com\").replace(/\\/$/,\"\");const redirectTo=`${frontendUrl}/collab/accept/${encodeURIComponent(tokenStr)}?verified=true`;const{data:linkData,error:linkError}=await supabase.auth.admin.generateLink({type:\"magiclink\",email:tokenRow.creator_email,options:{redirectTo}});const magicLink=linkData?.properties?.action_link??linkData?.action_link;if(linkError||!magicLink){console.error(\"[CollabRequests] Magic link generate error:\",linkError);return res.status(500).json({success:false,error:\"Failed to send verification email\"})}const emailResult=await sendCollabAcceptMagicLinkEmail(tokenRow.creator_email,magicLink);if(!emailResult.success){console.error(\"[CollabRequests] Magic link email failed:\",emailResult.error);return res.status(500).json({success:false,error:\"Failed to send verification email\"})}return res.json({success:true,message:\"Verification link sent to your email\"})}catch(e){console.error(\"[CollabRequests] Send verification error:\",e);return res.status(500).json({success:false,error:\"Something went wrong\"})}});router.get(\"/:username\",async(req,res)=>{try{const{username}=req.params;if(!username||username.trim()===\"\"){return res.status(400).json({success:false,error:\"Username is required\"})}const normalizedUsername=username.toLowerCase().trim();const baseProfileSelect=`\n      id,\n      first_name,\n      last_name,\n      business_name,\n      instagram_handle,\n      bio,\n      username\n    `;const{data:usernameProfiles,error:usernameError}=await supabase.from(\"profiles\").select(baseProfileSelect).eq(\"username\",normalizedUsername).eq(\"role\",\"creator\").limit(1);let profile=usernameProfiles&&usernameProfiles.length>0?usernameProfiles[0]:null;let profileError=usernameError;if(!profile&&!profileError){const{data:instagramProfiles,error:instagramError}=await supabase.from(\"profiles\").select(baseProfileSelect).eq(\"instagram_handle\",normalizedUsername).eq(\"role\",\"creator\").limit(1);profile=instagramProfiles&&instagramProfiles.length>0?instagramProfiles[0]:null;profileError=instagramError}if(profile&&!profileError){const{data:extendedProfile}=await supabase.from(\"profiles\").select(`\n          creator_category,\n          youtube_channel_id,\n          tiktok_handle,\n          twitter_handle,\n          facebook_profile_url,\n          instagram_followers,\n          instagram_profile_photo,\n          last_instagram_sync,\n          youtube_subs,\n          tiktok_followers,\n          twitter_followers,\n          facebook_followers,\n          open_to_collabs,\n          content_niches,\n          media_kit_url,\n          avg_rate_reel,\n          learned_avg_rate_reel,\n          learned_deal_count\n      `).eq(\"id\",profile.id).maybeSingle();if(extendedProfile){profile={...profile,...extendedProfile}}const{data:trustArraysProfile}=await supabase.from(\"profiles\").select(\"past_brands, recent_campaign_types\").eq(\"id\",profile.id).maybeSingle();if(trustArraysProfile){const nextProfile={...profile};if(Array.isArray(trustArraysProfile.past_brands)){nextProfile.past_brands=trustArraysProfile.past_brands}if(Array.isArray(trustArraysProfile.recent_campaign_types)){nextProfile.recent_campaign_types=trustArraysProfile.recent_campaign_types}profile=nextProfile}}if(profileError){console.error(\"[CollabRequests] Error fetching creator:\",profileError);console.error(\"[CollabRequests] Error code:\",profileError.code);console.error(\"[CollabRequests] Error message:\",profileError.message);console.error(\"[CollabRequests] Error details:\",JSON.stringify(profileError,null,2));console.error(\"[CollabRequests] Username searched:\",username.toLowerCase().trim());console.error(\"[CollabRequests] Supabase client initialized:\",supabaseInitialized);const isDev=process.env.NODE_ENV===\"development\"||!process.env.NODE_ENV;return res.status(500).json({success:false,error:\"Failed to fetch creator profile\",details:isDev?{message:profileError.message,code:profileError.code,hint:profileError.hint,details:profileError.details,fullError:JSON.stringify(profileError,null,2)}:{code:profileError.code,message:profileError.message}})}if(!profile){console.log(\"[CollabRequests] Creator not found in profiles table, trying Instagram fallback for username:\",normalizedUsername);let instagramData=null;try{instagramData=await fetchInstagramPublicData(normalizedUsername)}catch(fallbackError){console.warn(\"[CollabRequests] Instagram fallback failed:\",fallbackError?.message||fallbackError)}const suggestedReelRate2=estimateReelRate(instagramData?.followers??0);const suggestedPaidRange2=estimateReelBudgetRange(suggestedReelRate2);const suggestedBarterRange2=estimateBarterValueRange(suggestedReelRate2);const fallbackName=instagramData?.full_name&&instagramData.full_name.trim()||normalizedUsername.split(/[._-]+/).filter(Boolean).map(part=>part.charAt(0).toUpperCase()+part.slice(1)).join(\" \")||normalizedUsername;let performanceProof2=null;try{const{data:latestSnapshot}=await supabase.from(\"instagram_performance_snapshots\").select(\"engagement_rate, median_reel_views, avg_likes, avg_comments, avg_saves, avg_shares, sample_size, data_quality, captured_at\").eq(\"ig_username\",normalizedUsername).order(\"captured_at\",{ascending:false}).limit(1).maybeSingle();if(latestSnapshot){performanceProof2={engagement_rate:latestSnapshot.engagement_rate,median_reel_views:latestSnapshot.median_reel_views,avg_likes:latestSnapshot.avg_likes,avg_comments:latestSnapshot.avg_comments,avg_saves:latestSnapshot.avg_saves,avg_shares:latestSnapshot.avg_shares,sample_size:latestSnapshot.sample_size,data_quality:latestSnapshot.data_quality||\"limited\",captured_at:latestSnapshot.captured_at}}}catch{}return res.json({success:true,creator:{id:`instagram:${normalizedUsername}`,name:fallbackName,username:normalizedUsername,category:null,platforms:[{name:\"Instagram\",handle:normalizedUsername,followers:instagramData?.followers??void 0}],suggested_reel_rate:suggestedReelRate2,suggested_paid_range_min:suggestedPaidRange2.min,suggested_paid_range_max:suggestedPaidRange2.max,suggested_barter_value_min:suggestedBarterRange2.min,suggested_barter_value_max:suggestedBarterRange2.max,profile_photo:instagramData?.profile_photo||null,followers:instagramData?.followers??null,last_instagram_sync:new Date().toISOString(),bio:instagramData?.bio||null,open_to_collabs:true,content_niches:[],media_kit_url:null,past_brands:[],recent_campaign_types:[],performance_proof:performanceProof2,trust_stats:{brands_count:0,completed_deals:0,total_deals:0,completion_rate:null,avg_response_hours:null}}})}try{const existingFollowers=profile?.instagram_followers;const existingPhoto=profile?.instagram_profile_photo;const lastSync=profile?.last_instagram_sync?new Date(profile.last_instagram_sync).getTime():0;const sevenDaysMs=7*24*60*60*1e3;const isStale=!lastSync||Date.now()-lastSync>sevenDaysMs;const shouldSync=Boolean(profile.instagram_handle)&&(isStale||!existingFollowers||!existingPhoto);if(shouldSync){const instaData=await fetchInstagramPublicData(profile.instagram_handle);if(instaData){const updatePayload={last_instagram_sync:new Date().toISOString()};if(typeof instaData.followers===\"number\")updatePayload.instagram_followers=instaData.followers;if(instaData.profile_photo)updatePayload.instagram_profile_photo=instaData.profile_photo;await supabase.from(\"profiles\").update(updatePayload).eq(\"id\",profile.id);profile={...profile,...typeof instaData.followers===\"number\"?{instagram_followers:instaData.followers}:{},...instaData.profile_photo?{instagram_profile_photo:instaData.profile_photo}:{},last_instagram_sync:updatePayload.last_instagram_sync}}}}catch(syncError){console.warn(\"[CollabRequests] Instagram auto-sync skipped:\",syncError?.message||syncError)}const platforms=[];const p=profile;if(profile.instagram_handle){platforms.push({name:\"Instagram\",handle:profile.instagram_handle,followers:p.instagram_followers||void 0})}if(p.youtube_channel_id){platforms.push({name:\"YouTube\",handle:p.youtube_channel_id,followers:p.youtube_subs||void 0})}if(p.tiktok_handle){platforms.push({name:\"TikTok\",handle:p.tiktok_handle,followers:p.tiktok_followers||void 0})}if(p.twitter_handle){platforms.push({name:\"Twitter\",handle:p.twitter_handle,followers:p.twitter_followers||void 0})}if(p.facebook_profile_url){platforms.push({name:\"Facebook\",handle:p.facebook_profile_url,followers:p.facebook_followers||void 0})}const creatorName=profile.business_name||`${profile.first_name||\"\"} ${profile.last_name||\"\"}`.trim()||\"Creator\";let trustStats={brands_count:0,completed_deals:0,total_deals:0,completion_rate:null,avg_response_hours:null};try{const{data:dealsStatsRows}=await supabase.from(\"brand_deals\").select(\"brand_name, status, progress_percentage\").eq(\"creator_id\",profile.id);const dealsRows=Array.isArray(dealsStatsRows)?dealsStatsRows:[];const totalDeals=dealsRows.length;const completedDeals=dealsRows.filter(d=>{const status=(d?.status||\"\").toLowerCase();const progress=typeof d?.progress_percentage===\"number\"?d.progress_percentage:0;if(progress>=100)return true;return status.includes(\"completed\")||status.includes(\"closed\")||status.includes(\"resolved\")}).length;const uniqueBrands=new Set(dealsRows.map(d=>typeof d?.brand_name===\"string\"?d.brand_name.trim().toLowerCase():\"\").filter(Boolean)).size;const{data:responseRows}=await supabase.from(\"collab_requests\").select(\"created_at, updated_at, status\").eq(\"creator_id\",profile.id).in(\"status\",[\"accepted\",\"countered\",\"declined\"]);const responseDurationsHours=(Array.isArray(responseRows)?responseRows:[]).map(r=>{const created=r?.created_at?new Date(r.created_at).getTime():NaN;const updated=r?.updated_at?new Date(r.updated_at).getTime():NaN;if(!Number.isFinite(created)||!Number.isFinite(updated)||updated<created)return null;const hours=(updated-created)/(1e3*60*60);if(hours<0||hours>168)return null;return hours}).filter(v=>typeof v===\"number\");const avgResponseHours=responseDurationsHours.length>0?responseDurationsHours.reduce((sum,h)=>sum+h,0)/responseDurationsHours.length:null;trustStats={brands_count:uniqueBrands,completed_deals:completedDeals,total_deals:totalDeals,completion_rate:totalDeals>0?Math.round(completedDeals/totalDeals*100):null,avg_response_hours:avgResponseHours!==null?Math.max(1,Math.round(avgResponseHours)):null}}catch(statsError){console.warn(\"[CollabRequests] Failed to compute trust stats:\",statsError)}const suggestedReelRate=getEffectiveReelRate(profile);const suggestedPaidRange=estimateReelBudgetRange(suggestedReelRate);const suggestedBarterRange=estimateBarterValueRange(suggestedReelRate);let performanceProof=null;try{const{data:latestSnapshot}=await supabase.from(\"instagram_performance_snapshots\").select(\"engagement_rate, median_reel_views, avg_likes, avg_comments, avg_saves, avg_shares, sample_size, data_quality, captured_at\").eq(\"creator_id\",profile.id).order(\"captured_at\",{ascending:false}).limit(1).maybeSingle();if(latestSnapshot){performanceProof={engagement_rate:latestSnapshot.engagement_rate,median_reel_views:latestSnapshot.median_reel_views,avg_likes:latestSnapshot.avg_likes,avg_comments:latestSnapshot.avg_comments,avg_saves:latestSnapshot.avg_saves,avg_shares:latestSnapshot.avg_shares,sample_size:latestSnapshot.sample_size,data_quality:latestSnapshot.data_quality||\"limited\",captured_at:latestSnapshot.captured_at}}}catch{}res.json({success:true,creator:{id:profile.id,name:creatorName,username:profile.username,category:profile.creator_category,platforms,suggested_reel_rate:suggestedReelRate,suggested_paid_range_min:suggestedPaidRange.min,suggested_paid_range_max:suggestedPaidRange.max,suggested_barter_value_min:suggestedBarterRange.min,suggested_barter_value_max:suggestedBarterRange.max,profile_photo:profile.instagram_profile_photo||null,followers:profile.instagram_followers??null,last_instagram_sync:profile.last_instagram_sync||null,bio:profile.bio,open_to_collabs:profile.open_to_collabs!==false,content_niches:Array.isArray(profile.content_niches)?profile.content_niches:[],media_kit_url:profile.media_kit_url||null,past_brands:Array.isArray(profile.past_brands)?profile.past_brands:[],recent_campaign_types:Array.isArray(profile.recent_campaign_types)?profile.recent_campaign_types:[],performance_proof:performanceProof,trust_stats:trustStats}})}catch(error){console.error(\"[CollabRequests] Error in GET /:username:\",error);console.error(\"[CollabRequests] Error stack:\",error.stack);console.error(\"[CollabRequests] Error name:\",error.name);console.error(\"[CollabRequests] Error message:\",error.message);const isDev=process.env.NODE_ENV===\"development\"||!process.env.NODE_ENV;res.status(500).json({success:false,error:\"Internal server error\",details:isDev?{message:error.message,name:error.name,stack:error.stack,fullError:JSON.stringify(error,Object.getOwnPropertyNames(error),2)}:{message:error.message}})}});router.post(\"/:username/upload-barter-image\",barterImageUpload.single(\"file\"),async(req,res)=>{try{const file=req.file;if(!file||!file.buffer){return res.status(400).json({success:false,error:\"No image file provided\"})}const allowed=[\"image/jpeg\",\"image/png\",\"image/webp\",\"image/gif\"];if(!allowed.includes(file.mimetype)){return res.status(400).json({success:false,error:\"Only JPEG, PNG, WebP, and GIF images are allowed\"})}const ext=file.mimetype===\"image/jpeg\"?\"jpg\":file.mimetype===\"image/png\"?\"png\":file.mimetype===\"image/webp\"?\"webp\":\"gif\";const path=`collab-requests/barter/${crypto.randomUUID()}.${ext}`;const{error:uploadError}=await supabase.storage.from(\"creator-assets\").upload(path,file.buffer,{contentType:file.mimetype,upsert:false});if(uploadError){console.error(\"[CollabRequests] Barter image upload error:\",uploadError);return res.status(500).json({success:false,error:\"Failed to upload image\"})}const{data:urlData}=supabase.storage.from(\"creator-assets\").getPublicUrl(path);return res.status(200).json({success:true,url:urlData.publicUrl})}catch(e){console.error(\"[CollabRequests] Barter image upload exception:\",e);return res.status(500).json({success:false,error:\"Failed to upload image\"})}});router.post(\"/:username/submit\",async(req,res)=>{try{const{username}=req.params;const{brand_name,brand_email,brand_address,brand_gstin,brand_phone,brand_website,brand_instagram,collab_type,budget_range,exact_budget,barter_description,barter_value,barter_product_image_url,campaign_description,deliverables,usage_rights,deadline,authorized_signer_name,authorized_signer_role,usage_duration,payment_terms,approval_sla_hours,shipping_timeline_days,cancellation_policy}=req.body;if(!username||username.trim()===\"\"){return res.status(400).json({success:false,error:\"Username is required\"})}if(!brand_name||!brand_email||!campaign_description){return res.status(400).json({success:false,error:\"Brand name, email, and campaign description are required\"})}if(!brand_address||typeof brand_address!==\"string\"||brand_address.trim().length<15){return res.status(400).json({success:false,error:\"Company / brand address is required (full registered address, at least 15 characters) for contract generation\"})}if(brand_gstin!=null&&typeof brand_gstin===\"string\"&&brand_gstin.trim()){const gstin=brand_gstin.trim().toUpperCase();if(!/^[0-9A-Z]{15}$/.test(gstin)){return res.status(400).json({success:false,error:\"GSTIN must be 15 characters (letters and numbers only)\"})}}if(!collab_type||![\"paid\",\"barter\",\"both\"].includes(collab_type)){return res.status(400).json({success:false,error:\"Valid collaboration type is required\"})}if(!Array.isArray(deliverables)||deliverables.length===0){return res.status(400).json({success:false,error:\"At least one deliverable is required\"})}const normalizedUsername=username.toLowerCase().trim();let{data:creator,error:creatorError}=await supabase.from(\"profiles\").select(\"id, username, instagram_handle\").eq(\"username\",normalizedUsername).eq(\"role\",\"creator\").maybeSingle();if(!creator&&!creatorError){const result=await supabase.from(\"profiles\").select(\"id, username, instagram_handle\").eq(\"instagram_handle\",normalizedUsername).eq(\"role\",\"creator\").maybeSingle();creator=result.data;creatorError=result.error}if(creatorError||!creator){return res.status(404).json({success:false,error:\"Creator not found\"})}const clientIp=req.ip||req.socket.remoteAddress||\"unknown\";const userAgent=req.get(\"user-agent\")||\"unknown\";const isDevelopment=process.env.NODE_ENV===\"development\"||!process.env.NODE_ENV;const allowDemoEmail=process.env.ALLOW_DEMO_EMAIL===\"true\";if(!isDevelopment&&!allowDemoEmail){const oneHourAgo=new Date(Date.now()-60*60*1e3).toISOString();const{data:recentSubmissions,error:rateLimitError}=await supabase.from(\"collab_requests\").select(\"id\").eq(\"brand_email\",brand_email.toLowerCase().trim()).eq(\"creator_id\",creator.id).gte(\"created_at\",oneHourAgo).limit(1);if(rateLimitError){console.error(\"[CollabRequests] Rate limit check error:\",rateLimitError)}if(recentSubmissions&&recentSubmissions.length>0){return res.status(429).json({success:false,error:\"Please wait before submitting another request. You can submit one request per hour.\"})}}else{console.log(\"[CollabRequests] Rate limiting disabled in development mode\")}const brandContactId=await resolveOrCreateBrandContact({legalName:brand_name.trim(),email:brand_email.trim(),phone:brand_phone?.trim()||null,website:brand_website?.trim()||null,instagram:brand_instagram?.trim()||null,address:brand_address?.trim()||null,gstin:brand_gstin&&typeof brand_gstin===\"string\"?brand_gstin.trim().toUpperCase():null});const extraTermsLines=[];if(authorized_signer_name)extraTermsLines.push(`Authorized signer: ${String(authorized_signer_name).trim()}${authorized_signer_role?` (${String(authorized_signer_role).trim()})`:\"\"}`);if(usage_duration)extraTermsLines.push(`Usage duration requested: ${String(usage_duration).trim()}`);if(payment_terms)extraTermsLines.push(`Payment terms requested: ${String(payment_terms).trim()}`);if(approval_sla_hours)extraTermsLines.push(`Approval SLA requested: ${String(approval_sla_hours).trim()} hours`);if(shipping_timeline_days)extraTermsLines.push(`Shipping timeline requested: ${String(shipping_timeline_days).trim()} days`);if(cancellation_policy)extraTermsLines.push(`Cancellation/reschedule policy: ${String(cancellation_policy).trim()}`);const campaignDescriptionWithTerms=extraTermsLines.length>0?`${campaign_description.trim()}\n\nAdditional Commercial Terms:\n- ${extraTermsLines.join(\"\\n- \")}`:campaign_description.trim();const insertData={creator_id:creator.id,brand_name:brand_name.trim(),brand_email:brand_email.toLowerCase().trim(),brand_address:brand_address.trim(),brand_gstin:brand_gstin&&typeof brand_gstin===\"string\"?brand_gstin.trim().toUpperCase():null,brand_phone:brand_phone?.trim()||null,brand_website:brand_website?.trim()||null,brand_instagram:brand_instagram?.trim()||null,collab_type,campaign_description:campaignDescriptionWithTerms,deliverables:JSON.stringify(deliverables),usage_rights:usage_rights===true||usage_rights===\"true\",deadline:deadline||null,submitted_ip:clientIp,submitted_user_agent:userAgent,...brandContactId?{brand_contact_id:brandContactId}:{}};if(collab_type===\"paid\"||collab_type===\"both\"){insertData.budget_range=budget_range||null;insertData.exact_budget=exact_budget?parseFloat(exact_budget):null}if(collab_type===\"barter\"||collab_type===\"both\"){insertData.barter_description=barter_description?.trim()||null;insertData.barter_value=barter_value?parseFloat(barter_value):null;if(barter_product_image_url!=null&&typeof barter_product_image_url===\"string\"){const trimmed=barter_product_image_url.trim();if(trimmed&&(trimmed.startsWith(\"http://\")||trimmed.startsWith(\"https://\"))){insertData.barter_product_image_url=trimmed}}}const{data:collabRequest,error:insertError}=await supabase.from(\"collab_requests\").insert(insertData).select(\"id, brand_name, created_at\").single();if(insertError){console.error(\"[CollabRequests] Error creating request:\",insertError);return res.status(500).json({success:false,error:\"Failed to submit collaboration request\"})}let creatorProfile=null;if(collabRequest&&collabRequest.id){try{const{data:profileData}=await supabase.from(\"profiles\").select(\"first_name, last_name, business_name, username, instagram_handle, youtube_channel_id, tiktok_handle, twitter_handle, avatar_url, creator_category, instagram_followers, youtube_subs, tiktok_followers, twitter_followers\").eq(\"id\",creator.id).maybeSingle();creatorProfile=profileData}catch(profileError){console.warn(\"[CollabRequests] Could not fetch creator profile for emails (non-fatal):\",profileError)}}let creatorName=\"Creator\";if(creatorProfile){if(creatorProfile.business_name&&creatorProfile.business_name.trim()){creatorName=creatorProfile.business_name.trim()}else{const firstName=creatorProfile.first_name||\"\";const lastName=creatorProfile.last_name||\"\";const fullName=`${firstName} ${lastName}`.trim();if(fullName){creatorName=fullName}else if(firstName){creatorName=firstName}else if(lastName){creatorName=lastName}}}if(creatorName===\"Creator\"){try{const{data:authUser}=await supabase.auth.admin.getUserById(creator.id);if(authUser?.user?.email){const emailUsername=authUser.user.email.split(\"@\")[0];if(emailUsername&&emailUsername.length>=2){creatorName=emailUsername.charAt(0).toUpperCase()+emailUsername.slice(1)}}}catch(authError){console.warn(\"[CollabRequests] Could not fetch creator email for name fallback:\",authError)}}let deliverablesArray=[];try{deliverablesArray=typeof deliverables===\"string\"?JSON.parse(deliverables):deliverables||[]}catch{deliverablesArray=Array.isArray(deliverables)?deliverables:[]}if(collabRequest&&collabRequest.id){const platforms=[];if(creatorProfile?.instagram_handle)platforms.push(\"Instagram\");if(creatorProfile?.youtube_channel_id)platforms.push(\"YouTube\");if(creatorProfile?.tiktok_handle)platforms.push(\"TikTok\");if(creatorProfile?.twitter_handle)platforms.push(\"Twitter\");sendCollabRequestSubmissionEmail(brand_email,{creatorName,creatorPlatforms:platforms.length>0?platforms:void 0,brandName:brand_name,collabType:collab_type,budgetRange:budget_range||void 0,exactBudget:exact_budget?parseFloat(exact_budget.toString()):void 0,barterDescription:barter_description||void 0,deliverables:deliverablesArray,deadline:deadline||void 0,requestId:collabRequest.id}).catch(emailError=>{console.error(\"[CollabRequests] Submission email sending failed (non-fatal):\",emailError)})}try{const{error:analyticsError}=await supabase.from(\"collab_link_events\").insert({creator_id:creator.id,event_type:\"submit\",request_id:collabRequest.id,device_type:detectDeviceType(userAgent),ip_hash:hashIp(clientIp),user_agent_hash:crypto.createHash(\"sha256\").update(userAgent).digest(\"hex\").substring(0,16)});if(analyticsError){console.error(\"[CollabRequests] Error tracking submit event:\",analyticsError)}}catch(analyticsError){console.error(\"[CollabRequests] Error tracking submit event:\",analyticsError)}if(collabRequest&&collabRequest.id){try{const{data:authUser,error:authError}=await supabase.auth.admin.getUserById(creator.id);if(!authError&&authUser?.user?.email){const creatorEmail=authUser.user.email;const frontendUrl=(process.env.FRONTEND_URL||\"https://creatorarmour.com\").replace(/\\/$/,\"\");let acceptUrl;const acceptTokenId=crypto.randomBytes(24).toString(\"hex\");const acceptExpiresAt=new Date(Date.now()+7*24*60*60*1e3);acceptUrl=`${frontendUrl}/collab-requests`;console.warn(\"[CollabRequests] Magic link token creation skipped: collab_accept_tokens table missing\");const profileAny=creatorProfile;let totalFollowers=0;if(profileAny?.instagram_followers)totalFollowers+=profileAny.instagram_followers;if(profileAny?.youtube_subs)totalFollowers+=profileAny.youtube_subs;if(profileAny?.tiktok_followers)totalFollowers+=profileAny.tiktok_followers;if(profileAny?.twitter_followers)totalFollowers+=profileAny.twitter_followers;sendCollabRequestCreatorNotificationEmail(creatorEmail,{creatorName,creatorCategory:creatorProfile?.creator_category||void 0,followerCount:totalFollowers>0?totalFollowers:void 0,avatarUrl:creatorProfile?.avatar_url||void 0,brandName:brand_name,brandWebsite:brand_website||void 0,campaignGoal:campaign_description||void 0,collabType:collab_type,budgetRange:budget_range||void 0,exactBudget:exact_budget?parseFloat(exact_budget.toString()):void 0,barterDescription:barter_description||void 0,barterValue:barter_value?parseFloat(barter_value.toString()):void 0,barterProductImageUrl:insertData.barter_product_image_url??void 0,deliverables:deliverablesArray,deadline:deadline||void 0,timeline:deadline||void 0,notes:extraTermsLines.length>0?extraTermsLines.join(\" | \"):void 0,requestId:collabRequest.id,acceptUrl},creator.id).then(result=>{if(result.success){console.log(\"[CollabRequests] Creator notification email sent successfully:\",result.emailId)}else{console.warn(\"[CollabRequests] Creator notification email failed (non-fatal):\",result.error)}}).catch(emailError=>{console.error(\"[CollabRequests] Creator notification email sending failed (non-fatal):\",emailError)});try{const frontendUrl2=process.env.FRONTEND_URL||\"https://creatorarmour.com\";const dashboardLink=`${frontendUrl2}/creator-dashboard`;const{error:notificationError}=await supabase.from(\"notifications\").insert({user_id:creator.id,type:\"deal\",category:\"collab_request\",title:`New collaboration request from ${brand_name}`,message:`You have a new collaboration request. Review it in your dashboard.`,data:{collab_request_id:collabRequest.id,brand_name,collab_type},link:dashboardLink,priority:\"high\",icon:\"collab_request\",action_label:\"Review Request\",action_link:dashboardLink});if(notificationError){console.warn(\"[CollabRequests] Failed to create notification entry (non-fatal):\",notificationError)}else{console.log(\"[CollabRequests] Notification entry created successfully\")}}catch(notificationError){console.warn(\"[CollabRequests] Error creating notification entry (non-fatal):\",notificationError)}}else{console.warn(\"[CollabRequests] Could not fetch creator email for notification:\",authError)}}catch(error){console.error(\"[CollabRequests] Error sending creator notification (non-fatal):\",error)}}res.json({success:true,request:{id:collabRequest.id,brand_name:collabRequest.brand_name,submitted_at:collabRequest.created_at}})}catch(error){console.error(\"[CollabRequests] Error in POST /:username/submit:\",error);res.status(500).json({success:false,error:\"Internal server error\"})}});router.get(\"/\",async(req,res)=>{try{if(!req.user||!req.user.id){return res.status(401).json({success:false,error:\"Authentication required\"})}const userId=req.user.id;const{status}=req.query;let query=supabase.from(\"collab_requests\").select(\"*\").eq(\"creator_id\",userId).order(\"created_at\",{ascending:false});if(status&&typeof status===\"string\"){query=query.eq(\"status\",status)}const{data:requests,error}=await query;if(error){const missingSchema=error.code===\"42P01\"||error.code===\"42703\"||/does not exist|relation .* does not exist|column .* does not exist/i.test(error.message||\"\");if(missingSchema){console.warn(\"[CollabRequests] Missing table/column in production schema, returning empty requests:\",error.message);return res.json({success:true,requests:[]})}console.error(\"[CollabRequests] Error fetching requests:\",error);console.error(\"[CollabRequests] Error details:\",JSON.stringify(error,null,2));console.error(\"[CollabRequests] User ID:\",userId);return res.status(500).json({success:false,error:\"Failed to fetch collaboration requests\",details:process.env.NODE_ENV===\"development\"?error.message:void 0})}res.json({success:true,requests:requests||[]})}catch(error){console.error(\"[CollabRequests] Error in GET /:\",error);res.status(500).json({success:false,error:\"Internal server error\"})}});router.post(\"/accept/confirm\",async(req,res)=>{try{const userId=req.user.id;const{requestToken}=req.body||{};const tokenStr=typeof requestToken===\"string\"?requestToken.trim():\"\";if(!tokenStr){return res.status(400).json({success:false,error:\"Invalid link\"})}const clientIp=req.ip||req.socket?.remoteAddress||\"unknown\";const userAgent=req.get(\"user-agent\")||\"unknown\";console.warn(\"[CollabRequests] Accept confirm disabled: collab_accept_tokens table missing\");return res.status(404).json({success:false,error:\"Feature unavailable. Please accept via your dashboard.\"});const{data:request,error:requestError}=await supabase.from(\"collab_requests\").select(\"*\").eq(\"id\",tokenRow.collab_request_id).maybeSingle();if(requestError||!request){return res.status(404).json({success:false,error:\"Request not found\"})}if(request.creator_id!==userId){return res.status(403).json({success:false,error:\"This link is for a different account\"})}if(request.status!==\"pending\"){return res.status(400).json({success:false,error:\"This request has already been handled\"})}const id=request.id;const now=new Date().toISOString();let deliverablesArray=[];try{deliverablesArray=typeof request.deliverables===\"string\"?JSON.parse(request.deliverables):request.deliverables||[]}catch{deliverablesArray=[]}let dealAmount=0;if(request.collab_type===\"paid\"||request.collab_type===\"both\"){dealAmount=request.exact_budget||0}const isBarter=request.collab_type===\"barter\";const dealData={creator_id:userId,brand_name:request.brand_name,brand_email:request.brand_email,deal_amount:dealAmount,deliverables:deliverablesArray.join(\", \"),due_date:request.deadline||new Date(Date.now()+30*24*60*60*1e3).toISOString().split(\"T\")[0],payment_expected_date:request.deadline||new Date(Date.now()+30*24*60*60*1e3).toISOString().split(\"T\")[0],platform:\"Other\",status:\"Drafting\",deal_type:isBarter?\"barter\":\"paid\",created_via:\"collab_request\",brand_address:request.brand_address,brand_phone:request.brand_phone};const{data:deal,error:dealError}=await supabase.from(\"brand_deals\").insert(dealData).select(\"id\").single();if(dealError||!deal){console.error(\"[CollabRequests] Accept confirm: create deal error:\",dealError);return res.status(500).json({success:false,error:\"Failed to create deal\"})}const dealBrandContactId=await resolveOrCreateBrandContact({legalName:request.brand_name||\"\",email:request.brand_email||\"\",phone:request.brand_phone||null,website:null,instagram:null,address:request.brand_address?.trim()||null,gstin:request.brand_gstin?.trim().toUpperCase()||null});if(dealBrandContactId){await supabase.from(\"brand_deals\").update({brand_contact_id:dealBrandContactId,updated_at:now}).eq(\"id\",deal.id)}const{error:updateError}=await supabase.from(\"collab_requests\").update({status:\"accepted\",deal_id:deal.id,updated_at:now}).eq(\"id\",id);if(updateError){console.error(\"[CollabRequests] Error updating request:\",updateError)}await supabase.from(\"deal_action_logs\").insert({deal_id:deal.id,user_id:userId,event:\"CONTRACT_READY\",metadata:{collab_request_id:id,auth_method:\"magic_link\",ip_address:clientIp,user_agent:userAgent,collab_type:request.collab_type,status:\"CONTRACT_READY\"}}).then(({error:logErr})=>{if(logErr)console.warn(\"[CollabRequests] Audit log insert failed:\",logErr)});if(isBarter){return res.json({success:true,deal:{id:deal.id},needs_delivery_details:true,message:\"Deal accepted. Please add delivery details so we can generate the contract.\"})}let contractUrl=null;let contractReadyToken=null;try{const{data:existingDeal}=await supabase.from(\"brand_deals\").select(\"contract_file_url\").eq(\"id\",deal.id).single();if(existingDeal?.contract_file_url){contractUrl=existingDeal.contract_file_url}else{const{data:creatorProfile,error:creatorError}=await supabase.from(\"profiles\").select(\"first_name, last_name, location\").eq(\"id\",userId).maybeSingle();if(creatorError)throw new Error(\"Failed to fetch creator profile\");const creatorName=creatorProfile?`${creatorProfile.first_name||\"\"} ${creatorProfile.last_name||\"\"}`.trim()||\"Creator\":\"Creator\";const creatorEmail=creatorProfile?.email||req.user?.email||void 0;const creatorAddress=creatorProfile?.location||creatorProfile?.address||void 0;let paymentTerms;if(request.collab_type===\"paid\"||request.collab_type===\"both\"){paymentTerms=`Payment expected by ${request.deadline?new Date(request.deadline).toLocaleDateString():new Date(Date.now()+30*24*60*60*1e3).toLocaleDateString()}`}const dealSchema={deal_amount:dealAmount,deliverables:deliverablesArray.length>0?deliverablesArray:[\"As per agreement\"],delivery_deadline:request.deadline||new Date(Date.now()+30*24*60*60*1e3).toISOString().split(\"T\")[0],payment:{method:\"Bank Transfer\",timeline:paymentTerms||\"Within 7 days of content delivery\"},usage:{type:request.usage_rights?\"Exclusive\":\"Non-exclusive\",platforms:[\"All platforms\"],duration:\"6 months\",paid_ads:false,whitelisting:false},exclusivity:{enabled:false,category:null,duration:null},termination:{notice_days:7},jurisdiction_city:\"Mumbai\"};const contractResult=await generateContractFromScratch({brandName:request.brand_name,creatorName,creatorEmail,dealAmount,deliverables:deliverablesArray.length>0?deliverablesArray:[\"As per agreement\"],paymentTerms,dueDate:request.deadline?new Date(request.deadline).toLocaleDateString():void 0,paymentExpectedDate:request.deadline?new Date(request.deadline).toLocaleDateString():void 0,platform:\"Multiple Platforms\",brandEmail:request.brand_email||void 0,brandAddress:request.brand_address?.trim()||void 0,brandGstin:request.brand_gstin?.trim()||void 0,creatorAddress,dealSchema,usageType:request.usage_rights?\"Exclusive\":\"Non-exclusive\",usagePlatforms:[\"All platforms\"],usageDuration:\"6 months\",paidAdsAllowed:false,whitelistingAllowed:false,exclusivityEnabled:false,exclusivityCategory:null,exclusivityDuration:null,terminationNoticeDays:7,jurisdictionCity:\"Mumbai\",additionalTerms:request.collab_type===\"barter\"&&request.barter_description?`Barter Collaboration: ${request.barter_description}`:void 0});const timestamp=Date.now();const storagePath=`contracts/${deal.id}/${timestamp}_${contractResult.fileName}`;const{error:uploadError}=await supabase.storage.from(\"creator-assets\").upload(storagePath,contractResult.contractDocx,{contentType:\"application/vnd.openxmlformats-officedocument.wordprocessingml.document\",upsert:false});if(uploadError)throw new Error(\"Failed to upload contract\");const{data:publicUrlData}=supabase.storage.from(\"creator-assets\").getPublicUrl(storagePath);contractUrl=publicUrlData?.publicUrl||null;if(contractUrl){await supabase.from(\"brand_deals\").update({contract_file_url:contractUrl,status:\"Drafting\",updated_at:now}).eq(\"id\",deal.id)}const token=await createContractReadyToken({dealId:deal.id,creatorId:userId,expiresAt:null});contractReadyToken=token.id;if(request.brand_email&&contractReadyToken){const creatorNameForEmail=creatorProfile?`${creatorProfile.first_name||\"\"} ${creatorProfile.last_name||\"\"}`.trim()||\"Creator\":\"Creator\";sendCollabRequestAcceptedEmail(request.brand_email,{creatorName:creatorNameForEmail,brandName:request.brand_name,dealAmount,dealType:request.collab_type===\"barter\"?\"barter\":\"paid\",deliverables:deliverablesArray.length>0?deliverablesArray:[\"As per agreement\"],contractReadyToken,contractUrl:contractUrl||void 0,barterValue:request.barter_value??void 0}).catch(e=>console.error(\"[CollabRequests] Accept confirm: brand email failed:\",e))}}}catch(contractErr){console.error(\"[CollabRequests] Accept confirm: contract generation failed:\",contractErr)}return res.json({success:true,deal:{id:deal.id},contract:contractUrl?{url:contractUrl,token:contractReadyToken}:null,message:contractUrl?\"Deal accepted. Contract has been generated and sent to the brand.\":\"Deal accepted.\"})}catch(error){console.error(\"[CollabRequests] Accept confirm error:\",error);return res.status(500).json({success:false,error:\"Something went wrong\"})}});router.patch(\"/:id/accept\",async(req,res)=>{try{const userId=req.user.id;const{id}=req.params;const{data:request,error:requestError}=await supabase.from(\"collab_requests\").select(\"*\").eq(\"id\",id).eq(\"creator_id\",userId).maybeSingle();if(requestError||!request){return res.status(404).json({success:false,error:\"Collaboration request not found\"})}if(request.status!==\"pending\"){return res.status(400).json({success:false,error:\"Request has already been processed\"})}let deliverablesArray=[];try{deliverablesArray=typeof request.deliverables===\"string\"?JSON.parse(request.deliverables):request.deliverables||[]}catch{deliverablesArray=[]}let dealAmount=0;if(request.collab_type===\"paid\"||request.collab_type===\"both\"){dealAmount=request.exact_budget||0}const isBarter=request.collab_type===\"barter\";const dealData={creator_id:userId,brand_name:request.brand_name,brand_email:request.brand_email,deal_amount:dealAmount,deliverables:deliverablesArray.join(\", \"),due_date:request.deadline||new Date(Date.now()+30*24*60*60*1e3).toISOString().split(\"T\")[0],payment_expected_date:request.deadline||new Date(Date.now()+30*24*60*60*1e3).toISOString().split(\"T\")[0],platform:\"Other\",status:\"Drafting\",deal_type:isBarter?\"barter\":\"paid\",created_via:\"collab_request\",brand_address:request.brand_address,brand_phone:request.brand_phone};const{data:deal,error:dealError}=await supabase.from(\"brand_deals\").insert(dealData).select(\"id\").single();if(dealError||!deal){console.error(\"[CollabRequests] Error creating deal:\",dealError);return res.status(500).json({success:false,error:\"Failed to create deal\"})}const dealBrandContactId=await resolveOrCreateBrandContact({legalName:request.brand_name||\"\",email:request.brand_email||\"\",phone:request.brand_phone||null,website:null,instagram:null,address:request.brand_address?.trim()||null,gstin:request.brand_gstin?.trim().toUpperCase()||null});if(dealBrandContactId){await supabase.from(\"brand_deals\").update({brand_contact_id:dealBrandContactId,updated_at:new Date().toISOString()}).eq(\"id\",deal.id)}const now=new Date().toISOString();const clientIp=req.ip||req.socket?.remoteAddress||\"unknown\";const userAgent=req.get(\"user-agent\")||\"unknown\";const{error:updateError}=await supabase.from(\"collab_requests\").update({status:\"accepted\",deal_id:deal.id,updated_at:now}).eq(\"id\",id);if(updateError){console.error(\"[CollabRequests] Error updating request:\",updateError)}await supabase.from(\"deal_action_logs\").insert({deal_id:deal.id,user_id:userId,event:\"CONTRACT_READY\",metadata:{collab_request_id:id,auth_method:\"session\",ip_address:clientIp,user_agent:userAgent,collab_type:request.collab_type,status:\"CONTRACT_READY\"}}).then(({error:logErr})=>{if(logErr)console.warn(\"[CollabRequests] Audit log insert failed:\",logErr)});if(isBarter){return res.json({success:true,deal:{id:deal.id},needs_delivery_details:true,message:\"Deal accepted. Please add delivery details so we can generate the contract.\"})}const{data:dealCheck}=await supabase.from(\"brand_deals\").select(\"deal_type\").eq(\"id\",deal.id).single();if(dealCheck?.deal_type===\"barter\"){return res.status(400).json({success:false,error:\"Delivery details required for barter deals\"})}let contractUrl=null;let contractReadyToken=null;try{const{data:existingDeal}=await supabase.from(\"brand_deals\").select(\"contract_file_url\").eq(\"id\",deal.id).single();if(existingDeal?.contract_file_url){console.log(\"[CollabRequests] Contract already exists for deal:\",deal.id);contractUrl=existingDeal.contract_file_url}else{const{data:creatorProfile,error:creatorError}=await supabase.from(\"profiles\").select(\"first_name, last_name, location\").eq(\"id\",userId).maybeSingle();if(creatorError){console.error(\"[CollabRequests] Error fetching creator profile:\",creatorError)}const creatorName=creatorProfile?`${creatorProfile.first_name||\"\"} ${creatorProfile.last_name||\"\"}`.trim()||\"Creator\":\"Creator\";const creatorEmail=req.user?.email||void 0;const creatorAddress=creatorProfile?.location||void 0;let paymentTerms;if(request.collab_type===\"paid\"||request.collab_type===\"both\"){const paymentDate=request.deadline?new Date(request.deadline).toLocaleDateString():new Date(Date.now()+30*24*60*60*1e3).toLocaleDateString();paymentTerms=`Payment expected by ${paymentDate}`}const dealSchema={deal_amount:dealAmount,deliverables:deliverablesArray.length>0?deliverablesArray:[\"As per agreement\"],delivery_deadline:request.deadline||new Date(Date.now()+30*24*60*60*1e3).toISOString().split(\"T\")[0],payment:{method:\"Bank Transfer\",timeline:paymentTerms||\"Within 7 days of content delivery\"},usage:{type:request.usage_rights?\"Exclusive\":\"Non-exclusive\",platforms:[\"All platforms\"],duration:\"6 months\",paid_ads:false,whitelisting:false},exclusivity:{enabled:false,category:null,duration:null},termination:{notice_days:7},jurisdiction_city:\"Mumbai\"};const contractResult=await generateContractFromScratch({brandName:request.brand_name,creatorName,creatorEmail,dealAmount,deliverables:deliverablesArray.length>0?deliverablesArray:[\"As per agreement\"],paymentTerms,dueDate:request.deadline?new Date(request.deadline).toLocaleDateString():void 0,paymentExpectedDate:request.deadline?new Date(request.deadline).toLocaleDateString():void 0,platform:\"Multiple Platforms\",brandEmail:request.brand_email||void 0,brandAddress:request.brand_address?.trim()||void 0,brandGstin:request.brand_gstin?.trim()||void 0,creatorAddress,dealSchema,usageType:request.usage_rights?\"Exclusive\":\"Non-exclusive\",usagePlatforms:[\"All platforms\"],usageDuration:\"6 months\",paidAdsAllowed:false,whitelistingAllowed:false,exclusivityEnabled:false,exclusivityCategory:null,exclusivityDuration:null,terminationNoticeDays:7,jurisdictionCity:\"Mumbai\",additionalTerms:request.collab_type===\"barter\"&&request.barter_description?`Barter Collaboration: ${request.barter_description}`:void 0});const timestamp=Date.now();const storagePath=`contracts/${deal.id}/${timestamp}_${contractResult.fileName}`;const{error:uploadError}=await supabase.storage.from(\"creator-assets\").upload(storagePath,contractResult.contractDocx,{contentType:\"application/vnd.openxmlformats-officedocument.wordprocessingml.document\",upsert:false});if(uploadError){console.error(\"[CollabRequests] Contract upload error:\",uploadError);throw new Error(\"Failed to upload contract\")}const{data:publicUrlData}=supabase.storage.from(\"creator-assets\").getPublicUrl(storagePath);contractUrl=publicUrlData?.publicUrl||null;if(!contractUrl){throw new Error(\"Failed to get contract URL\")}const{error:contractUpdateError}=await supabase.from(\"brand_deals\").update({contract_file_url:contractUrl,status:\"CONTRACT_READY\",updated_at:new Date().toISOString()}).eq(\"id\",deal.id);if(contractUpdateError){console.error(\"[CollabRequests] Error updating deal with contract:\",contractUpdateError)}try{const token=await createContractReadyToken({dealId:deal.id,creatorId:userId,expiresAt:null});contractReadyToken=token.id;if(request.brand_email&&contractReadyToken){sendCollabRequestAcceptedEmail(request.brand_email,{creatorName,brandName:request.brand_name,dealAmount,dealType:request.collab_type===\"barter\"?\"barter\":\"paid\",deliverables:deliverablesArray.length>0?deliverablesArray:[\"As per agreement\"],contractReadyToken,contractUrl:contractUrl||void 0}).catch(emailError=>{console.error(\"[CollabRequests] Acceptance email sending failed (non-fatal):\",emailError)})}const{sendCreatorAcceptanceProcessingEmail}=await import(\"../services/collabRequestEmailService.js\").then(s=>{const e=\"default\";return s[e]&&typeof s[e]==\"object\"&&\"__esModule\"in s[e]?s[e]:s});sendCreatorAcceptanceProcessingEmail(creatorEmail||\"\",creatorName,request.brand_name,deal.id).catch(emailError=>{console.error(\"[CollabRequests] Creator acceptance confirmation failed (non-fatal):\",emailError)})}catch(tokenError){console.error(\"[CollabRequests] Error creating contract ready token:\",tokenError)}console.log(\"[CollabRequests] Contract generated successfully for deal:\",deal.id)}}catch(contractError){console.error(\"[CollabRequests] Error generating contract:\",contractError)}res.json({success:true,deal:{id:deal.id},contract:contractUrl?{url:contractUrl,token:contractReadyToken}:null,message:contractUrl?\"Collaboration request accepted. Deal created and contract generated successfully.\":\"Collaboration request accepted. Deal created successfully.\"})}catch(error){console.error(\"[CollabRequests] Error in PATCH /:id/accept:\",error);res.status(500).json({success:false,error:\"Internal server error\"})}});router.patch(\"/:id/counter\",async(req,res)=>{try{const userId=req.user.id;const{id}=req.params;const{final_price,deliverables,payment_terms,notes}=req.body;if(!final_price&&!deliverables){return res.status(400).json({success:false,error:\"Counter offer must include price or deliverables\"})}const{data:request,error:requestError}=await supabase.from(\"collab_requests\").select(\"*\").eq(\"id\",id).eq(\"creator_id\",userId).maybeSingle();if(requestError||!request){return res.status(404).json({success:false,error:\"Collaboration request not found\"})}if(request.status!==\"pending\"){return res.status(400).json({success:false,error:\"Request has already been processed\"})}const counterOffer={final_price:final_price?parseFloat(final_price):null,deliverables:deliverables||null,payment_terms:payment_terms||null,notes:notes||null,countered_at:new Date().toISOString()};const{error:updateError}=await supabase.from(\"collab_requests\").update({status:\"countered\",counter_offer:counterOffer,updated_at:new Date().toISOString()}).eq(\"id\",id);if(updateError){console.error(\"[CollabRequests] Error updating request:\",updateError);return res.status(500).json({success:false,error:\"Failed to submit counter offer\"})}if(request.brand_email){const{data:creatorProfile}=await supabase.from(\"profiles\").select(\"first_name, last_name\").eq(\"id\",userId).maybeSingle();const creatorName=creatorProfile?`${creatorProfile.first_name||\"\"} ${creatorProfile.last_name||\"\"}`.trim()||\"Creator\":\"Creator\";sendCollabRequestCounterEmail(request.brand_email,{creatorName,brandName:request.brand_name,originalBudget:request.exact_budget||request.barter_value||null,counterPrice:final_price?parseFloat(final_price):void 0,counterDeliverables:deliverables||void 0,counterNotes:notes||void 0,requestId:id}).catch(emailError=>{console.error(\"[CollabRequests] Counter offer email sending failed (non-fatal):\",emailError)})}res.json({success:true,message:\"Counter offer submitted successfully\"})}catch(error){console.error(\"[CollabRequests] Error in PATCH /:id/counter:\",error);res.status(500).json({success:false,error:\"Internal server error\"})}});router.patch(\"/:id/decline\",async(req,res)=>{try{const userId=req.user.id;const{id}=req.params;const{data:request,error:requestError}=await supabase.from(\"collab_requests\").select(\"*\").eq(\"id\",id).eq(\"creator_id\",userId).maybeSingle();if(requestError||!request){return res.status(404).json({success:false,error:\"Collaboration request not found\"})}if(request.status!==\"pending\"){return res.status(400).json({success:false,error:\"Request has already been processed\"})}const{error:updateError}=await supabase.from(\"collab_requests\").update({status:\"declined\",updated_at:new Date().toISOString()}).eq(\"id\",id);if(updateError){console.error(\"[CollabRequests] Error updating request:\",updateError);return res.status(500).json({success:false,error:\"Failed to decline request\"})}if(request.brand_email){const{data:creatorProfile}=await supabase.from(\"profiles\").select(\"first_name, last_name, username\").eq(\"id\",userId).maybeSingle();const creatorName=creatorProfile?`${creatorProfile.first_name||\"\"} ${creatorProfile.last_name||\"\"}`.trim()||\"Creator\":\"Creator\";const creatorUsername=creatorProfile?.username||\"creator\";sendCollabRequestDeclinedEmail(request.brand_email,{creatorName,brandName:request.brand_name,creatorUsername}).catch(emailError=>{console.error(\"[CollabRequests] Decline email sending failed (non-fatal):\",emailError)})}res.json({success:true,message:\"Collaboration request declined\"})}catch(error){console.error(\"[CollabRequests] Error in PATCH /:id/decline:\",error);res.status(500).json({success:false,error:\"Internal server error\"})}});var collabRequests_default=router;export{collabRequests_default as default};\n","warnings":[],"map":{"version":3,"mappings":"kHAIA,OAAO,YAAoC,UAC3C,OAAO,WAAY,SACnB,OAAO,WAAY,SACnB,OAAS,SAAU,wBAA2B,qBAE9C,OAAS,gCAAmC,mCAC5C,OAAS,6BAAgC,2CACzC,OACE,iCACA,+BACA,8BACA,+BACA,0CACA,+BACA,+BACK,2CACP,OAAS,gCAAmC,qCAC5C,OAAS,yBAA0B,wBAAyB,iBAAkB,yBAA4B,oCAC1G,OAAS,6BAAgC,kCAEzC,MAAM,OAAS,QAAQ,OAAO,EAG9B,MAAM,kBAAoB,OAAO,CAC/B,QAAS,OAAO,cAAc,EAC9B,OAAQ,CAAE,SAAU,EAAI,KAAO,IAAK,CACtC,CAAC,EAKD,SAAS,OAAO,GAAoB,CAClC,GAAI,CAAC,IAAM,KAAO,UAAW,MAAO,UAEpC,MAAM,MAAQ,GAAG,MAAM,GAAG,EAC1B,GAAI,MAAM,QAAU,EAAG,CACrB,MAAO,GAAG,MAAM,CAAC,CAAC,IAAI,MAAM,CAAC,CAAC,IAAI,MAAM,CAAC,CAAC,MAC5C,CAGA,OAAO,OAAO,WAAW,QAAQ,EAAE,OAAO,EAAE,EAAE,OAAO,KAAK,EAAE,UAAU,EAAG,EAAE,EAAI,KACjF,CAVS,wBAeT,SAAS,iBAAiB,UAAuC,CAC/D,GAAI,CAAC,UAAW,MAAO,UAEvB,MAAM,GAAK,UAAU,YAAY,EACjC,GAAI,GAAG,SAAS,QAAQ,GAAK,GAAG,SAAS,SAAS,GAAK,GAAG,SAAS,QAAQ,EAAG,CAC5E,MAAO,QACT,CACA,GAAI,GAAG,SAAS,QAAQ,GAAK,GAAG,SAAS,MAAM,EAAG,CAChD,MAAO,QACT,CACA,GAAI,GAAG,SAAS,SAAS,GAAK,GAAG,SAAS,SAAS,GAAK,GAAG,SAAS,WAAW,GAAK,GAAG,SAAS,OAAO,EAAG,CACxG,MAAO,SACT,CACA,MAAO,SACT,CAdS,4CAwBT,OAAO,IAAI,oBAAqB,MAAO,IAAc,MAAkB,CACrE,GAAI,CACF,KAAM,CAAE,QAAS,EAAI,IAAI,OACzB,MAAM,MAAQ,OAAO,IAAI,MAAM,QAAU,SAAW,IAAI,MAAM,MAAM,KAAK,EAAI,GAC7E,GAAI,CAAC,UAAY,CAAC,MAAO,CACvB,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,iCAAkC,CAAC,CAC1F,CAyBA,QAAQ,KAAK,qFAAqF,EAClG,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,+BAAgC,CAAC,CACxF,OAAS,EAAG,CACV,QAAQ,MAAM,uCAAwC,CAAC,EACvD,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,sBAAuB,CAAC,CAC/E,CACF,CAAC,EAMD,OAAO,KAAK,wBAAyB,MAAO,IAAc,MAAkB,CAC1E,GAAI,CACF,KAAM,CAAE,QAAS,EAAI,IAAI,OACzB,KAAM,CAAE,MAAO,QAAS,EAAI,IAAI,MAAQ,CAAC,EACzC,GAAI,CAAC,UAAY,SAAS,KAAK,IAAM,GAAI,CACvC,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,sBAAuB,CAAC,CAC/E,CACA,MAAM,SAAW,OAAO,QAAU,SAAW,MAAM,KAAK,EAAI,GAC5D,GAAI,CAAC,UAAY,CAAC,6BAA6B,KAAK,QAAQ,EAAG,CAC7D,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,yBAA0B,CAAC,CAClF,CACA,MAAM,QAAU,OAAO,WAAa,UAAY,WAAa,KAAO,SAAW,CAAC,EAChF,MAAM,YAAc,OAAO,YAAY,EAAE,EAAE,SAAS,KAAK,EACzD,MAAM,UAAY,IAAI,KAAK,KAAK,IAAI,EAAI,EAAI,GAAK,GAAK,GAAK,GAAI,EAE/D,MAAM,mBAAqB,SAAS,YAAY,EAAE,KAAK,EAiBvD,QAAQ,KAAK,mFAAmF,EAChG,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,+BAAgC,CAAC,EAEtF,MAAM,YAAc,QAAQ,IAAI,cAAgB,4BAChD,MAAM,UAAY,GAAG,WAAW,WAAW,mBAAmB,kBAAkB,CAAC,WAAW,mBAAmB,WAAW,CAAC,GAE3H,IAAI,YAAc,cAClB,MAAM,WAAa,MAAM,SACtB,KAAK,UAAU,EACf,OAAO,sCAAsC,EAC7C,GAAG,eAAe,kBAAkB,wBAAwB,kBAAkB,EAAE,EAChF,GAAG,OAAQ,SAAS,EACpB,YAAY,EACf,GAAI,WAAW,KAAM,CACnB,MAAM,EAAI,WAAW,KACrB,YAAc,EAAE,eAAiB,CAAC,EAAE,WAAY,EAAE,SAAS,EAAE,OAAO,OAAO,EAAE,KAAK,GAAG,GAAK,aAC5F,CAEA,MAAM,YAAc,MAAM,2BAA2B,SAAU,YAAa,SAAS,EACrF,GAAI,CAAC,YAAY,QAAS,CACxB,QAAQ,MAAM,8CAA+C,YAAY,KAAK,CAChF,CAEA,OAAO,IAAI,KAAK,CACd,QAAS,KACT,QAAS,uDACX,CAAC,CACH,OAAS,EAAG,CACV,QAAQ,MAAM,qCAAsC,CAAC,EACrD,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,sBAAuB,CAAC,CAC/E,CACF,CAAC,EAUD,OAAO,IAAI,gCAAiC,MAAO,IAAc,MAAkB,CACjF,GAAI,CACF,MAAM,aAAe,OAAO,IAAI,OAAO,eAAiB,SAAW,IAAI,OAAO,aAAa,KAAK,EAAI,GACpG,GAAI,CAAC,aAAc,CACjB,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,cAAe,CAAC,CACvE,CAYA,QAAQ,KAAK,mFAAmF,EAChG,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,yDAA0D,CAAC,EAChH,MAAM,UAAY,IAAI,KAAK,SAAS,UAAU,EAC9C,GAAI,UAAU,QAAQ,EAAI,KAAK,IAAI,EAAG,CACpC,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,UACP,QAAS,uBACX,CAAC,CACH,CACA,KAAM,CAAE,KAAM,QAAS,MAAO,QAAS,EAAI,MAAM,SAC9C,KAAK,iBAAiB,EACtB,OAAO,6GAA6G,EACpH,GAAG,KAAM,SAAS,iBAAiB,EACnC,YAAY,EACf,GAAI,UAAY,CAAC,QAAS,CACxB,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,mBAAoB,CAAC,CAC5E,CACA,GAAI,QAAQ,SAAW,UAAW,CAChC,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,KACT,eAAgB,KAChB,OAAQ,QAAQ,OAChB,QAAS,wCACT,WAAY,QAAQ,WACpB,YAAa,QAAQ,YACrB,aAAc,QAAQ,cAAgB,CAAC,EACvC,SAAU,QAAQ,SAClB,OAAQ,QAAQ,cAAgB,QAAQ,cAAgB,IAC1D,CAAC,CACH,CACA,IAAI,kBAA8B,CAAC,EACnC,GAAI,CACF,kBAAoB,MAAM,QAAQ,QAAQ,YAAY,EAClD,QAAQ,aACR,OAAO,QAAQ,eAAiB,SAC9B,KAAK,MAAM,QAAQ,YAAY,EAC/B,CAAC,CACT,MAAQ,CACN,kBAAoB,CAAC,CACvB,CACA,MAAM,SAAW,QAAQ,cAAgB,SAAW,SAAW,QAAQ,cAAgB,OAAS,OAAS,gBACzG,MAAM,OAAS,QAAQ,cAAgB,SAAY,QAAQ,cAAgB,KAAS,QAAQ,cAAgB,KAC5G,OAAO,IAAI,KAAK,CACd,QAAS,KACT,eAAgB,MAChB,WAAY,QAAQ,WACpB,YAAa,QAAQ,YACrB,gBAAiB,SACjB,OACA,aAAc,kBACd,SAAU,QAAQ,SAClB,cAAe,SAAS,cACxB,WAAY,SAAS,UACvB,CAAC,CACH,OAAS,EAAG,CACV,QAAQ,MAAM,yCAA0C,CAAC,EACzD,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,sBAAuB,CAAC,CAC/E,CACF,CAAC,EAMD,OAAO,KAAK,4BAA6B,MAAO,IAAc,MAAkB,CAC9E,GAAI,CACF,KAAM,CAAE,YAAa,EAAI,IAAI,MAAQ,CAAC,EACtC,MAAM,SAAW,OAAO,eAAiB,SAAW,aAAa,KAAK,EAAI,GAC1E,GAAI,CAAC,SAAU,CACb,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,cAAe,CAAC,CACvE,CAYA,QAAQ,KAAK,uFAAuF,EACpG,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,uDAAwD,CAAC,EAC9G,MAAM,UAAY,IAAI,KAAK,SAAS,UAAU,EAC9C,GAAI,UAAU,QAAQ,EAAI,KAAK,IAAI,EAAG,CACpC,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,uBAAwB,CAAC,CAChF,CACA,KAAM,CAAE,KAAM,OAAQ,EAAI,MAAM,SAC7B,KAAK,iBAAiB,EACtB,OAAO,YAAY,EACnB,GAAG,KAAM,SAAS,iBAAiB,EACnC,YAAY,EACf,GAAI,CAAC,SAAW,QAAQ,SAAW,UAAW,CAC5C,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,uCAAwC,CAAC,CAChG,CACA,MAAM,aAAe,QAAQ,IAAI,cAAgB,6BAA6B,QAAQ,MAAO,EAAE,EAC/F,MAAM,WAAa,GAAG,WAAW,kBAAkB,mBAAmB,QAAQ,CAAC,iBAC/E,KAAM,CAAE,KAAM,SAAU,MAAO,SAAU,EAAI,MAAM,SAAS,KAAK,MAAM,aAAa,CAClF,KAAM,YACN,MAAO,SAAS,cAChB,QAAS,CAAE,UAAW,CACxB,CAAC,EACD,MAAM,UAAa,UAAkB,YAAY,aAAgB,UAAkB,YACnF,GAAI,WAAa,CAAC,UAAW,CAC3B,QAAQ,MAAM,8CAA+C,SAAS,EACtE,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,mCAAoC,CAAC,CAC5F,CACA,MAAM,YAAc,MAAM,+BAA+B,SAAS,cAAe,SAAS,EAC1F,GAAI,CAAC,YAAY,QAAS,CACxB,QAAQ,MAAM,4CAA6C,YAAY,KAAK,EAC5E,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,mCAAoC,CAAC,CAC5F,CACA,OAAO,IAAI,KAAK,CAAE,QAAS,KAAM,QAAS,sCAAuC,CAAC,CACpF,OAAS,EAAG,CACV,QAAQ,MAAM,4CAA6C,CAAC,EAC5D,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,sBAAuB,CAAC,CAC/E,CACF,CAAC,EAMD,OAAO,IAAI,aAAc,MAAO,IAAc,MAAkB,CAC9D,GAAI,CACF,KAAM,CAAE,QAAS,EAAI,IAAI,OAEzB,GAAI,CAAC,UAAY,SAAS,KAAK,IAAM,GAAI,CACvC,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,sBACT,CAAC,CACH,CAIA,MAAM,mBAAqB,SAAS,YAAY,EAAE,KAAK,EAGvD,MAAM,kBAAoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAU1B,KAAM,CAAE,KAAM,iBAAkB,MAAO,aAAc,EAAI,MAAM,SAC5D,KAAK,UAAU,EACf,OAAO,iBAAiB,EACxB,GAAG,WAAY,kBAAkB,EACjC,GAAG,OAAQ,SAAS,EACpB,MAAM,CAAC,EAEV,IAAI,QAAW,kBAAoB,iBAAiB,OAAS,EAAK,iBAAiB,CAAC,EAAI,KACxF,IAAI,aAAe,cAGnB,GAAI,CAAC,SAAW,CAAC,aAAc,CAC7B,KAAM,CAAE,KAAM,kBAAmB,MAAO,cAAe,EAAI,MAAM,SAC9D,KAAK,UAAU,EACf,OAAO,iBAAiB,EACxB,GAAG,mBAAoB,kBAAkB,EACzC,GAAG,OAAQ,SAAS,EACpB,MAAM,CAAC,EAEV,QAAW,mBAAqB,kBAAkB,OAAS,EAAK,kBAAkB,CAAC,EAAI,KACvF,aAAe,cACjB,CAGA,GAAI,SAAW,CAAC,aAAc,CAC5B,KAAM,CAAE,KAAM,eAAgB,EAAI,MAAM,SACrC,KAAK,UAAU,EACf,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAmBT,EACE,GAAG,KAAM,QAAQ,EAAE,EACnB,YAAY,EAGf,GAAI,gBAAiB,CACnB,QAAU,CAAE,GAAG,QAAS,GAAG,eAAgB,CAC7C,CAGA,KAAM,CAAE,KAAM,kBAAmB,EAAI,MAAM,SACxC,KAAK,UAAU,EACf,OAAO,oCAAoC,EAC3C,GAAG,KAAM,QAAQ,EAAE,EACnB,YAAY,EAEf,GAAI,mBAAoB,CACtB,MAAM,YAAuC,CAAE,GAAG,OAAQ,EAC1D,GAAI,MAAM,QAAS,mBAA2B,WAAW,EAAG,CAC1D,YAAY,YAAe,mBAA2B,WACxD,CACA,GAAI,MAAM,QAAS,mBAA2B,qBAAqB,EAAG,CACpE,YAAY,sBAAyB,mBAA2B,qBAClE,CACA,QAAU,WACZ,CACF,CAEA,GAAI,aAAc,CAChB,QAAQ,MAAM,2CAA4C,YAAY,EACtE,QAAQ,MAAM,+BAAgC,aAAa,IAAI,EAC/D,QAAQ,MAAM,kCAAmC,aAAa,OAAO,EACrE,QAAQ,MAAM,kCAAmC,KAAK,UAAU,aAAc,KAAM,CAAC,CAAC,EACtF,QAAQ,MAAM,sCAAuC,SAAS,YAAY,EAAE,KAAK,CAAC,EAClF,QAAQ,MAAM,gDAAiD,mBAAmB,EAGlF,MAAM,MAAQ,QAAQ,IAAI,WAAa,eAAiB,CAAC,QAAQ,IAAI,SACrE,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,kCACP,QAAS,MAAQ,CACf,QAAS,aAAa,QACtB,KAAM,aAAa,KACnB,KAAM,aAAa,KACnB,QAAS,aAAa,QACtB,UAAW,KAAK,UAAU,aAAc,KAAM,CAAC,CACjD,EAAI,CACF,KAAM,aAAa,KACnB,QAAS,aAAa,OACxB,CACF,CAAC,CACH,CAEA,GAAI,CAAC,QAAS,CACZ,QAAQ,IAAI,gGAAiG,kBAAkB,EAE/H,IAAI,cAAsE,KAC1E,GAAI,CACF,cAAgB,MAAM,yBAAyB,kBAAkB,CACnE,OAAS,cAAoB,CAC3B,QAAQ,KAAK,8CAA+C,eAAe,SAAW,aAAa,CACrG,CAEA,MAAMA,mBAAoB,iBAAiB,eAAe,WAAa,CAAC,EACxE,MAAMC,oBAAqB,wBAAwBD,kBAAiB,EACpE,MAAME,sBAAuB,yBAAyBF,kBAAiB,EACvE,MAAM,aAAgB,eAAe,WAAa,cAAc,UAAU,KAAK,GAAM,mBAClF,MAAM,QAAQ,EACd,OAAO,OAAO,EACd,IAAK,MAAS,KAAK,OAAO,CAAC,EAAE,YAAY,EAAI,KAAK,MAAM,CAAC,CAAC,EAC1D,KAAK,GAAG,GAAK,mBAEhB,IAAIG,kBAAmD,KACvD,GAAI,CACF,KAAM,CAAE,KAAM,cAAe,EAAI,MAAM,SACpC,KAAK,iCAAiC,EACtC,OAAO,4HAA4H,EACnI,GAAG,cAAe,kBAAkB,EACpC,MAAM,cAAe,CAAE,UAAW,KAAM,CAAC,EACzC,MAAM,CAAC,EACP,YAAY,EAEf,GAAI,eAAgB,CAClBA,kBAAmB,CACjB,gBAAkB,eAAuB,gBACzC,kBAAoB,eAAuB,kBAC3C,UAAY,eAAuB,UACnC,aAAe,eAAuB,aACtC,UAAY,eAAuB,UACnC,WAAa,eAAuB,WACpC,YAAc,eAAuB,YACrC,aAAe,eAAuB,cAAgB,UACtD,YAAc,eAAuB,WACvC,CACF,CACF,MAAQ,CAER,CAEA,OAAO,IAAI,KAAK,CACd,QAAS,KACT,QAAS,CACP,GAAI,aAAa,kBAAkB,GACnC,KAAM,aACN,SAAU,mBACV,SAAU,KACV,UAAW,CACT,CACE,KAAM,YACN,OAAQ,mBACR,UAAW,eAAe,WAAa,MACzC,CACF,EACA,oBAAqBH,mBACrB,yBAA0BC,oBAAmB,IAC7C,yBAA0BA,oBAAmB,IAC7C,2BAA4BC,sBAAqB,IACjD,2BAA4BA,sBAAqB,IACjD,cAAe,eAAe,eAAiB,KAC/C,UAAW,eAAe,WAAa,KACvC,oBAAqB,IAAI,KAAK,EAAE,YAAY,EAC5C,IAAK,eAAe,KAAO,KAC3B,gBAAiB,KACjB,eAAgB,CAAC,EACjB,cAAe,KACf,YAAa,CAAC,EACd,sBAAuB,CAAC,EACxB,kBAAmBC,kBACnB,YAAa,CACX,aAAc,EACd,gBAAiB,EACjB,YAAa,EACb,gBAAiB,KACjB,mBAAoB,IACtB,CACF,CACF,CAAC,CACH,CAGA,GAAI,CACF,MAAM,kBAAqB,SAAiB,oBAC5C,MAAM,cAAiB,SAAiB,wBACxC,MAAM,SAAY,SAAiB,oBAC/B,IAAI,KAAM,QAAgB,mBAAmB,EAAE,QAAQ,EACvD,EACJ,MAAM,YAAc,EAAI,GAAK,GAAK,GAAK,IACvC,MAAM,QAAU,CAAC,UAAa,KAAK,IAAI,EAAI,SAAY,YACvD,MAAM,WAAa,QAAQ,QAAQ,gBAAgB,IAAM,SAAW,CAAC,mBAAqB,CAAC,eAE3F,GAAI,WAAY,CACd,MAAM,UAAY,MAAM,yBAAyB,QAAQ,gBAA0B,EACnF,GAAI,UAAW,CACb,MAAM,cAAyC,CAC7C,oBAAqB,IAAI,KAAK,EAAE,YAAY,CAC9C,EACA,GAAI,OAAO,UAAU,YAAc,SAAU,cAAc,oBAAsB,UAAU,UAC3F,GAAI,UAAU,cAAe,cAAc,wBAA0B,UAAU,cAE/E,MAAM,SACH,KAAK,UAAU,EACf,OAAO,aAAoB,EAC3B,GAAG,KAAM,QAAQ,EAAE,EAEtB,QAAU,CACR,GAAG,QACH,GAAI,OAAO,UAAU,YAAc,SAAW,CAAE,oBAAqB,UAAU,SAAU,EAAI,CAAC,EAC9F,GAAI,UAAU,cAAgB,CAAE,wBAAyB,UAAU,aAAc,EAAI,CAAC,EACtF,oBAAqB,cAAc,mBACrC,CACF,CACF,CACF,OAAS,UAAgB,CACvB,QAAQ,KAAK,gDAAiD,WAAW,SAAW,SAAS,CAC/F,CAGA,MAAM,UAAyE,CAAC,EAChF,MAAM,EAAI,QAEV,GAAI,QAAQ,iBAAkB,CAC5B,UAAU,KAAK,CACb,KAAM,YACN,OAAQ,QAAQ,iBAChB,UAAW,EAAE,qBAAuB,MACtC,CAAC,CACH,CACA,GAAI,EAAE,mBAAoB,CACxB,UAAU,KAAK,CACb,KAAM,UACN,OAAQ,EAAE,mBACV,UAAW,EAAE,cAAgB,MAC/B,CAAC,CACH,CACA,GAAI,EAAE,cAAe,CACnB,UAAU,KAAK,CACb,KAAM,SACN,OAAQ,EAAE,cACV,UAAW,EAAE,kBAAoB,MACnC,CAAC,CACH,CACA,GAAI,EAAE,eAAgB,CACpB,UAAU,KAAK,CACb,KAAM,UACN,OAAQ,EAAE,eACV,UAAW,EAAE,mBAAqB,MACpC,CAAC,CACH,CACA,GAAI,EAAE,qBAAsB,CAC1B,UAAU,KAAK,CACb,KAAM,WACN,OAAQ,EAAE,qBACV,UAAW,EAAE,oBAAsB,MACrC,CAAC,CACH,CAGA,MAAM,YAAc,QAAQ,eAC1B,GAAG,QAAQ,YAAc,EAAE,IAAI,QAAQ,WAAa,EAAE,GAAG,KAAK,GAC9D,UAGF,IAAI,WAMA,CACF,aAAc,EACd,gBAAiB,EACjB,YAAa,EACb,gBAAiB,KACjB,mBAAoB,IACtB,EAEA,GAAI,CACF,KAAM,CAAE,KAAM,cAAe,EAAI,MAAM,SACpC,KAAK,aAAa,EAClB,OAAO,yCAAyC,EAChD,GAAG,aAAc,QAAQ,EAAE,EAE9B,MAAM,UAAY,MAAM,QAAQ,cAAc,EAAI,eAAiB,CAAC,EACpE,MAAM,WAAa,UAAU,OAC7B,MAAM,eAAiB,UAAU,OAAQ,GAAW,CAClD,MAAM,QAAU,GAAG,QAAU,IAAI,YAAY,EAC7C,MAAM,SAAW,OAAO,GAAG,sBAAwB,SAAW,EAAE,oBAAsB,EACtF,GAAI,UAAY,IAAK,MAAO,MAC5B,OAAO,OAAO,SAAS,WAAW,GAAK,OAAO,SAAS,QAAQ,GAAK,OAAO,SAAS,UAAU,CAChG,CAAC,EAAE,OACH,MAAM,aAAe,IAAI,IACvB,UACG,IAAK,GAAY,OAAO,GAAG,aAAe,SAAW,EAAE,WAAW,KAAK,EAAE,YAAY,EAAI,EAAG,EAC5F,OAAO,OAAO,CACnB,EAAE,KAEF,KAAM,CAAE,KAAM,YAAa,EAAI,MAAM,SAClC,KAAK,iBAAiB,EACtB,OAAO,gCAAgC,EACvC,GAAG,aAAc,QAAQ,EAAE,EAC3B,GAAG,SAAU,CAAC,WAAY,YAAa,UAAU,CAAC,EAErD,MAAM,wBAA0B,MAAM,QAAQ,YAAY,EAAI,aAAe,CAAC,GAC3E,IAAK,GAAW,CACf,MAAM,QAAU,GAAG,WAAa,IAAI,KAAK,EAAE,UAAU,EAAE,QAAQ,EAAI,IACnE,MAAM,QAAU,GAAG,WAAa,IAAI,KAAK,EAAE,UAAU,EAAE,QAAQ,EAAI,IACnE,GAAI,CAAC,OAAO,SAAS,OAAO,GAAK,CAAC,OAAO,SAAS,OAAO,GAAK,QAAU,QAAS,OAAO,KACxF,MAAM,OAAS,QAAU,UAAY,IAAO,GAAK,IAEjD,GAAI,MAAQ,GAAK,MAAQ,IAAK,OAAO,KACrC,OAAO,KACT,CAAC,EACA,OAAQ,GAAkC,OAAO,IAAM,QAAQ,EAElE,MAAM,iBAAmB,uBAAuB,OAAS,EACrD,uBAAuB,OAAO,CAAC,IAAa,IAAc,IAAM,EAAG,CAAC,EAAI,uBAAuB,OAC/F,KAEJ,WAAa,CACX,aAAc,aACd,gBAAiB,eACjB,YAAa,WACb,gBAAiB,WAAa,EAAI,KAAK,MAAO,eAAiB,WAAc,GAAG,EAAI,KACpF,mBAAoB,mBAAqB,KAAO,KAAK,IAAI,EAAG,KAAK,MAAM,gBAAgB,CAAC,EAAI,IAC9F,CACF,OAAS,WAAY,CACnB,QAAQ,KAAK,kDAAmD,UAAU,CAC5E,CAEA,MAAM,kBAAoB,qBAAqB,OAAO,EACtD,MAAM,mBAAqB,wBAAwB,iBAAiB,EACpE,MAAM,qBAAuB,yBAAyB,iBAAiB,EACvE,IAAI,iBAAmD,KACvD,GAAI,CACF,KAAM,CAAE,KAAM,cAAe,EAAI,MAAM,SACpC,KAAK,iCAAiC,EACtC,OAAO,4HAA4H,EACnI,GAAG,aAAc,QAAQ,EAAE,EAC3B,MAAM,cAAe,CAAE,UAAW,KAAM,CAAC,EACzC,MAAM,CAAC,EACP,YAAY,EAEf,GAAI,eAAgB,CAClB,iBAAmB,CACjB,gBAAkB,eAAuB,gBACzC,kBAAoB,eAAuB,kBAC3C,UAAY,eAAuB,UACnC,aAAe,eAAuB,aACtC,UAAY,eAAuB,UACnC,WAAa,eAAuB,WACpC,YAAc,eAAuB,YACrC,aAAe,eAAuB,cAAgB,UACtD,YAAc,eAAuB,WACvC,CACF,CACF,MAAQ,CAER,CAEA,IAAI,KAAK,CACP,QAAS,KACT,QAAS,CACP,GAAI,QAAQ,GACZ,KAAM,YACN,SAAU,QAAQ,SAClB,SAAU,QAAQ,iBAClB,UACA,oBAAqB,kBACrB,yBAA0B,mBAAmB,IAC7C,yBAA0B,mBAAmB,IAC7C,2BAA4B,qBAAqB,IACjD,2BAA4B,qBAAqB,IACjD,cAAgB,QAAgB,yBAA2B,KAC3D,UAAY,QAAgB,qBAAuB,KACnD,oBAAsB,QAAgB,qBAAuB,KAC7D,IAAK,QAAQ,IACb,gBAAkB,QAAgB,kBAAoB,MACtD,eAAgB,MAAM,QAAS,QAAgB,cAAc,EAAK,QAAgB,eAAiB,CAAC,EACpG,cAAgB,QAAgB,eAAiB,KACjD,YAAa,MAAM,QAAS,QAAgB,WAAW,EAAK,QAAgB,YAAc,CAAC,EAC3F,sBAAuB,MAAM,QAAS,QAAgB,qBAAqB,EAAK,QAAgB,sBAAwB,CAAC,EACzH,kBAAmB,iBACnB,YAAa,UACf,CACF,CAAC,CACH,OAAS,MAAY,CACnB,QAAQ,MAAM,4CAA6C,KAAK,EAChE,QAAQ,MAAM,gCAAiC,MAAM,KAAK,EAC1D,QAAQ,MAAM,+BAAgC,MAAM,IAAI,EACxD,QAAQ,MAAM,kCAAmC,MAAM,OAAO,EAC9D,MAAM,MAAQ,QAAQ,IAAI,WAAa,eAAiB,CAAC,QAAQ,IAAI,SACrE,IAAI,OAAO,GAAG,EAAE,KAAK,CACnB,QAAS,MACT,MAAO,wBACP,QAAS,MAAQ,CACf,QAAS,MAAM,QACf,KAAM,MAAM,KACZ,MAAO,MAAM,MACb,UAAW,KAAK,UAAU,MAAO,OAAO,oBAAoB,KAAK,EAAG,CAAC,CACvE,EAAI,CACF,QAAS,MAAM,OACjB,CACF,CAAC,CACH,CACF,CAAC,EAMD,OAAO,KACL,iCACA,kBAAkB,OAAO,MAAM,EAC/B,MAAO,IAA+C,MAAkB,CACtE,GAAI,CACF,MAAM,KAAO,IAAI,KACjB,GAAI,CAAC,MAAQ,CAAC,KAAK,OAAQ,CACzB,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,wBAAyB,CAAC,CACjF,CACA,MAAM,QAAU,CAAC,aAAc,YAAa,aAAc,WAAW,EACrE,GAAI,CAAC,QAAQ,SAAS,KAAK,QAAQ,EAAG,CACpC,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,kDAAmD,CAAC,CAC3G,CACA,MAAM,IAAM,KAAK,WAAa,aAAe,MAAQ,KAAK,WAAa,YAAc,MAAQ,KAAK,WAAa,aAAe,OAAS,MACvI,MAAM,KAAO,0BAA0B,OAAO,WAAW,CAAC,IAAI,GAAG,GACjE,KAAM,CAAE,MAAO,WAAY,EAAI,MAAM,SAAS,QAC3C,KAAK,gBAAgB,EACrB,OAAO,KAAM,KAAK,OAAQ,CAAE,YAAa,KAAK,SAAU,OAAQ,KAAM,CAAC,EAC1E,GAAI,YAAa,CACf,QAAQ,MAAM,8CAA+C,WAAW,EACxE,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,wBAAyB,CAAC,CACjF,CACA,KAAM,CAAE,KAAM,OAAQ,EAAI,SAAS,QAAQ,KAAK,gBAAgB,EAAE,aAAa,IAAI,EACnF,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,KAAM,IAAK,QAAQ,SAAU,CAAC,CACvE,OAAS,EAAG,CACV,QAAQ,MAAM,kDAAmD,CAAC,EAClE,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,wBAAyB,CAAC,CACjF,CACF,CACF,EAMA,OAAO,KAAK,oBAAqB,MAAO,IAAc,MAAkB,CACtE,GAAI,CACF,KAAM,CAAE,QAAS,EAAI,IAAI,OACzB,KAAM,CACJ,WACA,YACA,cACA,YACA,YACA,cACA,gBACA,YACA,aACA,aACA,mBACA,aACA,yBACA,qBACA,aACA,aACA,SACA,uBACA,uBACA,eACA,cACA,mBACA,uBACA,mBACF,EAAI,IAAI,KAGR,GAAI,CAAC,UAAY,SAAS,KAAK,IAAM,GAAI,CACvC,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,sBACT,CAAC,CACH,CAEA,GAAI,CAAC,YAAc,CAAC,aAAe,CAAC,qBAAsB,CACxD,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,0DACT,CAAC,CACH,CAEA,GAAI,CAAC,eAAiB,OAAO,gBAAkB,UAAY,cAAc,KAAK,EAAE,OAAS,GAAI,CAC3F,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,+GACT,CAAC,CACH,CAEA,GAAI,aAAe,MAAQ,OAAO,cAAgB,UAAY,YAAY,KAAK,EAAG,CAChF,MAAM,MAAQ,YAAY,KAAK,EAAE,YAAY,EAC7C,GAAI,CAAC,iBAAiB,KAAK,KAAK,EAAG,CACjC,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,wDACT,CAAC,CACH,CACF,CAEA,GAAI,CAAC,aAAe,CAAC,CAAC,OAAQ,SAAU,MAAM,EAAE,SAAS,WAAW,EAAG,CACrE,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,sCACT,CAAC,CACH,CAEA,GAAI,CAAC,MAAM,QAAQ,YAAY,GAAK,aAAa,SAAW,EAAG,CAC7D,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,sCACT,CAAC,CACH,CAGA,MAAM,mBAAqB,SAAS,YAAY,EAAE,KAAK,EAGvD,GAAI,CAAE,KAAM,QAAS,MAAO,YAAa,EAAI,MAAM,SAChD,KAAK,UAAU,EACf,OAAO,gCAAgC,EACvC,GAAG,WAAY,kBAAkB,EACjC,GAAG,OAAQ,SAAS,EACpB,YAAY,EAGf,GAAI,CAAC,SAAW,CAAC,aAAc,CAC7B,MAAM,OAAS,MAAM,SAClB,KAAK,UAAU,EACf,OAAO,gCAAgC,EACvC,GAAG,mBAAoB,kBAAkB,EACzC,GAAG,OAAQ,SAAS,EACpB,YAAY,EACf,QAAU,OAAO,KACjB,aAAe,OAAO,KACxB,CAEA,GAAI,cAAgB,CAAC,QAAS,CAC5B,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,mBACT,CAAC,CACH,CAIA,MAAM,SAAW,IAAI,IAAM,IAAI,OAAO,eAAiB,UACvD,MAAM,UAAY,IAAI,IAAI,YAAY,GAAK,UAC3C,MAAM,cAAgB,QAAQ,IAAI,WAAa,eAAiB,CAAC,QAAQ,IAAI,SAC7E,MAAM,eAAiB,QAAQ,IAAI,mBAAqB,OAExD,GAAI,CAAC,eAAiB,CAAC,eAAgB,CACrC,MAAM,WAAa,IAAI,KAAK,KAAK,IAAI,EAAI,GAAK,GAAK,GAAI,EAAE,YAAY,EAErE,KAAM,CAAE,KAAM,kBAAmB,MAAO,cAAe,EAAI,MAAM,SAC9D,KAAK,iBAAiB,EACtB,OAAO,IAAI,EACX,GAAG,cAAe,YAAY,YAAY,EAAE,KAAK,CAAC,EAClD,GAAG,aAAc,QAAQ,EAAE,EAC3B,IAAI,aAAc,UAAU,EAC5B,MAAM,CAAC,EAEV,GAAI,eAAgB,CAClB,QAAQ,MAAM,2CAA4C,cAAc,CAC1E,CAEA,GAAI,mBAAqB,kBAAkB,OAAS,EAAG,CACrD,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,qFACT,CAAC,CACH,CACF,KAAO,CACL,QAAQ,IAAI,6DAA6D,CAC3E,CAGA,MAAM,eAAiB,MAAM,4BAA4B,CACvD,UAAW,WAAW,KAAK,EAC3B,MAAO,YAAY,KAAK,EACxB,MAAO,aAAa,KAAK,GAAK,KAC9B,QAAS,eAAe,KAAK,GAAK,KAClC,UAAW,iBAAiB,KAAK,GAAK,KACtC,QAAS,eAAe,KAAK,GAAK,KAClC,MAAO,aAAe,OAAO,cAAgB,SAAW,YAAY,KAAK,EAAE,YAAY,EAAI,IAC7F,CAAC,EAGD,MAAM,gBAA4B,CAAC,EACnC,GAAI,uBAAwB,gBAAgB,KAAK,sBAAsB,OAAO,sBAAsB,EAAE,KAAK,CAAC,GAAG,uBAAyB,KAAK,OAAO,sBAAsB,EAAE,KAAK,CAAC,IAAM,EAAE,EAAE,EAC5L,GAAI,eAAgB,gBAAgB,KAAK,6BAA6B,OAAO,cAAc,EAAE,KAAK,CAAC,EAAE,EACrG,GAAI,cAAe,gBAAgB,KAAK,4BAA4B,OAAO,aAAa,EAAE,KAAK,CAAC,EAAE,EAClG,GAAI,mBAAoB,gBAAgB,KAAK,2BAA2B,OAAO,kBAAkB,EAAE,KAAK,CAAC,QAAQ,EACjH,GAAI,uBAAwB,gBAAgB,KAAK,gCAAgC,OAAO,sBAAsB,EAAE,KAAK,CAAC,OAAO,EAC7H,GAAI,oBAAqB,gBAAgB,KAAK,mCAAmC,OAAO,mBAAmB,EAAE,KAAK,CAAC,EAAE,EAErH,MAAM,6BAA+B,gBAAgB,OAAS,EAC1D,GAAG,qBAAqB,KAAK,CAAC;AAAA;AAAA;AAAA,IAAuC,gBAAgB,KAAK,MAAM,CAAC,GACjG,qBAAqB,KAAK,EAE9B,MAAM,WAAkB,CACtB,WAAY,QAAQ,GACpB,WAAY,WAAW,KAAK,EAC5B,YAAa,YAAY,YAAY,EAAE,KAAK,EAC5C,cAAe,cAAc,KAAK,EAClC,YAAa,aAAe,OAAO,cAAgB,SAAW,YAAY,KAAK,EAAE,YAAY,EAAI,KACjG,YAAa,aAAa,KAAK,GAAK,KACpC,cAAe,eAAe,KAAK,GAAK,KACxC,gBAAiB,iBAAiB,KAAK,GAAK,KAC5C,YACA,qBAAsB,6BACtB,aAAc,KAAK,UAAU,YAAY,EACzC,aAAc,eAAiB,MAAQ,eAAiB,OACxD,SAAU,UAAY,KACtB,aAAc,SACd,qBAAsB,UACtB,GAAI,eAAiB,CAAE,iBAAkB,cAAe,EAAI,CAAC,CAC/D,EAGA,GAAI,cAAgB,QAAU,cAAgB,OAAQ,CACpD,WAAW,aAAe,cAAgB,KAC1C,WAAW,aAAe,aAAe,WAAW,YAAY,EAAI,IACtE,CAEA,GAAI,cAAgB,UAAY,cAAgB,OAAQ,CACtD,WAAW,mBAAqB,oBAAoB,KAAK,GAAK,KAC9D,WAAW,aAAe,aAAe,WAAW,YAAY,EAAI,KAEpE,GAAI,0BAA4B,MAAQ,OAAO,2BAA6B,SAAU,CACpF,MAAM,QAAU,yBAAyB,KAAK,EAC9C,GAAI,UAAY,QAAQ,WAAW,SAAS,GAAK,QAAQ,WAAW,UAAU,GAAI,CAChF,WAAW,yBAA2B,OACxC,CACF,CACF,CAEA,KAAM,CAAE,KAAM,cAAe,MAAO,WAAY,EAAI,MAAM,SACvD,KAAK,iBAAiB,EACtB,OAAO,UAAU,EACjB,OAAO,4BAA4B,EACnC,OAAO,EAEV,GAAI,YAAa,CACf,QAAQ,MAAM,2CAA4C,WAAW,EACrE,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,wCACT,CAAC,CACH,CAGA,IAAI,eAAsB,KAC1B,GAAI,eAAiB,cAAc,GAAI,CACrC,GAAI,CACF,KAAM,CAAE,KAAM,WAAY,EAAI,MAAM,SACjC,KAAK,UAAU,EACf,OAAO,2NAA2N,EAClO,GAAG,KAAM,QAAQ,EAAE,EACnB,YAAY,EACf,eAAiB,WACnB,OAAS,aAAc,CACrB,QAAQ,KAAK,2EAA4E,YAAY,CACvG,CACF,CAGA,IAAI,YAAc,UAClB,GAAI,eAAgB,CAElB,GAAI,eAAe,eAAiB,eAAe,cAAc,KAAK,EAAG,CACvE,YAAc,eAAe,cAAc,KAAK,CAClD,KAAO,CACL,MAAM,UAAY,eAAe,YAAc,GAC/C,MAAM,SAAW,eAAe,WAAa,GAC7C,MAAM,SAAW,GAAG,SAAS,IAAI,QAAQ,GAAG,KAAK,EACjD,GAAI,SAAU,CACZ,YAAc,QAChB,SAAW,UAAW,CACpB,YAAc,SAChB,SAAW,SAAU,CACnB,YAAc,QAChB,CACF,CACF,CAGA,GAAI,cAAgB,UAAW,CAC7B,GAAI,CACF,KAAM,CAAE,KAAM,QAAS,EAAI,MAAM,SAAS,KAAK,MAAM,YAAY,QAAQ,EAAE,EAC3E,GAAI,UAAU,MAAM,MAAO,CACzB,MAAM,cAAgB,SAAS,KAAK,MAAM,MAAM,GAAG,EAAE,CAAC,EACtD,GAAI,eAAiB,cAAc,QAAU,EAAG,CAC9C,YAAc,cAAc,OAAO,CAAC,EAAE,YAAY,EAAI,cAAc,MAAM,CAAC,CAC7E,CACF,CACF,OAAS,UAAW,CAElB,QAAQ,KAAK,oEAAqE,SAAS,CAC7F,CACF,CAGA,IAAI,kBAA8B,CAAC,EACnC,GAAI,CACF,kBAAoB,OAAO,eAAiB,SACxC,KAAK,MAAM,YAAY,EACvB,cAAgB,CAAC,CACvB,MAAQ,CACN,kBAAoB,MAAM,QAAQ,YAAY,EAAI,aAAe,CAAC,CACpE,CAGA,GAAI,eAAiB,cAAc,GAAI,CACrC,MAAM,UAAsB,CAAC,EAC7B,GAAI,gBAAgB,iBAAkB,UAAU,KAAK,WAAW,EAChE,GAAI,gBAAgB,mBAAoB,UAAU,KAAK,SAAS,EAChE,GAAI,gBAAgB,cAAe,UAAU,KAAK,QAAQ,EAC1D,GAAI,gBAAgB,eAAgB,UAAU,KAAK,SAAS,EAE5D,iCAAiC,YAAa,CAC5C,YACA,iBAAkB,UAAU,OAAS,EAAI,UAAY,OACrD,UAAW,WACX,WAAY,YACZ,YAAa,cAAgB,OAC7B,YAAa,aAAe,WAAW,aAAa,SAAS,CAAC,EAAI,OAClE,kBAAmB,oBAAsB,OACzC,aAAc,kBACd,SAAU,UAAY,OACtB,UAAW,cAAc,EAC3B,CAAC,EAAE,MAAO,YAAe,CACvB,QAAQ,MAAM,gEAAiE,UAAU,CAC3F,CAAC,CACH,CAGA,GAAI,CACF,KAAM,CAAE,MAAO,cAAe,EAAI,MAAM,SACrC,KAAK,oBAAoB,EACzB,OAAO,CACN,WAAY,QAAQ,GACpB,WAAY,SACZ,WAAY,cAAc,GAC1B,YAAa,iBAAiB,SAAS,EACvC,QAAS,OAAO,QAAQ,EACxB,gBAAiB,OAAO,WAAW,QAAQ,EAAE,OAAO,SAAS,EAAE,OAAO,KAAK,EAAE,UAAU,EAAG,EAAE,CAC9F,CAAC,EAEH,GAAI,eAAgB,CAClB,QAAQ,MAAM,gDAAiD,cAAc,CAE/E,CACF,OAAS,eAAgB,CACvB,QAAQ,MAAM,gDAAiD,cAAc,CAE/E,CAGA,GAAI,eAAiB,cAAc,GAAI,CAErC,GAAI,CACF,KAAM,CAAE,KAAM,SAAU,MAAO,SAAU,EAAI,MAAM,SAAS,KAAK,MAAM,YAAY,QAAQ,EAAE,EAE7F,GAAI,CAAC,WAAa,UAAU,MAAM,MAAO,CACvC,MAAM,aAAe,SAAS,KAAK,MAGnC,MAAM,aAAe,QAAQ,IAAI,cAAgB,6BAA6B,QAAQ,MAAO,EAAE,EAC/F,IAAI,UACJ,MAAM,cAAgB,OAAO,YAAY,EAAE,EAAE,SAAS,KAAK,EAC3D,MAAM,gBAAkB,IAAI,KAAK,KAAK,IAAI,EAAI,EAAI,GAAK,GAAK,GAAK,GAAI,EAerE,UAAY,GAAG,WAAW,mBAC1B,QAAQ,KAAK,wFAAwF,EAGrG,MAAM,WAAa,eACnB,IAAI,eAAiB,EACrB,GAAI,YAAY,oBAAqB,gBAAkB,WAAW,oBAClE,GAAI,YAAY,aAAc,gBAAkB,WAAW,aAC3D,GAAI,YAAY,iBAAkB,gBAAkB,WAAW,iBAC/D,GAAI,YAAY,kBAAmB,gBAAkB,WAAW,kBAGhE,0CAA0C,aAAc,CACtD,YACA,gBAAiB,gBAAgB,kBAAoB,OACrD,cAAe,eAAiB,EAAI,eAAiB,OACrD,UAAW,gBAAgB,YAAc,OACzC,UAAW,WACX,aAAc,eAAiB,OAC/B,aAAc,sBAAwB,OACtC,WAAY,YACZ,YAAa,cAAgB,OAC7B,YAAa,aAAe,WAAW,aAAa,SAAS,CAAC,EAAI,OAClE,kBAAmB,oBAAsB,OACzC,YAAa,aAAe,WAAW,aAAa,SAAS,CAAC,EAAI,OAClE,sBAAwB,WAAmB,0BAA4B,OACvE,aAAc,kBACd,SAAU,UAAY,OACtB,SAAU,UAAY,OACtB,MAAO,gBAAgB,OAAS,EAAI,gBAAgB,KAAK,KAAK,EAAI,OAClE,UAAW,cAAc,GACzB,SACF,EAAG,QAAQ,EAAE,EAAE,KAAM,QAAW,CAC9B,GAAI,OAAO,QAAS,CAClB,QAAQ,IAAI,iEAAkE,OAAO,OAAO,CAC9F,KAAO,CACL,QAAQ,KAAK,kEAAmE,OAAO,KAAK,CAC9F,CACF,CAAC,EAAE,MAAO,YAAe,CACvB,QAAQ,MAAM,0EAA2E,UAAU,CACrG,CAAC,EAGD,GAAI,CACF,MAAMC,aAAc,QAAQ,IAAI,cAAgB,4BAChD,MAAM,cAAgB,GAAGA,YAAW,qBAEpC,KAAM,CAAE,MAAO,iBAAkB,EAAI,MAAM,SACxC,KAAK,eAAe,EACpB,OAAO,CACN,QAAS,QAAQ,GACjB,KAAM,OACN,SAAU,iBACV,MAAO,kCAAkC,UAAU,GACnD,QAAS,qEACT,KAAM,CACJ,kBAAmB,cAAc,GACjC,WACA,WACF,EACA,KAAM,cACN,SAAU,OACV,KAAM,iBACN,aAAc,iBACd,YAAa,aACf,CAAC,EAEH,GAAI,kBAAmB,CACrB,QAAQ,KAAK,oEAAqE,iBAAiB,CAErG,KAAO,CACL,QAAQ,IAAI,0DAA0D,CACxE,CACF,OAAS,kBAAmB,CAC1B,QAAQ,KAAK,kEAAmE,iBAAiB,CAEnG,CACF,KAAO,CACL,QAAQ,KAAK,mEAAoE,SAAS,CAC5F,CACF,OAAS,MAAO,CACd,QAAQ,MAAM,mEAAoE,KAAK,CAEzF,CACF,CAEA,IAAI,KAAK,CACP,QAAS,KACT,QAAS,CACP,GAAI,cAAc,GAClB,WAAY,cAAc,WAC1B,aAAc,cAAc,UAC9B,CACF,CAAC,CACH,OAAS,MAAY,CACnB,QAAQ,MAAM,oDAAqD,KAAK,EACxE,IAAI,OAAO,GAAG,EAAE,KAAK,CACnB,QAAS,MACT,MAAO,uBACT,CAAC,CACH,CACF,CAAC,EAUD,OAAO,IAAI,IAAK,MAAO,IAA2B,MAAkB,CAClE,GAAI,CACF,GAAI,CAAC,IAAI,MAAQ,CAAC,IAAI,KAAK,GAAI,CAC7B,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,yBACT,CAAC,CACH,CAEA,MAAM,OAAS,IAAI,KAAK,GACxB,KAAM,CAAE,MAAO,EAAI,IAAI,MAEvB,IAAI,MAAQ,SACT,KAAK,iBAAiB,EACtB,OAAO,GAAG,EACV,GAAG,aAAc,MAAM,EACvB,MAAM,aAAc,CAAE,UAAW,KAAM,CAAC,EAE3C,GAAI,QAAU,OAAO,SAAW,SAAU,CACxC,MAAQ,MAAM,GAAG,SAAU,MAAM,CACnC,CAEA,KAAM,CAAE,KAAM,SAAU,KAAM,EAAI,MAAM,MAExC,GAAI,MAAO,CACT,MAAM,cACJ,MAAM,OAAS,SACf,MAAM,OAAS,SACf,sEAAsE,KAAK,MAAM,SAAW,EAAE,EAChG,GAAI,cAAe,CACjB,QAAQ,KAAK,wFAAyF,MAAM,OAAO,EACnH,OAAO,IAAI,KAAK,CACd,QAAS,KACT,SAAU,CAAC,CACb,CAAC,CACH,CACA,QAAQ,MAAM,4CAA6C,KAAK,EAChE,QAAQ,MAAM,kCAAmC,KAAK,UAAU,MAAO,KAAM,CAAC,CAAC,EAC/E,QAAQ,MAAM,4BAA6B,MAAM,EACjD,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,yCACP,QAAS,QAAQ,IAAI,WAAa,cAAgB,MAAM,QAAU,MACpE,CAAC,CACH,CAEA,IAAI,KAAK,CACP,QAAS,KACT,SAAU,UAAY,CAAC,CACzB,CAAC,CACH,OAAS,MAAY,CACnB,QAAQ,MAAM,mCAAoC,KAAK,EACvD,IAAI,OAAO,GAAG,EAAE,KAAK,CACnB,QAAS,MACT,MAAO,uBACT,CAAC,CACH,CACF,CAAC,EAMD,OAAO,KAAK,kBAAmB,MAAO,IAA2B,MAAkB,CACjF,GAAI,CACF,MAAM,OAAS,IAAI,KAAM,GACzB,KAAM,CAAE,YAAa,EAAI,IAAI,MAAQ,CAAC,EACtC,MAAM,SAAW,OAAO,eAAiB,SAAW,aAAa,KAAK,EAAI,GAC1E,GAAI,CAAC,SAAU,CACb,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,cAAe,CAAC,CACvE,CACA,MAAM,SAAW,IAAI,IAAO,IAAI,QAAgB,eAAiB,UACjE,MAAM,UAAY,IAAI,IAAI,YAAY,GAAK,UAiB3C,QAAQ,KAAK,8EAA8E,EAC3F,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,wDAAyD,CAAC,EAE/G,KAAM,CAAE,KAAM,QAAS,MAAO,YAAa,EAAI,MAAM,SAClD,KAAK,iBAAiB,EACtB,OAAO,GAAG,EACV,GAAG,KAAM,SAAS,iBAAiB,EACnC,YAAY,EACf,GAAI,cAAgB,CAAC,QAAS,CAC5B,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,mBAAoB,CAAC,CAC5E,CACA,GAAI,QAAQ,aAAe,OAAQ,CACjC,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,sCAAuC,CAAC,CAC/F,CACA,GAAI,QAAQ,SAAW,UAAW,CAChC,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,uCAAwC,CAAC,CAChG,CAEA,MAAM,GAAK,QAAQ,GACnB,MAAM,IAAM,IAAI,KAAK,EAAE,YAAY,EAGnC,IAAI,kBAA8B,CAAC,EACnC,GAAI,CACF,kBAAoB,OAAO,QAAQ,eAAiB,SAChD,KAAK,MAAM,QAAQ,YAAY,EAC/B,QAAQ,cAAgB,CAAC,CAC/B,MAAQ,CACN,kBAAoB,CAAC,CACvB,CACA,IAAI,WAAa,EACjB,GAAI,QAAQ,cAAgB,QAAU,QAAQ,cAAgB,OAAQ,CACpE,WAAa,QAAQ,cAAgB,CACvC,CACA,MAAM,SAAW,QAAQ,cAAgB,SAEzC,MAAM,SAAgB,CACpB,WAAY,OACZ,WAAY,QAAQ,WACpB,YAAa,QAAQ,YACrB,YAAa,WACb,aAAc,kBAAkB,KAAK,IAAI,EACzC,SAAU,QAAQ,UAAY,IAAI,KAAK,KAAK,IAAI,EAAI,GAAK,GAAK,GAAK,GAAK,GAAI,EAAE,YAAY,EAAE,MAAM,GAAG,EAAE,CAAC,EACxG,sBAAuB,QAAQ,UAAY,IAAI,KAAK,KAAK,IAAI,EAAI,GAAK,GAAK,GAAK,GAAK,GAAI,EAAE,YAAY,EAAE,MAAM,GAAG,EAAE,CAAC,EACrH,SAAU,QACV,OAAQ,WACR,UAAW,SAAW,SAAW,OACjC,YAAa,iBACb,cAAe,QAAQ,cACvB,YAAa,QAAQ,WAEvB,EACA,KAAM,CAAE,KAAM,KAAM,MAAO,SAAU,EAAI,MAAM,SAC5C,KAAK,aAAa,EAClB,OAAO,QAAQ,EACf,OAAO,IAAI,EACX,OAAO,EACV,GAAI,WAAa,CAAC,KAAM,CACtB,QAAQ,MAAM,sDAAuD,SAAS,EAC9E,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,uBAAwB,CAAC,CAChF,CAEA,MAAM,mBAAqB,MAAM,4BAA4B,CAC3D,UAAW,QAAQ,YAAc,GACjC,MAAO,QAAQ,aAAe,GAC9B,MAAO,QAAQ,aAAe,KAC9B,QAAS,KACT,UAAW,KACX,QAAS,QAAQ,eAAe,KAAK,GAAK,KAC1C,MAAO,QAAQ,aAAa,KAAK,EAAE,YAAY,GAAK,IACtD,CAAC,EACD,GAAI,mBAAoB,CACtB,MAAM,SAAS,KAAK,aAAa,EAAE,OAAO,CAAE,iBAAkB,mBAAoB,WAAY,GAAI,CAAC,EAAE,GAAG,KAAM,KAAK,EAAE,CACvH,CAGA,KAAM,CAAE,MAAO,WAAY,EAAI,MAAM,SAClC,KAAK,iBAAiB,EACtB,OAAO,CACN,OAAQ,WACR,QAAS,KAAK,GACd,WAAY,GACd,CAAC,EACA,GAAG,KAAM,EAAE,EAEd,GAAI,YAAa,CACf,QAAQ,MAAM,2CAA4C,WAAW,CACvE,CAGA,MAAM,SAAS,KAAK,kBAAkB,EAAE,OAAO,CAC7C,QAAS,KAAK,GACd,QAAS,OACT,MAAO,iBACP,SAAU,CACR,kBAAmB,GACnB,YAAa,aACb,WAAY,SACZ,WAAY,UACZ,YAAa,QAAQ,YACrB,OAAQ,gBACV,CACF,CAAC,EAAE,KAAK,CAAC,CAAE,MAAO,MAAO,IAAM,CAC7B,GAAI,OAAQ,QAAQ,KAAK,4CAA6C,MAAM,CAC9E,CAAC,EAED,GAAI,SAAU,CACZ,OAAO,IAAI,KAAK,CACd,QAAS,KACT,KAAM,CAAE,GAAI,KAAK,EAAG,EACpB,uBAAwB,KACxB,QAAS,6EACX,CAAC,CACH,CAEA,IAAI,YAA6B,KACjC,IAAI,mBAAoC,KACxC,GAAI,CACF,KAAM,CAAE,KAAM,YAAa,EAAI,MAAM,SAClC,KAAK,aAAa,EAClB,OAAO,mBAAmB,EAC1B,GAAG,KAAM,KAAK,EAAE,EAChB,OAAO,EACV,GAAI,cAAc,kBAAmB,CACnC,YAAc,aAAa,iBAC7B,KAAO,CACL,KAAM,CAAE,KAAM,eAAgB,MAAO,YAAa,EAAI,MAAM,SACzD,KAAK,UAAU,EACf,OAAO,iCAAiC,EACxC,GAAG,KAAM,MAAM,EACf,YAAY,EACf,GAAI,aAAc,MAAM,IAAI,MAAM,iCAAiC,EACnE,MAAM,YAAc,eAChB,GAAG,eAAe,YAAc,EAAE,IAAI,eAAe,WAAa,EAAE,GAAG,KAAK,GAAK,UACjF,UACJ,MAAM,aAAe,gBAAgB,OAAS,IAAI,MAAM,OAAS,OACjE,MAAM,eAAiB,gBAAgB,UAAY,gBAAgB,SAAW,OAC9E,IAAI,aACJ,GAAI,QAAQ,cAAgB,QAAU,QAAQ,cAAgB,OAAQ,CACpE,aAAe,uBAAuB,QAAQ,SAAW,IAAI,KAAK,QAAQ,QAAQ,EAAE,mBAAmB,EAAI,IAAI,KAAK,KAAK,IAAI,EAAI,GAAK,GAAK,GAAK,GAAK,GAAI,EAAE,mBAAmB,CAAC,EACjL,CACA,MAAM,WAAa,CACjB,YAAa,WACb,aAAc,kBAAkB,OAAS,EAAI,kBAAoB,CAAC,kBAAkB,EACpF,kBAAmB,QAAQ,UAAY,IAAI,KAAK,KAAK,IAAI,EAAI,GAAK,GAAK,GAAK,GAAK,GAAI,EAAE,YAAY,EAAE,MAAM,GAAG,EAAE,CAAC,EACjH,QAAS,CAAE,OAAQ,gBAAiB,SAAU,cAAgB,mCAAoC,EAClG,MAAO,CAAE,KAAM,QAAQ,aAAe,YAAc,gBAAiB,UAAW,CAAC,eAAe,EAAG,SAAU,WAAY,SAAU,MAAO,aAAc,KAAM,EAC9J,YAAa,CAAE,QAAS,MAAO,SAAU,KAAM,SAAU,IAAK,EAC9D,YAAa,CAAE,YAAa,CAAE,EAC9B,kBAAmB,QACrB,EACA,MAAM,eAAiB,MAAM,4BAA4B,CACvD,UAAW,QAAQ,WACnB,YACA,aACA,WACA,aAAc,kBAAkB,OAAS,EAAI,kBAAoB,CAAC,kBAAkB,EACpF,aACA,QAAS,QAAQ,SAAW,IAAI,KAAK,QAAQ,QAAQ,EAAE,mBAAmB,EAAI,OAC9E,oBAAqB,QAAQ,SAAW,IAAI,KAAK,QAAQ,QAAQ,EAAE,mBAAmB,EAAI,OAC1F,SAAU,qBACV,WAAY,QAAQ,aAAe,OACnC,aAAc,QAAQ,eAAe,KAAK,GAAK,OAC/C,WAAY,QAAQ,aAAa,KAAK,GAAK,OAC3C,eACA,WACA,UAAW,QAAQ,aAAe,YAAc,gBAChD,eAAgB,CAAC,eAAe,EAChC,cAAe,WACf,eAAgB,MAChB,oBAAqB,MACrB,mBAAoB,MACpB,oBAAqB,KACrB,oBAAqB,KACrB,sBAAuB,EACvB,iBAAkB,SAClB,gBAAiB,QAAQ,cAAgB,UAAY,QAAQ,mBAAqB,yBAAyB,QAAQ,kBAAkB,GAAK,MAC5I,CAAC,EACD,MAAM,UAAY,KAAK,IAAI,EAC3B,MAAM,YAAc,aAAa,KAAK,EAAE,IAAI,SAAS,IAAI,eAAe,QAAQ,GAChF,KAAM,CAAE,MAAO,WAAY,EAAI,MAAM,SAAS,QAC3C,KAAK,gBAAgB,EACrB,OAAO,YAAa,eAAe,aAAc,CAChD,YAAa,0EACb,OAAQ,KACV,CAAC,EACH,GAAI,YAAa,MAAM,IAAI,MAAM,2BAA2B,EAC5D,KAAM,CAAE,KAAM,aAAc,EAAI,SAAS,QAAQ,KAAK,gBAAgB,EAAE,aAAa,WAAW,EAChG,YAAc,eAAe,WAAa,KAC1C,GAAI,YAAa,CACf,MAAM,SAAS,KAAK,aAAa,EAAE,OAAO,CACxC,kBAAmB,YACnB,OAAQ,WACR,WAAY,GACd,CAAC,EAAE,GAAG,KAAM,KAAK,EAAE,CACrB,CACA,MAAM,MAAQ,MAAM,yBAAyB,CAAE,OAAQ,KAAK,GAAI,UAAW,OAAQ,UAAW,IAAK,CAAC,EACpG,mBAAqB,MAAM,GAC3B,GAAI,QAAQ,aAAe,mBAAoB,CAC7C,MAAM,oBAAsB,eACxB,GAAI,eAAuB,YAAc,EAAE,IAAK,eAAuB,WAAa,EAAE,GAAG,KAAK,GAAK,UACnG,UACJ,+BAA+B,QAAQ,YAAa,CAClD,YAAa,oBACb,UAAW,QAAQ,WACnB,WACA,SAAU,QAAQ,cAAgB,SAAW,SAAW,OACxD,aAAc,kBAAkB,OAAS,EAAI,kBAAoB,CAAC,kBAAkB,EACpF,mBACA,YAAa,aAAe,OAC5B,YAAa,QAAQ,cAAgB,MACvC,CAAC,EAAE,MAAO,GAAM,QAAQ,MAAM,uDAAwD,CAAC,CAAC,CAC1F,CACF,CACF,OAAS,YAAa,CACpB,QAAQ,MAAM,+DAAgE,WAAW,CAC3F,CAEA,OAAO,IAAI,KAAK,CACd,QAAS,KACT,KAAM,CAAE,GAAI,KAAK,EAAG,EACpB,SAAU,YAAc,CAAE,IAAK,YAAa,MAAO,kBAAmB,EAAI,KAC1E,QAAS,YAAc,oEAAsE,gBAC/F,CAAC,CACH,OAAS,MAAY,CACnB,QAAQ,MAAM,yCAA0C,KAAK,EAC7D,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAAE,QAAS,MAAO,MAAO,sBAAuB,CAAC,CAC/E,CACF,CAAC,EAMD,OAAO,MAAM,cAAe,MAAO,IAA2B,MAAkB,CAC9E,GAAI,CACF,MAAM,OAAS,IAAI,KAAM,GACzB,KAAM,CAAE,EAAG,EAAI,IAAI,OAGnB,KAAM,CAAE,KAAM,QAAS,MAAO,YAAa,EAAI,MAAM,SAClD,KAAK,iBAAiB,EACtB,OAAO,GAAG,EACV,GAAG,KAAM,EAAE,EACX,GAAG,aAAc,MAAM,EACvB,YAAY,EAEf,GAAI,cAAgB,CAAC,QAAS,CAC5B,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,iCACT,CAAC,CACH,CAEA,GAAI,QAAQ,SAAW,UAAW,CAChC,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,oCACT,CAAC,CACH,CAGA,IAAI,kBAA8B,CAAC,EACnC,GAAI,CACF,kBAAoB,OAAO,QAAQ,eAAiB,SAChD,KAAK,MAAM,QAAQ,YAAY,EAC/B,QAAQ,cAAgB,CAAC,CAC/B,MAAQ,CACN,kBAAoB,CAAC,CACvB,CAGA,IAAI,WAAa,EACjB,GAAI,QAAQ,cAAgB,QAAU,QAAQ,cAAgB,OAAQ,CACpE,WAAa,QAAQ,cAAgB,CACvC,CAEA,MAAM,SAAW,QAAQ,cAAgB,SAGzC,MAAM,SAAgB,CACpB,WAAY,OACZ,WAAY,QAAQ,WACpB,YAAa,QAAQ,YACrB,YAAa,WACb,aAAc,kBAAkB,KAAK,IAAI,EACzC,SAAU,QAAQ,UAAY,IAAI,KAAK,KAAK,IAAI,EAAI,GAAK,GAAK,GAAK,GAAK,GAAI,EAAE,YAAY,EAAE,MAAM,GAAG,EAAE,CAAC,EACxG,sBAAuB,QAAQ,UAAY,IAAI,KAAK,KAAK,IAAI,EAAI,GAAK,GAAK,GAAK,GAAK,GAAI,EAAE,YAAY,EAAE,MAAM,GAAG,EAAE,CAAC,EACrH,SAAU,QACV,OAAQ,WACR,UAAW,SAAW,SAAW,OACjC,YAAa,iBACb,cAAe,QAAQ,cACvB,YAAa,QAAQ,WAEvB,EAEA,KAAM,CAAE,KAAM,KAAM,MAAO,SAAU,EAAI,MAAM,SAC5C,KAAK,aAAa,EAClB,OAAO,QAAQ,EACf,OAAO,IAAI,EACX,OAAO,EAEV,GAAI,WAAa,CAAC,KAAM,CACtB,QAAQ,MAAM,wCAAyC,SAAS,EAChE,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,uBACT,CAAC,CACH,CAGA,MAAM,mBAAqB,MAAM,4BAA4B,CAC3D,UAAW,QAAQ,YAAc,GACjC,MAAO,QAAQ,aAAe,GAC9B,MAAO,QAAQ,aAAe,KAC9B,QAAS,KACT,UAAW,KACX,QAAS,QAAQ,eAAe,KAAK,GAAK,KAC1C,MAAO,QAAQ,aAAa,KAAK,EAAE,YAAY,GAAK,IACtD,CAAC,EACD,GAAI,mBAAoB,CACtB,MAAM,SAAS,KAAK,aAAa,EAAE,OAAO,CAAE,iBAAkB,mBAAoB,WAAY,IAAI,KAAK,EAAE,YAAY,CAAE,CAAC,EAAE,GAAG,KAAM,KAAK,EAAE,CAC5I,CAEA,MAAM,IAAM,IAAI,KAAK,EAAE,YAAY,EACnC,MAAM,SAAW,IAAI,IAAO,IAAI,QAAgB,eAAiB,UACjE,MAAM,UAAY,IAAI,IAAI,YAAY,GAAK,UAG3C,KAAM,CAAE,MAAO,WAAY,EAAI,MAAM,SAClC,KAAK,iBAAiB,EACtB,OAAO,CACN,OAAQ,WACR,QAAS,KAAK,GACd,WAAY,GACd,CAAC,EACA,GAAG,KAAM,EAAE,EAEd,GAAI,YAAa,CACf,QAAQ,MAAM,2CAA4C,WAAW,CACvE,CAGA,MAAM,SAAS,KAAK,kBAAkB,EAAE,OAAO,CAC7C,QAAS,KAAK,GACd,QAAS,OACT,MAAO,iBACP,SAAU,CACR,kBAAmB,GACnB,YAAa,UACb,WAAY,SACZ,WAAY,UACZ,YAAa,QAAQ,YACrB,OAAQ,gBACV,CACF,CAAC,EAAE,KAAK,CAAC,CAAE,MAAO,MAAO,IAAM,CAC7B,GAAI,OAAQ,QAAQ,KAAK,4CAA6C,MAAM,CAC9E,CAAC,EAGD,GAAI,SAAU,CACZ,OAAO,IAAI,KAAK,CACd,QAAS,KACT,KAAM,CAAE,GAAI,KAAK,EAAG,EACpB,uBAAwB,KACxB,QAAS,6EACX,CAAC,CACH,CAGA,KAAM,CAAE,KAAM,SAAU,EAAI,MAAM,SAC/B,KAAK,aAAa,EAClB,OAAO,WAAW,EAClB,GAAG,KAAM,KAAK,EAAE,EAChB,OAAO,EACV,GAAK,WAAmB,YAAc,SAAU,CAC9C,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,4CACT,CAAC,CACH,CAEA,IAAI,YAA6B,KACjC,IAAI,mBAAoC,KAExC,GAAI,CAEF,KAAM,CAAE,KAAM,YAAa,EAAI,MAAM,SAClC,KAAK,aAAa,EAClB,OAAO,mBAAmB,EAC1B,GAAG,KAAM,KAAK,EAAE,EAChB,OAAO,EAEV,GAAI,cAAc,kBAAmB,CAEnC,QAAQ,IAAI,qDAAsD,KAAK,EAAE,EACzE,YAAc,aAAa,iBAC7B,KAAO,CAEL,KAAM,CAAE,KAAM,eAAgB,MAAO,YAAa,EAAI,MAAM,SACzD,KAAK,UAAU,EACf,OAAO,iCAAiC,EACxC,GAAG,KAAM,MAAM,EACf,YAAY,EAEf,GAAI,aAAc,CAChB,QAAQ,MAAM,mDAAoD,YAAY,CAGhF,CAGA,MAAM,YAAc,eAChB,GAAG,eAAe,YAAc,EAAE,IAAI,eAAe,WAAa,EAAE,GAAG,KAAK,GAAK,UACjF,UAGJ,MAAM,aAAe,IAAI,MAAM,OAAS,OAExC,MAAM,eAAiB,gBAAgB,UAAY,OAGnD,IAAI,aACJ,GAAI,QAAQ,cAAgB,QAAU,QAAQ,cAAgB,OAAQ,CACpE,MAAM,YAAc,QAAQ,SACxB,IAAI,KAAK,QAAQ,QAAQ,EAAE,mBAAmB,EAC9C,IAAI,KAAK,KAAK,IAAI,EAAI,GAAK,GAAK,GAAK,GAAK,GAAI,EAAE,mBAAmB,EACvE,aAAe,uBAAuB,WAAW,EACnD,CAGA,MAAM,WAAa,CACjB,YAAa,WACb,aAAc,kBAAkB,OAAS,EAAI,kBAAoB,CAAC,kBAAkB,EACpF,kBAAmB,QAAQ,UAAY,IAAI,KAAK,KAAK,IAAI,EAAI,GAAK,GAAK,GAAK,GAAK,GAAI,EAAE,YAAY,EAAE,MAAM,GAAG,EAAE,CAAC,EACjH,QAAS,CACP,OAAQ,gBACR,SAAU,cAAgB,mCAC5B,EACA,MAAO,CACL,KAAM,QAAQ,aAAe,YAAc,gBAC3C,UAAW,CAAC,eAAe,EAC3B,SAAU,WACV,SAAU,MACV,aAAc,KAChB,EACA,YAAa,CACX,QAAS,MACT,SAAU,KACV,SAAU,IACZ,EACA,YAAa,CACX,YAAa,CACf,EACA,kBAAmB,QACrB,EAGA,MAAM,eAAiB,MAAM,4BAA4B,CACvD,UAAW,QAAQ,WACnB,YACA,aACA,WACA,aAAc,kBAAkB,OAAS,EAAI,kBAAoB,CAAC,kBAAkB,EACpF,aACA,QAAS,QAAQ,SACb,IAAI,KAAK,QAAQ,QAAQ,EAAE,mBAAmB,EAC9C,OACJ,oBAAqB,QAAQ,SACzB,IAAI,KAAK,QAAQ,QAAQ,EAAE,mBAAmB,EAC9C,OACJ,SAAU,qBACV,WAAY,QAAQ,aAAe,OACnC,aAAc,QAAQ,eAAe,KAAK,GAAK,OAC/C,WAAY,QAAQ,aAAa,KAAK,GAAK,OAC3C,eACA,WACA,UAAW,QAAQ,aAAe,YAAc,gBAChD,eAAgB,CAAC,eAAe,EAChC,cAAe,WACf,eAAgB,MAChB,oBAAqB,MACrB,mBAAoB,MACpB,oBAAqB,KACrB,oBAAqB,KACrB,sBAAuB,EACvB,iBAAkB,SAClB,gBAAiB,QAAQ,cAAgB,UAAY,QAAQ,mBACzD,yBAAyB,QAAQ,kBAAkB,GACnD,MACN,CAAC,EAGD,MAAM,UAAY,KAAK,IAAI,EAC3B,MAAM,YAAc,aAAa,KAAK,EAAE,IAAI,SAAS,IAAI,eAAe,QAAQ,GAEhF,KAAM,CAAE,MAAO,WAAY,EAAI,MAAM,SAAS,QAC3C,KAAK,gBAAgB,EACrB,OAAO,YAAa,eAAe,aAAc,CAChD,YAAa,0EACb,OAAQ,KACV,CAAC,EAEH,GAAI,YAAa,CACf,QAAQ,MAAM,0CAA2C,WAAW,EACpE,MAAM,IAAI,MAAM,2BAA2B,CAC7C,CAGA,KAAM,CAAE,KAAM,aAAc,EAAI,SAAS,QACtC,KAAK,gBAAgB,EACrB,aAAa,WAAW,EAE3B,YAAc,eAAe,WAAa,KAE1C,GAAI,CAAC,YAAa,CAChB,MAAM,IAAI,MAAM,4BAA4B,CAC9C,CAGA,KAAM,CAAE,MAAO,mBAAoB,EAAI,MAAM,SAC1C,KAAK,aAAa,EAClB,OAAO,CACN,kBAAmB,YACnB,OAAQ,iBACR,WAAY,IAAI,KAAK,EAAE,YAAY,CACrC,CAAC,EACA,GAAG,KAAM,KAAK,EAAE,EAEnB,GAAI,oBAAqB,CACvB,QAAQ,MAAM,sDAAuD,mBAAmB,CAE1F,CAGA,GAAI,CACF,MAAM,MAAQ,MAAM,yBAAyB,CAC3C,OAAQ,KAAK,GACb,UAAW,OACX,UAAW,IACb,CAAC,EACD,mBAAqB,MAAM,GAG3B,GAAI,QAAQ,aAAe,mBAAoB,CAC7C,+BAA+B,QAAQ,YAAa,CAClD,YACA,UAAW,QAAQ,WACnB,WACA,SAAU,QAAQ,cAAgB,SAAW,SAAW,OACxD,aAAc,kBAAkB,OAAS,EAAI,kBAAoB,CAAC,kBAAkB,EACpF,mBACA,YAAa,aAAe,MAC9B,CAAC,EAAE,MAAO,YAAe,CACvB,QAAQ,MAAM,gEAAiE,UAAU,CAC3F,CAAC,CACH,CAGA,KAAM,CAAE,oCAAqC,EAAI,KAAM,QAAO,0CAA0C,8FACxG,qCACE,cAAgB,GAChB,YACA,QAAQ,WACR,KAAK,EACP,EAAE,MAAO,YAAe,CACtB,QAAQ,MAAM,uEAAwE,UAAU,CAClG,CAAC,CACH,OAAS,WAAY,CACnB,QAAQ,MAAM,wDAAyD,UAAU,CAEnF,CAEA,QAAQ,IAAI,6DAA8D,KAAK,EAAE,CACnF,CACF,OAAS,cAAoB,CAE3B,QAAQ,MAAM,8CAA+C,aAAa,CAE5E,CAEA,IAAI,KAAK,CACP,QAAS,KACT,KAAM,CACJ,GAAI,KAAK,EACX,EACA,SAAU,YAAc,CACtB,IAAK,YACL,MAAO,kBACT,EAAI,KACJ,QAAS,YACL,oFACA,4DACN,CAAC,CACH,OAAS,MAAY,CACnB,QAAQ,MAAM,+CAAgD,KAAK,EACnE,IAAI,OAAO,GAAG,EAAE,KAAK,CACnB,QAAS,MACT,MAAO,uBACT,CAAC,CACH,CACF,CAAC,EAMD,OAAO,MAAM,eAAgB,MAAO,IAA2B,MAAkB,CAC/E,GAAI,CACF,MAAM,OAAS,IAAI,KAAM,GACzB,KAAM,CAAE,EAAG,EAAI,IAAI,OACnB,KAAM,CAAE,YAAa,aAAc,cAAe,KAAM,EAAI,IAAI,KAEhE,GAAI,CAAC,aAAe,CAAC,aAAc,CACjC,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,kDACT,CAAC,CACH,CAGA,KAAM,CAAE,KAAM,QAAS,MAAO,YAAa,EAAI,MAAM,SAClD,KAAK,iBAAiB,EACtB,OAAO,GAAG,EACV,GAAG,KAAM,EAAE,EACX,GAAG,aAAc,MAAM,EACvB,YAAY,EAEf,GAAI,cAAgB,CAAC,QAAS,CAC5B,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,iCACT,CAAC,CACH,CAEA,GAAI,QAAQ,SAAW,UAAW,CAChC,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,oCACT,CAAC,CACH,CAGA,MAAM,aAAe,CACnB,YAAa,YAAc,WAAW,WAAW,EAAI,KACrD,aAAc,cAAgB,KAC9B,cAAe,eAAiB,KAChC,MAAO,OAAS,KAChB,aAAc,IAAI,KAAK,EAAE,YAAY,CACvC,EAGA,KAAM,CAAE,MAAO,WAAY,EAAI,MAAM,SAClC,KAAK,iBAAiB,EACtB,OAAO,CACN,OAAQ,YACR,cAAe,aACf,WAAY,IAAI,KAAK,EAAE,YAAY,CACrC,CAAC,EACA,GAAG,KAAM,EAAE,EAEd,GAAI,YAAa,CACf,QAAQ,MAAM,2CAA4C,WAAW,EACrE,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,gCACT,CAAC,CACH,CAGA,GAAI,QAAQ,YAAa,CAEvB,KAAM,CAAE,KAAM,cAAe,EAAI,MAAM,SACpC,KAAK,UAAU,EACf,OAAO,uBAAuB,EAC9B,GAAG,KAAM,MAAM,EACf,YAAY,EAEf,MAAM,YAAc,eAChB,GAAG,eAAe,YAAc,EAAE,IAAI,eAAe,WAAa,EAAE,GAAG,KAAK,GAAK,UACjF,UAEJ,8BAA8B,QAAQ,YAAa,CACjD,YACA,UAAW,QAAQ,WACnB,eAAgB,QAAQ,cAAgB,QAAQ,cAAgB,KAChE,aAAc,YAAc,WAAW,WAAW,EAAI,OACtD,oBAAqB,cAAgB,OACrC,aAAc,OAAS,OACvB,UAAW,EACb,CAAC,EAAE,MAAO,YAAe,CACvB,QAAQ,MAAM,mEAAoE,UAAU,CAC9F,CAAC,CACH,CAEA,IAAI,KAAK,CACP,QAAS,KACT,QAAS,sCACX,CAAC,CACH,OAAS,MAAY,CACnB,QAAQ,MAAM,gDAAiD,KAAK,EACpE,IAAI,OAAO,GAAG,EAAE,KAAK,CACnB,QAAS,MACT,MAAO,uBACT,CAAC,CACH,CACF,CAAC,EAMD,OAAO,MAAM,eAAgB,MAAO,IAA2B,MAAkB,CAC/E,GAAI,CACF,MAAM,OAAS,IAAI,KAAM,GACzB,KAAM,CAAE,EAAG,EAAI,IAAI,OAGnB,KAAM,CAAE,KAAM,QAAS,MAAO,YAAa,EAAI,MAAM,SAClD,KAAK,iBAAiB,EACtB,OAAO,GAAG,EACV,GAAG,KAAM,EAAE,EACX,GAAG,aAAc,MAAM,EACvB,YAAY,EAEf,GAAI,cAAgB,CAAC,QAAS,CAC5B,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,iCACT,CAAC,CACH,CAEA,GAAI,QAAQ,SAAW,UAAW,CAChC,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,oCACT,CAAC,CACH,CAGA,KAAM,CAAE,MAAO,WAAY,EAAI,MAAM,SAClC,KAAK,iBAAiB,EACtB,OAAO,CACN,OAAQ,WACR,WAAY,IAAI,KAAK,EAAE,YAAY,CACrC,CAAC,EACA,GAAG,KAAM,EAAE,EAEd,GAAI,YAAa,CACf,QAAQ,MAAM,2CAA4C,WAAW,EACrE,OAAO,IAAI,OAAO,GAAG,EAAE,KAAK,CAC1B,QAAS,MACT,MAAO,2BACT,CAAC,CACH,CAGA,GAAI,QAAQ,YAAa,CAEvB,KAAM,CAAE,KAAM,cAAe,EAAI,MAAM,SACpC,KAAK,UAAU,EACf,OAAO,iCAAiC,EACxC,GAAG,KAAM,MAAM,EACf,YAAY,EAEf,MAAM,YAAc,eAChB,GAAG,eAAe,YAAc,EAAE,IAAI,eAAe,WAAa,EAAE,GAAG,KAAK,GAAK,UACjF,UAEJ,MAAM,gBAAkB,gBAAgB,UAAY,UAEpD,+BAA+B,QAAQ,YAAa,CAClD,YACA,UAAW,QAAQ,WACnB,eACF,CAAC,EAAE,MAAO,YAAe,CACvB,QAAQ,MAAM,6DAA8D,UAAU,CACxF,CAAC,CACH,CAEA,IAAI,KAAK,CACP,QAAS,KACT,QAAS,gCACX,CAAC,CACH,OAAS,MAAY,CACnB,QAAQ,MAAM,gDAAiD,KAAK,EACpE,IAAI,OAAO,GAAG,EAAE,KAAK,CACnB,QAAS,MACT,MAAO,uBACT,CAAC,CACH,CACF,CAAC,EAED,IAAO,uBAAQ","names":["suggestedReelRate","suggestedPaidRange","suggestedBarterRange","performanceProof","frontendUrl"],"ignoreList":[],"sources":["/Users/pratyushraj/Documents/noticebazaar/server/src/routes/collabRequests.ts"],"sourcesContent":[null]}}