{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import{generateContractDocx}from\"./contractDocxGenerator.js\";import{mapDealSchemaToContractVariables,validateRequiredContractFields}from\"./contractTemplate.js\";import{variablesToSchema}from\"./contractSchema.js\";async function generateContractFromScratch(request){try{console.log(\"[ContractGenerator] Generating contract from scratch using v2 template system (template-first architecture)...\");const validation=validateRequiredContractFields({name:request.brandName,address:request.brandAddress,email:request.brandEmail},{name:request.creatorName,address:request.creatorAddress,email:request.creatorEmail});if(!validation.isValid){const errorMessage=`Missing required fields: ${validation.missingFields.join(\", \")}. Please complete all required details to generate a valid contract.`;console.error(\"[ContractGenerator] Validation failed:\",validation.missingFields);const error=new Error(errorMessage);error.missingFields=validation.missingFields;throw error}const dealSchema=request.dealSchema||{deal_amount:request.dealAmount,deliverables:Array.isArray(request.deliverables)?request.deliverables:[request.deliverables||\"As per agreement\"],delivery_deadline:request.dueDate,payment:{method:\"Bank Transfer\",timeline:request.paymentTerms||request.paymentExpectedDate?`Within 7 days of content delivery (expected by ${request.paymentExpectedDate||\"agreed date\"})`:\"Within 7 days of content delivery\"},usage:{type:request.usageType||\"Non-exclusive\",platforms:request.usagePlatforms||(request.platform?[request.platform]:[\"All platforms\"]),duration:request.usageDuration||\"6 months\",paid_ads:request.paidAdsAllowed||false,whitelisting:request.whitelistingAllowed||false},exclusivity:{enabled:request.exclusivityEnabled||false,category:request.exclusivityCategory||null,duration:request.exclusivityDuration||null},termination:{notice_days:request.terminationNoticeDays||7},jurisdiction_city:request.jurisdictionCity};const variables=mapDealSchemaToContractVariables(dealSchema,{name:request.brandName,address:request.brandAddress||\"\",email:request.brandEmail||\"\",gstin:request.brandGstin?.trim()||void 0},{name:request.creatorName,address:request.creatorAddress||\"\",email:request.creatorEmail||\"\"});if(!variables.jurisdiction_city||variables.jurisdiction_city.trim()===\"\"){throw new Error(\"Jurisdiction could not be determined from party addresses. Please ensure addresses include city and state information.\")}console.log(\"[ContractGenerator] Generating DOCX contract with template engine (DOCX-first architecture)...\");console.log(\"[ContractGenerator] Currency amount:\",dealSchema.deal_amount);console.log(\"[ContractGenerator] Deliverables:\",JSON.stringify(dealSchema.deliverables));console.log(\"[ContractGenerator] Variables deal_amount_formatted:\",variables.deal_amount_formatted);const contractSchema=variablesToSchema(variables,request.additionalTerms,{contract_version:\"v3\",generated_at:new Date().toISOString(),generated_by:request.additionalTerms?\"ai-assisted\":\"template-first\",has_additional_terms:!!(request.additionalTerms&&request.additionalTerms.trim().length>0)});if(request.brandSignature){contractSchema.brand_signature=request.brandSignature}if(request.creatorSignature){contractSchema.creator_signature=request.creatorSignature}console.log(\"[ContractGenerator] Generating DOCX from ContractSchema...\");const contractDocx=await generateContractDocx(contractSchema);console.log(\"[ContractGenerator] DOCX generated successfully, size:\",contractDocx.length,\"bytes\");const brandNameClean=request.brandName.replace(/[^a-zA-Z0-9]/g,\"_\");const creatorNameClean=request.creatorName.replace(/[^a-zA-Z0-9]/g,\"_\");const fileName=`${brandNameClean}_${creatorNameClean}_Agreement_v3.docx`;return{contractDocx,fileName,contentType:\"application/vnd.openxmlformats-officedocument.wordprocessingml.document\",metadata:{contract_version:\"v3\",jurisdiction_used:variables.jurisdiction_city,generated_at:new Date().toISOString(),generated_by:request.additionalTerms?\"ai-assisted\":\"template-first\",has_additional_terms:!!(request.additionalTerms&&request.additionalTerms.trim().length>0)}}}catch(error){console.error(\"[ContractGenerator] Failed to generate contract:\",error);throw new Error(`Failed to generate contract: ${error.message}`)}}__name(generateContractFromScratch,\"generateContractFromScratch\");export{generateContractFromScratch};\n","warnings":[],"map":{"version":3,"mappings":"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","names":[],"ignoreList":[],"sources":["/Users/pratyushraj/Documents/noticebazaar/server/src/services/contractGenerator.ts"],"sourcesContent":[null]}}