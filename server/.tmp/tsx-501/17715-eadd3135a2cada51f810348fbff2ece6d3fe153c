{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import{supabase}from\"../lib/supabase.js\";const BASE_RATE_PER_FOLLOWER=.06;const MIN_REEL_RATE=1500;const MAX_REEL_RATE=8e5;function estimateReelRate(followers){if(!followers||followers<=0)return MIN_REEL_RATE;let estimated=followers*BASE_RATE_PER_FOLLOWER;if(followers>5e6){estimated=Math.max(estimated,15e4)}else if(followers>1e6){estimated=Math.max(estimated,8e4)}else if(followers>5e5){estimated=Math.max(estimated,4e4)}if(followers>=1e4){estimated=Math.max(estimated,2e3)}else if(followers>=5e3){estimated=Math.max(estimated,1500)}return Math.max(MIN_REEL_RATE,Math.min(MAX_REEL_RATE,Math.round(estimated)))}__name(estimateReelRate,\"estimateReelRate\");function estimateReelBudgetRange(rate){const safeRate=Math.max(MIN_REEL_RATE,Math.round(rate||MIN_REEL_RATE));return{min:Math.round(safeRate*.8),max:Math.round(safeRate*1.2)}}__name(estimateReelBudgetRange,\"estimateReelBudgetRange\");function estimateBarterValueRange(rate){const safeRate=Math.max(MIN_REEL_RATE,Math.round(rate||MIN_REEL_RATE));return{min:Math.round(safeRate*.9),max:Math.round(safeRate*1.3)}}__name(estimateBarterValueRange,\"estimateBarterValueRange\");function getEffectiveReelRate(profile){if(profile.avg_rate_reel&&profile.avg_rate_reel>0){return profile.avg_rate_reel}if(profile.learned_avg_rate_reel&&profile.learned_avg_rate_reel>0){return profile.learned_avg_rate_reel}return estimateReelRate(profile.instagram_followers||0)}__name(getEffectiveReelRate,\"getEffectiveReelRate\");async function updateLearnedRateForCreator(creatorId,dealAmount){try{const{data:profile,error:fetchError}=await supabase.from(\"profiles\").select(\"learned_avg_rate_reel, learned_deal_count\").eq(\"id\",creatorId).single();if(fetchError||!profile){console.error(\"[CreatorRateService] Failed to fetch profile for rate update:\",fetchError);return}const oldCount=profile.learned_deal_count||0;const oldRate=profile.learned_avg_rate_reel||0;const newCount=oldCount+1;const newRate=Math.round((oldRate*oldCount+dealAmount)/newCount);const{error:updateError}=await supabase.from(\"profiles\").update({learned_avg_rate_reel:newRate,learned_deal_count:newCount,updated_at:new Date().toISOString()}).eq(\"id\",creatorId);if(updateError){console.error(\"[CreatorRateService] Failed to update profile with learned rate:\",updateError)}else{console.log(`[CreatorRateService] Updated learned rate for creator ${creatorId}: \\u20B9${newRate} (${newCount} deals)`)}}catch(err){console.error(\"[CreatorRateService] Unexpected error updating learned rate:\",err)}}__name(updateLearnedRateForCreator,\"updateLearnedRateForCreator\");function qualifiesForRateLearning(deal){if(!deal)return false;const isPaid=deal.deal_type===\"paid\"||deal.deal_amount&&deal.deal_amount>0;if(!isPaid)return false;const deliverablesStr=typeof deal.deliverables===\"string\"?deal.deliverables:JSON.stringify(deal.deliverables||\"\");const hasReel=deliverablesStr.toLowerCase().includes(\"reel\");return hasReel}__name(qualifiesForRateLearning,\"qualifiesForRateLearning\");export{estimateBarterValueRange,estimateReelBudgetRange,estimateReelRate,getEffectiveReelRate,qualifiesForRateLearning,updateLearnedRateForCreator};\n","warnings":[],"map":{"version":3,"mappings":"kHACA,OAAS,aAAgB,qBAQzB,MAAM,uBAAyB,IAC/B,MAAM,cAAgB,KACtB,MAAM,cAAgB,IAMf,SAAS,iBAAiB,UAAkC,CAC/D,GAAI,CAAC,WAAa,WAAa,EAAG,OAAO,cAEzC,IAAI,UAAY,UAAY,uBAG5B,GAAI,UAAY,IAAS,CACrB,UAAY,KAAK,IAAI,UAAW,IAAM,CAC1C,SAAW,UAAY,IAAS,CAC5B,UAAY,KAAK,IAAI,UAAW,GAAK,CACzC,SAAW,UAAY,IAAQ,CAC3B,UAAY,KAAK,IAAI,UAAW,GAAK,CACzC,CAGA,GAAI,WAAa,IAAO,CACpB,UAAY,KAAK,IAAI,UAAW,GAAI,CACxC,SAAW,WAAa,IAAM,CAC1B,UAAY,KAAK,IAAI,UAAW,IAAI,CACxC,CAEA,OAAO,KAAK,IAAI,cAAe,KAAK,IAAI,cAAe,KAAK,MAAM,SAAS,CAAC,CAAC,CACjF,CAtBgB,4CAwBT,SAAS,wBAAwB,KAAmD,CACvF,MAAM,SAAW,KAAK,IAAI,cAAe,KAAK,MAAM,MAAQ,aAAa,CAAC,EAC1E,MAAO,CACH,IAAK,KAAK,MAAM,SAAW,EAAG,EAC9B,IAAK,KAAK,MAAM,SAAW,GAAG,CAClC,CACJ,CANgB,0DAQT,SAAS,yBAAyB,KAAmD,CACxF,MAAM,SAAW,KAAK,IAAI,cAAe,KAAK,MAAM,MAAQ,aAAa,CAAC,EAC1E,MAAO,CACH,IAAK,KAAK,MAAM,SAAW,EAAG,EAC9B,IAAK,KAAK,MAAM,SAAW,GAAG,CAClC,CACJ,CANgB,4DAWT,SAAS,qBAAqB,QAAsB,CACvD,GAAI,QAAQ,eAAiB,QAAQ,cAAgB,EAAG,CACpD,OAAO,QAAQ,aACnB,CAEA,GAAI,QAAQ,uBAAyB,QAAQ,sBAAwB,EAAG,CACpE,OAAO,QAAQ,qBACnB,CAEA,OAAO,iBAAiB,QAAQ,qBAAuB,CAAC,CAC5D,CAVgB,oDAgBhB,eAAsB,4BAA4B,UAAmB,WAAoB,CACrF,GAAI,CAEA,KAAM,CAAE,KAAM,QAAS,MAAO,UAAW,EAAI,MAAM,SAC9C,KAAK,UAAU,EACf,OAAO,2CAA2C,EAClD,GAAG,KAAM,SAAS,EAClB,OAAO,EAEZ,GAAI,YAAc,CAAC,QAAS,CACxB,QAAQ,MAAM,gEAAiE,UAAU,EACzF,MACJ,CAEA,MAAM,SAAW,QAAQ,oBAAsB,EAC/C,MAAM,QAAU,QAAQ,uBAAyB,EAGjD,MAAM,SAAW,SAAW,EAC5B,MAAM,QAAU,KAAK,OAAQ,QAAU,SAAY,YAAc,QAAQ,EAGzE,KAAM,CAAE,MAAO,WAAY,EAAI,MAAM,SAChC,KAAK,UAAU,EACf,OAAO,CACJ,sBAAuB,QACvB,mBAAoB,SACpB,WAAY,IAAI,KAAK,EAAE,YAAY,CACvC,CAAC,EACA,GAAG,KAAM,SAAS,EAEvB,GAAI,YAAa,CACb,QAAQ,MAAM,mEAAoE,WAAW,CACjG,KAAO,CACH,QAAQ,IAAI,yDAAyD,SAAS,WAAM,OAAO,KAAK,QAAQ,SAAS,CACrH,CACJ,OAAS,IAAK,CACV,QAAQ,MAAM,+DAAgE,GAAG,CACrF,CACJ,CAvCsB,kEA6Cf,SAAS,yBAAyB,KAAoB,CACzD,GAAI,CAAC,KAAM,MAAO,OAGlB,MAAM,OAAS,KAAK,YAAc,QAAW,KAAK,aAAe,KAAK,YAAc,EACpF,GAAI,CAAC,OAAQ,MAAO,OAGpB,MAAM,gBAAkB,OAAO,KAAK,eAAiB,SAC/C,KAAK,aACL,KAAK,UAAU,KAAK,cAAgB,EAAE,EAE5C,MAAM,QAAU,gBAAgB,YAAY,EAAE,SAAS,MAAM,EAE7D,OAAO,OACX,CAfgB","names":[],"ignoreList":[],"sources":["/Users/pratyushraj/Documents/noticebazaar/server/src/services/creatorRateService.ts"],"sourcesContent":[null]}}