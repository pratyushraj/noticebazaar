{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import*as pdfjsLib from\"pdfjs-dist\";function detectDocumentType(buffer,url){const signature=buffer.slice(0,8);if(signature[0]===37&&signature[1]===80&&signature[2]===68&&signature[3]===70){return\"pdf\"}if(signature[0]===80&&signature[1]===75){return\"docx\"}if(signature[0]===208&&signature[1]===207&&signature[2]===17&&signature[3]===224){return\"doc\"}if(url){const urlLower=url.toLowerCase();if(urlLower.endsWith(\".pdf\"))return\"pdf\";if(urlLower.endsWith(\".docx\"))return\"docx\";if(urlLower.endsWith(\".doc\"))return\"doc\"}return\"pdf\"}__name(detectDocumentType,\"detectDocumentType\");async function extractTextFromPDF(buffer){try{if(pdfjsLib.GlobalWorkerOptions){if(typeof process!==\"undefined\"&&process.versions&&process.versions.node){pdfjsLib.GlobalWorkerOptions.workerSrc=\"\";console.log(\"[DocumentExtractor] Node.js environment - worker disabled\")}}}catch(error){console.warn(\"[DocumentExtractor] Error setting PDF.js worker (non-critical):\",error.message)}const uint8Array=new Uint8Array(buffer);if(uint8Array.length===0){throw new Error(\"PDF buffer is empty\")}let pdf;try{let getDocument=pdfjsLib.getDocument;if(!getDocument||typeof getDocument!==\"function\"){getDocument=pdfjsLib.default?.getDocument}if(!getDocument||typeof getDocument!==\"function\"){const lib=pdfjsLib;if(lib.getDocument)getDocument=lib.getDocument;else if(lib.default?.getDocument)getDocument=lib.default.getDocument}if(!getDocument||typeof getDocument!==\"function\"){throw new Error(\"pdfjsLib.getDocument is not a function\")}const loadingTask=getDocument({data:uint8Array,verbosity:0,stopAtErrors:false,maxImageSize:1024*1024*10});pdf=await loadingTask.promise}catch(error){console.error(\"[DocumentExtractor] PDF loading error:\",error);if(error.name===\"InvalidPDFException\"||error.message?.includes(\"Invalid PDF\")){throw new Error(\"Invalid PDF structure. Please ensure the file is a valid PDF document.\")}throw new Error(`Failed to load PDF: ${error.message||\"Unknown error\"}`)}let fullText=\"\";for(let i=1;i<=pdf.numPages;i++){const page=await pdf.getPage(i);const textContent=await page.getTextContent();const pageText=textContent.items.map(item=>item.str).join(\" \");fullText+=pageText+\"\\n\"}if(!fullText||fullText.trim().length===0){throw new Error(\"No text could be extracted from PDF. The PDF may contain only images.\")}return fullText}__name(extractTextFromPDF,\"extractTextFromPDF\");async function extractTextFromDOCX(buffer){try{const mammoth=await import(\"mammoth\").then(s=>{const e=\"default\";return s[e]&&typeof s[e]==\"object\"&&\"__esModule\"in s[e]?s[e]:s});const result=await mammoth.extractRawText({buffer});const text=result.value;if(!text||text.trim().length===0){throw new Error(\"No text could be extracted from DOCX file.\")}return text}catch(error){if(error.code===\"MODULE_NOT_FOUND\"){throw new Error(\"DOCX support requires mammoth package. Run: pnpm add mammoth\")}throw new Error(`Failed to extract text from DOCX: ${error.message||\"Unknown error\"}`)}}__name(extractTextFromDOCX,\"extractTextFromDOCX\");async function extractTextFromDOC(buffer){throw new Error(\"DOC files (old Microsoft Word format) are not fully supported. Please convert your document to DOCX or PDF format. You can do this by opening the file in Microsoft Word and saving as DOCX or PDF.\")}__name(extractTextFromDOC,\"extractTextFromDOC\");async function extractTextFromDocument(buffer,url){const docType=detectDocumentType(buffer,url);console.log(\"[DocumentExtractor] Detected document type:\",docType);switch(docType){case\"pdf\":return await extractTextFromPDF(buffer);case\"docx\":return await extractTextFromDOCX(buffer);case\"doc\":return await extractTextFromDOC(buffer);default:throw new Error(`Unsupported document type: ${docType}`)}}__name(extractTextFromDocument,\"extractTextFromDocument\");export{detectDocumentType,extractTextFromDocument};\n","warnings":[],"map":{"version":3,"mappings":"kHAIA,UAAY,aAAc,aAQnB,SAAS,mBAAmB,OAAgB,IAA4B,CAE7E,MAAM,UAAY,OAAO,MAAM,EAAG,CAAC,EAGnC,GAAI,UAAU,CAAC,IAAM,IAAQ,UAAU,CAAC,IAAM,IAAQ,UAAU,CAAC,IAAM,IAAQ,UAAU,CAAC,IAAM,GAAM,CACpG,MAAO,KACT,CAGA,GAAI,UAAU,CAAC,IAAM,IAAQ,UAAU,CAAC,IAAM,GAAM,CAClD,MAAO,MACT,CAIA,GAAI,UAAU,CAAC,IAAM,KAAQ,UAAU,CAAC,IAAM,KAAQ,UAAU,CAAC,IAAM,IAAQ,UAAU,CAAC,IAAM,IAAM,CACpG,MAAO,KACT,CAGA,GAAI,IAAK,CACP,MAAM,SAAW,IAAI,YAAY,EACjC,GAAI,SAAS,SAAS,MAAM,EAAG,MAAO,MACtC,GAAI,SAAS,SAAS,OAAO,EAAG,MAAO,OACvC,GAAI,SAAS,SAAS,MAAM,EAAG,MAAO,KACxC,CAGA,MAAO,KACT,CA9BgB,gDAmChB,eAAe,mBAAmB,OAAiC,CAEjE,GAAI,CACF,GAAI,SAAS,oBAAqB,CAChC,GAAI,OAAO,UAAY,aAAe,QAAQ,UAAY,QAAQ,SAAS,KAAM,CAC/E,SAAS,oBAAoB,UAAY,GACzC,QAAQ,IAAI,2DAA2D,CACzE,CACF,CACF,OAAS,MAAY,CACnB,QAAQ,KAAK,kEAAmE,MAAM,OAAO,CAC/F,CAEA,MAAM,WAAa,IAAI,WAAW,MAAM,EAExC,GAAI,WAAW,SAAW,EAAG,CAC3B,MAAM,IAAI,MAAM,qBAAqB,CACvC,CAGA,IAAI,IACJ,GAAI,CACF,IAAI,YAAe,SAAiB,YACpC,GAAI,CAAC,aAAe,OAAO,cAAgB,WAAY,CACrD,YAAe,SAAiB,SAAS,WAC3C,CACA,GAAI,CAAC,aAAe,OAAO,cAAgB,WAAY,CACrD,MAAM,IAAW,SACjB,GAAI,IAAI,YAAa,YAAc,IAAI,oBAC9B,IAAI,SAAS,YAAa,YAAc,IAAI,QAAQ,WAC/D,CAEA,GAAI,CAAC,aAAe,OAAO,cAAgB,WAAY,CACrD,MAAM,IAAI,MAAM,wCAAwC,CAC1D,CAEA,MAAM,YAAc,YAAY,CAC9B,KAAM,WACN,UAAW,EACX,aAAc,MACd,aAAc,KAAO,KAAO,EAC9B,CAAC,EACD,IAAM,MAAM,YAAY,OAC1B,OAAS,MAAY,CACnB,QAAQ,MAAM,yCAA0C,KAAK,EAC7D,GAAI,MAAM,OAAS,uBAAyB,MAAM,SAAS,SAAS,aAAa,EAAG,CAClF,MAAM,IAAI,MAAM,wEAAwE,CAC1F,CACA,MAAM,IAAI,MAAM,uBAAuB,MAAM,SAAW,eAAe,EAAE,CAC3E,CAGA,IAAI,SAAW,GACf,QAAS,EAAI,EAAG,GAAK,IAAI,SAAU,IAAK,CACtC,MAAM,KAAO,MAAM,IAAI,QAAQ,CAAC,EAChC,MAAM,YAAc,MAAM,KAAK,eAAe,EAC9C,MAAM,SAAW,YAAY,MAC1B,IAAK,MAAe,KAAkB,GAAG,EACzC,KAAK,GAAG,EACX,UAAY,SAAW,IACzB,CAEA,GAAI,CAAC,UAAY,SAAS,KAAK,EAAE,SAAW,EAAG,CAC7C,MAAM,IAAI,MAAM,uEAAuE,CACzF,CAEA,OAAO,QACT,CAnEe,gDAwEf,eAAe,oBAAoB,OAAiC,CAClE,GAAI,CAEF,MAAM,QAAU,KAAM,QAAO,SAAS,8FAEtC,MAAM,OAAS,MAAM,QAAQ,eAAe,CAAE,MAAO,CAAC,EACtD,MAAM,KAAO,OAAO,MAEpB,GAAI,CAAC,MAAQ,KAAK,KAAK,EAAE,SAAW,EAAG,CACrC,MAAM,IAAI,MAAM,4CAA4C,CAC9D,CAEA,OAAO,IACT,OAAS,MAAY,CACnB,GAAI,MAAM,OAAS,mBAAoB,CACrC,MAAM,IAAI,MAAM,8DAA8D,CAChF,CACA,MAAM,IAAI,MAAM,qCAAqC,MAAM,SAAW,eAAe,EAAE,CACzF,CACF,CAnBe,kDAyBf,eAAe,mBAAmB,OAAiC,CAMjE,MAAM,IAAI,MACR,qMAGF,CACF,CAXe,gDAgBf,eAAsB,wBAAwB,OAAgB,IAA+B,CAC3F,MAAM,QAAU,mBAAmB,OAAQ,GAAG,EAC9C,QAAQ,IAAI,8CAA+C,OAAO,EAElE,OAAQ,QAAS,CACf,IAAK,MACH,OAAO,MAAM,mBAAmB,MAAM,EACxC,IAAK,OACH,OAAO,MAAM,oBAAoB,MAAM,EACzC,IAAK,MACH,OAAO,MAAM,mBAAmB,MAAM,EACxC,QACE,MAAM,IAAI,MAAM,8BAA8B,OAAO,EAAE,CAC3D,CACF,CAdsB","names":[],"ignoreList":[],"sources":["/Users/pratyushraj/Documents/noticebazaar/server/src/services/documentTextExtractor.ts"],"sourcesContent":[null]}}