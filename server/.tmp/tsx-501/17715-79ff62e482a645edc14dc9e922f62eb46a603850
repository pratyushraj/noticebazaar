{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import{analyzeContractWithAI}from\"./aiContractAnalysis.js\";import{calculateNegotiationPowerScore}from\"./negotiationPowerScore.js\";import{extractTextFromDocument,detectDocumentType}from\"./documentTextExtractor.js\";function isValidBrandDealContract(text){const t=text.toLowerCase();const rejectionPatterns=[{pattern:\"legal notice\",exact:false},{pattern:\"zoomcar\",exact:false},{pattern:\"booking id\",exact:false},{pattern:\"vehicle rental\",exact:false},{pattern:\"vehicle damage\",exact:false},{pattern:\"repair estimate\",exact:false},{pattern:\"insurance claim\",exact:false},{pattern:\"insurance policy\",exact:false},{pattern:\"court order\",exact:false},{pattern:\"plaintiff\",exact:false},{pattern:\"defendant\",exact:false},{pattern:\"invoice number\",exact:false},{pattern:\"receipt number\",exact:false},{pattern:\"gst certificate\",exact:false},{pattern:\"gst registration\",exact:false},{pattern:\"aadhaar card\",exact:false},{pattern:\"pan card\",exact:false},{pattern:\"tax form\",exact:false},{pattern:\"government form\",exact:false}];for(const{pattern,exact}of rejectionPatterns){if(exact?t===pattern:t.includes(pattern)){console.log(\"[BackendValidation] \\u274C HARD REJECTION PATTERN:\",pattern);return{valid:false,score:0,reason:\"Hard rejection pattern: \"+pattern}}}console.log(\"[BackendValidation] \\u2713 No hard rejection patterns found\");const positiveSignals={roles:[\"brand\",\"creator\",\"influencer\"],content:[\"post\",\"video\",\"reel\",\"story\",\"content\",\"deliverable\"],deal:[\"campaign\",\"collaboration\",\"sponsorship\",\"promotion\"],money:[\"payment\",\"fee\",\"compensation\",\"consideration\",\"amount\"],rights:[\"usage\",\"license\",\"intellectual property\",\"ip\"],exclusivity:[\"exclusive\",\"exclusivity\",\"non compete\"]};let matches=0;const matchedGroups=[];Object.entries(positiveSignals).forEach(([groupName,words])=>{if(words.some(word=>t.includes(word))){matches+=1;matchedGroups.push(groupName)}});console.log(\"[BackendValidation] Positive signal matches:\",matches,\"Groups:\",matchedGroups);if(matches>=2){console.log(\"[BackendValidation] \\u2705 BRAND DEAL DETECTED (\",matches,\"signal groups matched)\");return{valid:true,score:Math.min(100,matches*15),reason:\"Brand deal detected: \"+matchedGroups.join(\", \")}}console.log(\"[BackendValidation] \\u274C Not enough brand deal signals (\",matches,\"groups, need 2+)\");return{valid:false,score:matches,reason:\"Not enough brand deal signals (found \"+matches+\", need 2+)\"}}__name(isValidBrandDealContract,\"isValidBrandDealContract\");async function analyzeContract(documentBuffer,documentUrl){const docType=detectDocumentType(documentBuffer,documentUrl);console.log(\"[ContractAnalysis] Document type detected:\",docType);let fullText;try{fullText=await extractTextFromDocument(documentBuffer,documentUrl);console.log(\"[ContractAnalysis] Text extracted, length:\",fullText.length)}catch(error){console.error(\"[ContractAnalysis] Text extraction error:\",error);if(docType===\"doc\"){throw new Error(\"DOC files (old Microsoft Word format) are not fully supported. Please convert your document to DOCX or PDF format and try again.\")}if(error.message?.includes(\"Invalid PDF\")||error.message?.includes(\"PDF structure\")){throw new Error(\"Invalid document structure. Please ensure the file is a valid PDF, DOCX, or DOC document.\")}throw new Error(`Failed to extract text from document: ${error.message||\"Unknown error\"}`)}if(!fullText||fullText.trim().length<50){throw new Error(\"Document contains insufficient text for analysis. Please ensure the document has readable text content.\")}console.log(\"[ContractAnalysis] Sending FULL extracted text to AI for comprehensive analysis...\");console.log(\"[ContractAnalysis] Text length:\",fullText.length,\"characters\");const analysis=await analyzeContractText(fullText);const negotiationPowerScore=calculateNegotiationPowerScore(analysis);analysis.negotiationPowerScore=negotiationPowerScore;console.log(\"[ContractAnalysis] Negotiation Power Score calculated:\",negotiationPowerScore);return analysis}__name(analyzeContract,\"analyzeContract\");async function analyzeContractText(text){const provider=process.env.LLM_PROVIDER||\"huggingface\";const model=process.env.LLM_MODEL||\"mistralai/Mistral-7B-Instruct-v0.2\";console.log(`[ContractAnalysis] Using ${provider} AI-powered analysis with model: ${model}`);console.log(`[ContractAnalysis] Sending FULL text (${text.length} characters) to AI`);try{const aiAnalysis=await analyzeContractWithAI(text);console.log(`[ContractAnalysis] ${provider} AI analysis completed successfully`);console.log(\"[ContractAnalysis] AI Decisions:\",{documentType:aiAnalysis.documentType,contractCategory:aiAnalysis.detectedContractCategory,brandDetected:aiAnalysis.brandDetected,riskScore:aiAnalysis.riskScore});const result=aiAnalysis;result.negotiationPowerScore=calculateNegotiationPowerScore(result);console.log(\"[ContractAnalysis] Negotiation Power Score calculated:\",result.negotiationPowerScore);return result}catch(error){console.error(`[ContractAnalysis] ${provider} AI analysis failed:`,error);throw new Error(`${provider} AI analysis failed: ${error.message||\"Unknown error\"}. No rule-based fallback available.`)}}__name(analyzeContractText,\"analyzeContractText\");function extractDealValue(text){const match=text.match(/â‚¹[\\s]*([\\d,]+)|(\\$[\\s]*[\\d,]+)|([\\d,]+[\\s]*(?:rupees|rs|inr))/i);return match?match[0]:void 0}__name(extractDealValue,\"extractDealValue\");function extractDuration(text){const match=text.match(/(\\d+)[\\s]*(?:month|week|day)s?/i);return match?`${match[1]} ${match[2]||\"months\"}`:void 0}__name(extractDuration,\"extractDuration\");function extractDeliverables(text){const match=text.match(/(\\d+)[\\s]*(?:video|post|reel|story|content)/i);return match?match[0]:\"As per contract\"}__name(extractDeliverables,\"extractDeliverables\");function extractPaymentSchedule(text){if(text.match(/milestone|installment/i))return\"Milestone-based\";if(text.match(/advance|upfront/i))return\"Advance + Post Delivery\";if(text.match(/monthly|retainer/i))return\"Monthly Retainer\";return\"Standard\"}__name(extractPaymentSchedule,\"extractPaymentSchedule\");function extractExclusivity(text){const match=text.match(/(\\d+)[\\s]*(?:day|week|month)[\\s]*exclusivity/i);return match?match[1]:void 0}__name(extractExclusivity,\"extractExclusivity\");export{analyzeContract,isValidBrandDealContract};\n","warnings":[],"map":{"version":3,"mappings":"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","names":[],"ignoreList":[],"sources":["/Users/pratyushraj/Documents/noticebazaar/server/src/services/contractAnalysis.ts"],"sourcesContent":[null]}}