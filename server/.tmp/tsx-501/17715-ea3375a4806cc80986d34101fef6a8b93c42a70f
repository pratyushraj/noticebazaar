{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import{supabase}from\"../lib/supabase.js\";function normalizeEmail(email){return(email||\"\").trim().toLowerCase()}__name(normalizeEmail,\"normalizeEmail\");async function resolveOrCreateBrandContact(fields){const emailNorm=normalizeEmail(fields.email);if(!emailNorm)return null;const row={email_normalized:emailNorm,legal_name:(fields.legalName||\"\").trim()||null,email:(fields.email||\"\").trim()||null,phone:(fields.phone||\"\").trim()||null,website:(fields.website||\"\").trim()||null,instagram:(fields.instagram||\"\").trim()||null,address:(fields.address||\"\").trim()||null,gstin:(fields.gstin||\"\").trim().toUpperCase()||null,industry:(fields.industry||\"\").trim()||null,last_seen_at:new Date().toISOString(),updated_at:new Date().toISOString()};const{data:existing}=await supabase.from(\"brand_contacts\").select(\"id, legal_name, phone, website, instagram, address, gstin\").eq(\"email_normalized\",emailNorm).maybeSingle();if(existing){const update={last_seen_at:row.last_seen_at,updated_at:row.updated_at};if(row.legal_name&&!existing.legal_name)update.legal_name=row.legal_name;if(row.phone&&!existing.phone)update.phone=row.phone;if(row.website&&!existing.website)update.website=row.website;if(row.instagram&&!existing.instagram)update.instagram=row.instagram;if(row.address&&!existing.address)update.address=row.address;if(row.gstin&&!existing.gstin)update.gstin=row.gstin;await supabase.from(\"brand_contacts\").update(update).eq(\"id\",existing.id);return existing.id}const insert={...row,first_seen_at:new Date().toISOString(),created_at:new Date().toISOString()};const{data:created,error}=await supabase.from(\"brand_contacts\").insert(insert).select(\"id\").single();if(error){console.error(\"[BrandContactService] Insert error:\",error);return null}return created?.id??null}__name(resolveOrCreateBrandContact,\"resolveOrCreateBrandContact\");export{resolveOrCreateBrandContact};\n","warnings":[],"map":{"version":3,"mappings":"kHAKA,OAAS,aAAgB,qBAazB,SAAS,eAAe,MAAuB,CAC7C,OAAQ,OAAS,IAAI,KAAK,EAAE,YAAY,CAC1C,CAFS,wCAQT,eAAsB,4BAA4B,OAAoD,CACpG,MAAM,UAAY,eAAe,OAAO,KAAK,EAC7C,GAAI,CAAC,UAAW,OAAO,KAEvB,MAAM,IAAM,CACV,iBAAkB,UAClB,YAAa,OAAO,WAAa,IAAI,KAAK,GAAK,KAC/C,OAAQ,OAAO,OAAS,IAAI,KAAK,GAAK,KACtC,OAAQ,OAAO,OAAS,IAAI,KAAK,GAAK,KACtC,SAAU,OAAO,SAAW,IAAI,KAAK,GAAK,KAC1C,WAAY,OAAO,WAAa,IAAI,KAAK,GAAK,KAC9C,SAAU,OAAO,SAAW,IAAI,KAAK,GAAK,KAC1C,OAAQ,OAAO,OAAS,IAAI,KAAK,EAAE,YAAY,GAAK,KACpD,UAAW,OAAO,UAAY,IAAI,KAAK,GAAK,KAC5C,aAAc,IAAI,KAAK,EAAE,YAAY,EACrC,WAAY,IAAI,KAAK,EAAE,YAAY,CACrC,EAEA,KAAM,CAAE,KAAM,QAAS,EAAI,MAAM,SAC9B,KAAK,gBAAgB,EACrB,OAAO,2DAA2D,EAClE,GAAG,mBAAoB,SAAS,EAChC,YAAY,EAEf,GAAI,SAAU,CACZ,MAAM,OAAkC,CACtC,aAAc,IAAI,aAClB,WAAY,IAAI,UAClB,EACA,GAAI,IAAI,YAAc,CAAC,SAAS,WAAY,OAAO,WAAa,IAAI,WACpE,GAAI,IAAI,OAAS,CAAC,SAAS,MAAO,OAAO,MAAQ,IAAI,MACrD,GAAI,IAAI,SAAW,CAAC,SAAS,QAAS,OAAO,QAAU,IAAI,QAC3D,GAAI,IAAI,WAAa,CAAC,SAAS,UAAW,OAAO,UAAY,IAAI,UACjE,GAAI,IAAI,SAAW,CAAC,SAAS,QAAS,OAAO,QAAU,IAAI,QAC3D,GAAI,IAAI,OAAS,CAAC,SAAS,MAAO,OAAO,MAAQ,IAAI,MAErD,MAAM,SAAS,KAAK,gBAAgB,EAAE,OAAO,MAAM,EAAE,GAAG,KAAM,SAAS,EAAE,EACzE,OAAO,SAAS,EAClB,CAEA,MAAM,OAAS,CACb,GAAG,IACH,cAAe,IAAI,KAAK,EAAE,YAAY,EACtC,WAAY,IAAI,KAAK,EAAE,YAAY,CACrC,EAEA,KAAM,CAAE,KAAM,QAAS,KAAM,EAAI,MAAM,SACpC,KAAK,gBAAgB,EACrB,OAAO,MAAM,EACb,OAAO,IAAI,EACX,OAAO,EAEV,GAAI,MAAO,CACT,QAAQ,MAAM,sCAAuC,KAAK,EAC1D,OAAO,IACT,CACA,OAAO,SAAS,IAAM,IACxB,CAzDsB","names":[],"ignoreList":[],"sources":["/Users/pratyushraj/Documents/noticebazaar/server/src/services/brandContactService.ts"],"sourcesContent":[null]}}