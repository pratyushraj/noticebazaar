{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import{callLLM}from\"./aiContractAnalysis.js\";async function generateAICounterProposal(request){const{deal_value,issues,missing_clauses=[],creator_category,brand_response_message,previous_negotiation_message,brand_name,tone_preference=\"firm\"}=request;const issuesContext=issues.filter(issue=>issue.severity===\"high\"||issue.severity===\"medium\"||issue.severity===\"warning\").map((issue,index)=>{const severityLabel=issue.severity===\"high\"?\"HIGH PRIORITY\":issue.severity===\"medium\"?\"MEDIUM PRIORITY\":\"WARNING PRIORITY\";return`${index+1}. [${severityLabel}] ${issue.title}\nCategory: ${issue.category}\nDescription: ${issue.description}\n${issue.recommendation?`Recommended Fix: ${issue.recommendation}`:\"\"}`}).join(\"\\n\\n\");const missingClausesContext=missing_clauses.map((clause,index)=>{return`${index+1}. ${clause.title}\nCategory: ${clause.category}\nDescription: ${clause.description}`}).join(\"\\n\\n\");const toneInstructions={soft:\"Use a very collaborative, friendly, and accommodating tone. Focus on partnership and mutual benefit. Be gentle in requests.\",firm:\"Use a professional, firm but respectful tone. Clearly state requirements while maintaining positive relationship. Balance assertiveness with collaboration.\",aggressive:\"Use a direct, assertive tone. Clearly state non-negotiable requirements. Show strong legal positioning while remaining professional.\"};const prompt=`You are an expert legal negotiator specializing in creator-brand partnerships. Your task is to generate an optimized counter-proposal message that maximizes approval probability while protecting the creator's interests.\n\nCONTEXT:\n${brand_name?`Brand Name: ${brand_name}`:\"Brand: Unknown\"}\n${deal_value?`Deal Value: \\u20B9${deal_value}`:\"Deal Value: Not specified\"}\n${creator_category?`Creator Category: ${creator_category}`:\"\"}\n\n${brand_response_message?`Brand's Previous Response: \"${brand_response_message}\"`:\"\"}\n${previous_negotiation_message?`Previous Negotiation Message Sent: \"${previous_negotiation_message.substring(0,500)}...\"`:\"\"}\n\nISSUES TO ADDRESS:\n${issuesContext}\n\n${missing_clauses.length>0?`MISSING CLAUSES TO ADD:\n${missingClausesContext}\n\n`:\"\"}TASK:\nGenerate a counter-proposal message that:\n1. Addresses all issues and missing clauses above\n2. Uses ${toneInstructions[tone_preference]}\n3. Maximizes brand approval probability\n4. Protects creator's legal and financial interests\n5. Is professional, clear, and actionable\n6. Includes specific, measurable requests\n\nSTRATEGY FOR HIGHER APPROVAL:\n- Frame requests as mutual benefits\n- Show understanding of brand's perspective\n- Offer reasonable compromises where possible\n- Prioritize critical issues (payment, termination, IP)\n- Use data/legal reasoning for stronger requests\n- Create urgency without being pushy\n- End with clear next steps\n\nOUTPUT FORMAT (JSON only, no markdown):\n{\n  \"tone\": \"<soft|firm|aggressive>\",\n  \"risk_level\": \"<low|medium|high>\",\n  \"approval_probability\": \"<percentage like '75%' or '82%'>\",\n  \"message\": \"<Full counter-proposal message text - ready to send>\",\n  \"key_changes\": [\n    \"<Change 1: e.g., Reduced exclusivity to 30 days>\",\n    \"<Change 2: e.g., Added late payment penalty>\",\n    \"<Change 3: e.g., Locked fixed payment amount>\"\n  ]\n}\n\nReturn ONLY valid JSON, no markdown, no explanations.`;try{const aiResponse=await callLLM(prompt);let parsed;try{const jsonMatch=aiResponse.match(/\\{[\\s\\S]*\\}/);if(jsonMatch){parsed=JSON.parse(jsonMatch[0])}else{throw new Error(\"No JSON found in response\")}}catch(parseError){console.error(\"[CounterProposal] Failed to parse AI response:\",aiResponse);throw new Error(\"Failed to parse AI response as JSON\")}if(!parsed.message||!parsed.key_changes||!Array.isArray(parsed.key_changes)){throw new Error(\"Invalid response structure from AI\")}return{tone:parsed.tone||tone_preference,risk_level:parsed.risk_level||\"medium\",approval_probability:parsed.approval_probability||\"70%\",message:parsed.message,key_changes:parsed.key_changes}}catch(error){console.error(\"[CounterProposal] Generation failed:\",error);throw new Error(`Failed to generate counter-proposal: ${error.message||\"Unknown error\"}`)}}__name(generateAICounterProposal,\"generateAICounterProposal\");export{generateAICounterProposal};\n","warnings":[],"map":{"version":3,"mappings":"kHAIA,OAAS,YAAe,0BA+BxB,eAAsB,0BACpB,QACkC,CAClC,KAAM,CACJ,WACA,OACA,gBAAkB,CAAC,EACnB,iBACA,uBACA,6BACA,WACA,gBAAkB,MACpB,EAAI,QAGJ,MAAM,cAAgB,OACnB,OAAO,OAAS,MAAM,WAAa,QAAU,MAAM,WAAa,UAAY,MAAM,WAAa,SAAS,EACxG,IAAI,CAAC,MAAO,QAAU,CACrB,MAAM,cAAgB,MAAM,WAAa,OAAS,gBAC9B,MAAM,WAAa,SAAW,kBAC9B,mBACpB,MAAO,GAAG,MAAQ,CAAC,MAAM,aAAa,KAAK,MAAM,KAAK;AAAA,YAChD,MAAM,QAAQ;AAAA,eACX,MAAM,WAAW;AAAA,EAC9B,MAAM,eAAiB,oBAAoB,MAAM,cAAc,GAAK,EAAE,EACpE,CAAC,EACA,KAAK,MAAM,EAGd,MAAM,sBAAwB,gBAC3B,IAAI,CAAC,OAAQ,QAAU,CACtB,MAAO,GAAG,MAAQ,CAAC,KAAK,OAAO,KAAK;AAAA,YAC9B,OAAO,QAAQ;AAAA,eACZ,OAAO,WAAW,EAC7B,CAAC,EACA,KAAK,MAAM,EAGd,MAAM,iBAAmB,CACvB,KAAM,8HACN,KAAM,8JACN,WAAY,sIACd,EAGA,MAAM,OAAS;AAAA;AAAA;AAAA,EAGf,WAAa,eAAe,UAAU,GAAK,gBAAgB;AAAA,EAC3D,WAAa,qBAAgB,UAAU,GAAK,2BAA2B;AAAA,EACvE,iBAAmB,qBAAqB,gBAAgB,GAAK,EAAE;AAAA;AAAA,EAE/D,uBAAyB,+BAA+B,sBAAsB,IAAM,EAAE;AAAA,EACtF,6BAA+B,uCAAuC,6BAA6B,UAAU,EAAG,GAAG,CAAC,OAAS,EAAE;AAAA;AAAA;AAAA,EAG/H,aAAa;AAAA;AAAA,EAEb,gBAAgB,OAAS,EAAI;AAAA,EAC7B,qBAAqB;AAAA;AAAA,EAEnB,EAAE;AAAA;AAAA;AAAA,UAGI,iBAAiB,eAAe,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uDA8BzC,GAAI,CACF,MAAM,WAAa,MAAM,QAAQ,MAAM,EAGvC,IAAI,OACJ,GAAI,CAEF,MAAM,UAAY,WAAW,MAAM,aAAa,EAChD,GAAI,UAAW,CACb,OAAS,KAAK,MAAM,UAAU,CAAC,CAAC,CAClC,KAAO,CACL,MAAM,IAAI,MAAM,2BAA2B,CAC7C,CACF,OAAS,WAAY,CACnB,QAAQ,MAAM,iDAAkD,UAAU,EAC1E,MAAM,IAAI,MAAM,qCAAqC,CACvD,CAGA,GAAI,CAAC,OAAO,SAAW,CAAC,OAAO,aAAe,CAAC,MAAM,QAAQ,OAAO,WAAW,EAAG,CAChF,MAAM,IAAI,MAAM,oCAAoC,CACtD,CAGA,MAAO,CACL,KAAM,OAAO,MAAQ,gBACrB,WAAY,OAAO,YAAc,SACjC,qBAAsB,OAAO,sBAAwB,MACrD,QAAS,OAAO,QAChB,YAAa,OAAO,WACtB,CACF,OAAS,MAAY,CACnB,QAAQ,MAAM,uCAAwC,KAAK,EAC3D,MAAM,IAAI,MAAM,wCAAwC,MAAM,SAAW,eAAe,EAAE,CAC5F,CACF,CAjIsB","names":[],"ignoreList":[],"sources":["/Users/pratyushraj/Documents/noticebazaar/server/src/services/counterProposalGenerator.ts"],"sourcesContent":[null]}}