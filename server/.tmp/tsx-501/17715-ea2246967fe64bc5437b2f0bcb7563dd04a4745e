{"code":"import express from\"express\";import{findInfluencers,saveInfluencersToDatabase,getInfluencersFromDatabase}from\"../services/influencerFinder.js\";import{generateOutreachMessage,generateBatchOutreachMessages,markAsContacted,updateInfluencerStatus,getInfluencersDueForFollowUp,getUncontactedInfluencers}from\"../services/influencerOutreach.js\";import{generateCSV,syncDatabaseToSheets,autoSyncToSheets}from\"../services/influencerSheets.js\";import{runDailyScan}from\"../services/influencerScheduler.js\";const router=express.Router();router.get(\"/find\",async(req,res)=>{try{const hashtags=req.query.hashtags?req.query.hashtags.split(\",\").map(h=>h.trim()).filter(Boolean):[];const keywords=req.query.keywords?req.query.keywords.split(\",\").map(k=>k.trim()).filter(Boolean):[];if(hashtags.length===0&&keywords.length===0){return res.status(400).json({success:false,error:\"At least one hashtag or keyword is required\"})}const minFollowers=req.query.minFollowers?parseInt(req.query.minFollowers,10):1e4;const maxFollowers=req.query.maxFollowers?parseInt(req.query.maxFollowers,10):5e5;const limit=req.query.limit?parseInt(req.query.limit,10):50;const saveToDb=req.query.saveToDb!==\"false\";const source=req.query.source||\"manual\";const influencers=await findInfluencers(hashtags,keywords,{minFollowers,maxFollowers,limit,source});if(saveToDb&&influencers.length>0){await saveInfluencersToDatabase(influencers)}res.json({success:true,count:influencers.length,influencers})}catch(error){console.error(\"[InfluencersAPI] Error finding influencers:\",error);res.status(500).json({success:false,error:error.message||\"Failed to find influencers\"})}});router.get(\"/list\",async(req,res)=>{try{const minFitScore=req.query.minFitScore?parseInt(req.query.minFitScore,10):void 0;const status=req.query.status;const alreadyContacted=req.query.alreadyContacted?req.query.alreadyContacted===\"true\":void 0;const niche=req.query.niche;const limit=req.query.limit?parseInt(req.query.limit,10):100;const influencers=await getInfluencersFromDatabase({minFitScore,status,alreadyContacted,niche,limit});res.json({success:true,count:influencers.length,influencers})}catch(error){console.error(\"[InfluencersAPI] Error listing influencers:\",error);res.status(500).json({success:false,error:error.message||\"Failed to list influencers\"})}});router.get(\"/high-fit\",async(req,res)=>{try{const minScore=req.query.minScore?parseInt(req.query.minScore,10):7;const limit=req.query.limit?parseInt(req.query.limit,10):100;const influencers=await getInfluencersFromDatabase({minFitScore:minScore,status:\"new\",limit});res.json({success:true,count:influencers.length,min_score:minScore,influencers})}catch(error){console.error(\"[InfluencersAPI] Error getting high-fit influencers:\",error);res.status(500).json({success:false,error:error.message||\"Failed to get high-fit influencers\"})}});router.post(\"/:handle/generate-outreach\",async(req,res)=>{try{const handle=req.params.handle.replace(\"@\",\"\");const template=req.body.template||\"default\";const influencers=await getInfluencersFromDatabase({limit:1e3});const influencer=influencers.find(i=>i.instagram_handle===handle);if(!influencer){return res.status(404).json({success:false,error:`Influencer @${handle} not found`})}const message=await generateOutreachMessage(influencer,template);res.json({success:true,influencer_handle:handle,message})}catch(error){console.error(\"[InfluencersAPI] Error generating outreach:\",error);res.status(500).json({success:false,error:error.message||\"Failed to generate outreach message\"})}});router.post(\"/generate-batch-outreach\",async(req,res)=>{try{const handles=req.body.handles;const limit=req.body.limit||50;const template=req.body.template||\"default\";let influencers;if(handles&&handles.length>0){const allInfluencers=await getInfluencersFromDatabase({limit:1e3});influencers=allInfluencers.filter(i=>handles.includes(i.instagram_handle)||handles.includes(`@${i.instagram_handle}`)).slice(0,limit)}else{influencers=await getUncontactedInfluencers(limit)}const messages=await generateBatchOutreachMessages(influencers,template);res.json({success:true,count:messages.size,template,messages:Object.fromEntries(messages)})}catch(error){console.error(\"[InfluencersAPI] Error generating batch outreach:\",error);res.status(500).json({success:false,error:error.message||\"Failed to generate batch outreach messages\"})}});router.post(\"/:handle/mark-contacted\",async(req,res)=>{try{const handle=req.params.handle.replace(\"@\",\"\");const followUpDueAt=req.body.followUpDueAt?new Date(req.body.followUpDueAt):void 0;const responseStatus=req.body.response_status||\"pending\";await markAsContacted(handle,new Date,followUpDueAt,responseStatus);res.json({success:true,message:`@${handle} marked as contacted`})}catch(error){console.error(\"[InfluencersAPI] Error marking as contacted:\",error);res.status(500).json({success:false,error:error.message||\"Failed to mark influencer as contacted\"})}});router.post(\"/:handle/update-status\",async(req,res)=>{try{const handle=req.params.handle.replace(\"@\",\"\");const status=req.body.status;const responseStatus=req.body.response_status;if(!status){return res.status(400).json({success:false,error:\"status is required\"})}await updateInfluencerStatus(handle,status,responseStatus);res.json({success:true,message:`@${handle} status updated to ${status}`})}catch(error){console.error(\"[InfluencersAPI] Error updating status:\",error);res.status(500).json({success:false,error:error.message||\"Failed to update influencer status\"})}});router.get(\"/follow-ups\",async(req,res)=>{try{const influencers=await getInfluencersDueForFollowUp();res.json({success:true,count:influencers.length,influencers})}catch(error){console.error(\"[InfluencersAPI] Error getting follow-ups:\",error);res.status(500).json({success:false,error:error.message||\"Failed to get follow-ups\"})}});router.post(\"/run-daily-scan\",async(req,res)=>{try{const hashtags=req.body.hashtags||void 0;const keywords=req.body.keywords||void 0;const options={minFollowers:req.body.minFollowers,maxFollowers:req.body.maxFollowers,limit:req.body.limit,source:req.body.source};runDailyScan(hashtags,keywords,options).catch(error=>{console.error(\"[InfluencersAPI] Background scan error:\",error)});res.json({success:true,message:\"Discovery scan started in background\",status:\"running\",note:\"Check the influencers list in a few minutes to see results\"})}catch(error){console.error(\"[InfluencersAPI] Error starting daily scan:\",error);res.status(500).json({success:false,error:error.message||\"Failed to start daily scan\"})}});router.get(\"/export/csv\",async(req,res)=>{try{const minFitScore=req.query.minFitScore?parseInt(req.query.minFitScore,10):void 0;const status=req.query.status;const limit=req.query.limit?parseInt(req.query.limit,10):1e3;const influencers=await getInfluencersFromDatabase({minFitScore,status,limit});let outreachMessages;if(req.query.includeMessages===\"true\"){const messages=await generateBatchOutreachMessages(influencers);outreachMessages=messages}const csv=generateCSV(influencers,outreachMessages);res.setHeader(\"Content-Type\",\"text/csv\");res.setHeader(\"Content-Disposition\",`attachment; filename=\"influencers-${new Date().toISOString().split(\"T\")[0]}.csv\"`);res.send(csv)}catch(error){console.error(\"[InfluencersAPI] Error exporting CSV:\",error);res.status(500).json({success:false,error:error.message||\"Failed to export CSV\"})}});router.post(\"/export/sheets\",async(req,res)=>{try{const{spreadsheetId,sheetName,filters,credentials,apiKey}=req.body;if(!spreadsheetId){return res.status(400).json({success:false,error:\"spreadsheetId is required\"})}await syncDatabaseToSheets({spreadsheetId,sheetName,credentials,apiKey},filters);res.json({success:true,message:\"Influencers exported to Google Sheets\"})}catch(error){console.error(\"[InfluencersAPI] Error exporting to sheets:\",error);res.status(500).json({success:false,error:error.message||\"Failed to export to Google Sheets\"})}});router.post(\"/auto-sync-sheets\",async(req,res)=>{try{const{spreadsheetId,credentials,apiKey}=req.body;if(!spreadsheetId){return res.status(400).json({success:false,error:\"spreadsheetId is required\"})}await autoSyncToSheets({spreadsheetId,credentials,apiKey});res.json({success:true,message:\"Auto-sync to Google Sheets completed\"})}catch(error){console.error(\"[InfluencersAPI] Error auto-syncing to sheets:\",error);res.status(500).json({success:false,error:error.message||\"Failed to auto-sync to Google Sheets\"})}});var influencers_default=router;export{influencers_default as default};\n","warnings":[],"map":{"version":3,"mappings":"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","names":[],"ignoreList":[],"sources":["/Users/pratyushraj/Documents/noticebazaar/server/src/routes/influencers.ts"],"sourcesContent":[null]}}